<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.15">
<meta name="description" content="A modern, JVM-based, full stack framework designed to develop distributed reactive applications that use a microservice architecture.">
<meta name="keywords" content="rx, rxmicro, reactive java, reactive jvm, microservice java, reactive microservice, micro service java, reactive micro service">
<meta name="author" content="nedis">
<title>Testing</title>
<link rel="stylesheet" href="../styles/rxmicro-doc.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body id="testing-section" class="article toc2 toc-left">
<div id="header">
<h1>Testing</h1>
<div class="details">
<span id="author" class="author">nedis</span><br>
<span id="email" class="email"><a href="mailto:rxmicro.io@gmail.com">rxmicro.io@gmail.com</a></span><br>
<span id="revnumber">version 0.11,</span>
<span id="revdate">2022-12-14 20:00:09 UTC</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#testing-prepare-section">1. Preparatory Steps</a>
<ul class="sectlevel2">
<li><a href="#testing-prepare-lib-versions-section">1.1. Definition the Versions of the Used Libraries:</a></li>
<li><a href="#testing-prepare-add-required-dependencies-section">1.2. Adding the Required Dependencies:</a></li>
<li><a href="#testing-prepare-maven-compiler-plugin-settings-section">1.3. Configuring the <code>maven-compiler-plugin</code>:</a></li>
<li><a href="#testing-prepare-maven-surefire-plugin-settings-section">1.4. Configuring the  <code>maven-surefire-plugin</code>:</a></li>
</ul>
</li>
<li><a href="#testing-annotations-section">2. <code>RxMicro Test Annotations</code></a></li>
<li><a href="#testing-alternatives-section">3. Alternatives</a>
<ul class="sectlevel2">
<li><a href="#injection_algorithm_for_the_alternative_of_the_rxmicro_component">3.1. Injection Algorithm for the Alternative of the RxMicro Component</a></li>
<li><a href="#injection_algorithm_for_the_alternative_of_the_custom_component">3.2. Injection Algorithm for the Alternative of the Custom Component</a></li>
<li><a href="#testing-alternatives-usage-section">3.3. Alternative Usage</a></li>
<li><a href="#components_with_custom_constructors">3.4. Components with Custom Constructors</a></li>
<li><a href="#ambiguity_resolving">3.5. Ambiguity Resolving</a>
<ul class="sectlevel3">
<li><a href="#ambiguity_resolving_demonstration">3.5.1. Ambiguity Resolving Demonstration</a></li>
<li><a href="#ambiguity_resolving_algorithm">3.5.2. Ambiguity Resolving Algorithm</a></li>
</ul>
</li>
<li><a href="#cdi_beans_alternatives">3.6. CDI Beans Alternatives</a></li>
</ul>
</li>
<li><a href="#testing-how-it-works-section">4. How It Works</a></li>
<li><a href="#testing-before-test-section">5. The <code>@BeforeThisTest</code> and <code>@BeforeIterationMethodSource</code> Annotations</a></li>
<li><a href="#testing-rest-based-microservice-tests-section">6. REST-based Microservice Testing</a>
<ul class="sectlevel2">
<li><a href="#basic_principles">6.1. Basic Principles</a></li>
<li><a href="#testing-rest-based-microservice-tests-complex-alternative-usage-section">6.2. Features of Testing Complex Microservices that use Alternatives</a>
<ul class="sectlevel3">
<li><a href="#features_of_rest_client_testing">6.2.1. Features of REST Client Testing</a></li>
<li><a href="#features_of_testing_mongo_repositories">6.2.2. Features of Testing Mongo Repositories</a></li>
<li><a href="#features_of_testing_postgres_repositories">6.2.3. Features of Testing Postgres Repositories</a></li>
</ul>
</li>
<li><a href="#custom_and_the_rxmicro_framework_code_execution_order">6.3. Custom and the RxMicro Framework Code Execution Order</a></li>
</ul>
</li>
<li><a href="#testing-component-tests-section">7. Testing of Microservice Components</a>
<ul class="sectlevel2">
<li><a href="#basic_principles_2">7.1. Basic Principles</a></li>
<li><a href="#features_of_testing_complex_components_that_use_alternatives">7.2. Features of Testing Complex Components that Use Alternatives</a></li>
<li><a href="#custom_and_the_rxmicro_framework_execution_order">7.3. Custom and the RxMicro Framework Execution Order</a></li>
</ul>
</li>
<li><a href="#testing-integration-tests-section">8. REST-based Microservice Integration Testing</a>
<ul class="sectlevel2">
<li><a href="#testing-integration-tests-basic-section">8.1. Basic Principles</a></li>
<li><a href="#testing-BlockingHttpClient-settings-section">8.2. The <code>BlockingHttpClient</code> Settings</a></li>
<li><a href="#testing-integration-tests-docker-section">8.3. The <code>docker</code> Usage</a></li>
</ul>
</li>
<li><a href="#testing-dbunit-tests-section">9. Database Testing Using DBUnit</a>
<ul class="sectlevel2">
<li><a href="#testing-dbunit-test-database-config">9.1. Test Database Configuration</a></li>
<li><a href="#testing-dbunit-retrieve-connection-strategies">9.2. Retrieve Connection Strategies</a>
<ul class="sectlevel3">
<li><a href="#one_connection_per_all_test_classes">9.2.1. One connection per all test classes</a></li>
<li><a href="#one_connection_per_test_class">9.2.2. One connection per test class</a></li>
<li><a href="#one_connection_per_test_method">9.2.3. One connection per test method</a></li>
</ul>
</li>
<li><a href="#testing-dbunit-initial-data-set">9.3. <code>@InitialDataSet</code> Annotation</a></li>
<li><a href="#testing-dbunit-expected-data-set">9.4. <code>@ExpectedDataSet</code> Annotation</a></li>
<li><a href="#testing-dbunit-rollback-changes">9.5. <code>@RollbackChanges</code> Annotation</a></li>
<li><a href="#testing-dbunit-order-by">9.6. Ordered Comparison</a></li>
<li><a href="#testing-dbunit-supported-expressions">9.7. Supported Expressions</a>
<ul class="sectlevel3">
<li><a href="#testing-dbunit-supported-expressions-null">9.7.1. <code>${null}</code> Expression</a></li>
<li><a href="#testing-dbunit-supported-expressions-now">9.7.2. <code>${now}</code> Expression</a></li>
<li><a href="#testing-dbunit-supported-expressions-int-interval">9.7.3. <code>${instant:interval}</code> Expression</a></li>
<li><a href="#testing-dbunit-supported-expressions-instant-interval">9.7.4. <code>${int:interval}</code> Expression</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<table class="tableblock frame-none grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="java-integration.html#java-integration-section"><strong><span class="icon"><i class="fa fa-angle-double-left"></i></span> Java EcoSystem Integration</strong></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="index.html#index-section"><strong><span class="icon"><i class="fa fa-angle-double-up"></i></span> Home</strong></a></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><a href="appendices.html#appendices-section"><strong>Appendices  <span class="icon"><i class="fa fa-angle-double-right"></i></span></strong></a></p></td>
</tr>
</tbody>
</table>
<hr>
<div class="paragraph">
<p>&#169; 2019-2022 rxmicro.io.
Free use of this software is granted under the terms of the <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/LICENSE" target="_blank" rel="noopener"><code>Apache License 2.0</code></a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Copies of this entity may be made for Your own use and for distribution to others, provided that You do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</p>
</div>
<div class="paragraph">
<p>If You find errors or omissions in this entity, please donâ€™t hesitate to submit an
<a href="https://github.com/rxmicro/rxmicro-usage/issues" target="_blank" rel="noopener"><strong>issue</strong></a> or open <a href="https://github.com/rxmicro/rxmicro-usage/pulls" target="_blank" rel="noopener"><strong>a pull request</strong></a> with a fix.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To help You write tests efficiently, the RxMicro framework provides the following modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://github.com/rxmicro/rxmicro/tree/v0.11/rxmicro-test" target="_blank" rel="noopener"><code>rxmicro.test</code></a> is a basic module designed for test writing using any modern testing framework;</p>
</li>
<li>
<p>The <a href="https://github.com/rxmicro/rxmicro/tree/v0.11/rxmicro-test-junit" target="_blank" rel="noopener"><code>rxmicro.test.junit</code></a> is a module designed for test writing using the <a href="https://junit.org/junit5/" target="_blank" rel="noopener">JUnit 5</a> framework;</p>
</li>
<li>
<p>The <a href="https://github.com/rxmicro/rxmicro/tree/v0.11/rxmicro-test-mockito" target="_blank" rel="noopener"><code>rxmicro.test.mockito</code></a> is a module designed for test writing using the <a href="https://site.mockito.org/" target="_blank" rel="noopener">Mockito</a> framework;</p>
</li>
<li>
<p>The <a href="https://github.com/rxmicro/rxmicro/tree/v0.11/rxmicro-test-mockito-junit" target="_blank" rel="noopener"><code>rxmicro.test.mockito.junit</code></a> is a module designed for test writing using the <a href="https://junit.org/junit5/" target="_blank" rel="noopener">JUnit 5</a> and <a href="https://site.mockito.org/" target="_blank" rel="noopener">Mockito</a> frameworks.</p>
</li>
<li>
<p>The <a href="https://github.com/rxmicro/rxmicro/tree/v0.11/rxmicro-test-dbunit" target="_blank" rel="noopener"><code>rxmicro.test.dbunit</code></a> is a module designed for test writing using the <a href="http://dbunit.sourceforge.net/" target="_blank" rel="noopener">DbUnit</a> framework;</p>
</li>
<li>
<p>The <a href="https://github.com/rxmicro/rxmicro/tree/v0.11/rxmicro-test-dbunit-junit" target="_blank" rel="noopener"><code>rxmicro.test.dbunit.junit</code></a> is a module designed for test writing using the <a href="http://dbunit.sourceforge.net/" target="_blank" rel="noopener">DbUnit</a> and <a href="https://junit.org/junit5/" target="_blank" rel="noopener">JUnit 5</a> frameworks;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using these modules, the developer can create the following types of tests:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#testing-rest-based-microservice-tests-section">REST-based microservice test</a>;</p>
</li>
<li>
<p><a href="#testing-component-tests-section">Component unit test</a>;</p>
</li>
<li>
<p><a href="#testing-integration-tests-section">Integration test of REST-based microservices</a>.</p>
</li>
<li>
<p><a href="#testing-dbunit-tests-section">Database Testing Using DBUnit</a>.</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="testing-prepare-section"><a class="anchor" href="#testing-prepare-section"></a><a class="link" href="#testing-prepare-section">1. Preparatory Steps</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before writing tests, using the RxMicro framework, the following steps must be taken:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Define the versions of used libraries.</p>
</li>
<li>
<p>Add the required dependencies to the <code>pom.xml</code>.</p>
</li>
<li>
<p>Configure the <code>maven-compiler-plugin</code>.</p>
</li>
<li>
<p>Configure the <code>maven-surefire-plugin</code>.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="testing-prepare-lib-versions-section"><a class="anchor" href="#testing-prepare-lib-versions-section"></a><a class="link" href="#testing-prepare-lib-versions-section">1.1. Definition the Versions of the Used Libraries:</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;properties&gt;
    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;rxmicro.version&gt;0.11&lt;/rxmicro.version&gt; <i class="conum" data-value="1"></i><b>(1)</b>

    &lt;maven-compiler-plugin.version&gt;3.10.1&lt;/maven-compiler-plugin.version&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    &lt;maven-surefire-plugin.version&gt;3.0.0-M7&lt;/maven-surefire-plugin.version&gt;<i class="conum" data-value="3"></i><b>(3)</b>
&lt;/properties&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="https://mvnrepository.com/artifact/io.rxmicro" target="_blank" rel="noopener">The latest stable version of the RxMicro framework</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="https://mvnrepository.com/artifact/org.apache.maven.plugins/maven-compiler-plugin" target="_blank" rel="noopener">The latest stable version of the <code>maven-compiler-plugin</code></a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><a href="https://mvnrepository.com/artifact/org.apache.maven.plugins/maven-surefire-plugin" target="_blank" rel="noopener">The latest stable version of the <code>maven-surefire-plugin</code></a>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="testing-prepare-add-required-dependencies-section"><a class="anchor" href="#testing-prepare-add-required-dependencies-section"></a><a class="link" href="#testing-prepare-add-required-dependencies-section">1.2. Adding the Required Dependencies:</a></h3>
<div class="paragraph">
<p>Before using the RxMicro modules for testing, You need to add the following dependencies to the project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.rxmicro&lt;/groupId&gt;
        &lt;artifactId&gt;rxmicro-test-junit&lt;/artifactId&gt; <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;version&gt;${rxmicro.version}&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.rxmicro&lt;/groupId&gt;
        &lt;artifactId&gt;rxmicro-test-mockito-junit&lt;/artifactId&gt; <i class="conum" data-value="2"></i><b>(2)</b>
        &lt;version&gt;${rxmicro.version}&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.rxmicro&lt;/groupId&gt;
        &lt;artifactId&gt;rxmicro-rest-client-exchange-json&lt;/artifactId&gt; <i class="conum" data-value="3"></i><b>(3)</b>
        &lt;version&gt;${rxmicro.version}&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>rxmicro-test-junit</code> - a unit testing library based on the <a href="https://junit.org/junit5/" target="_blank" rel="noopener">JUnit 5</a> framework.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>rxmicro-test-mockito-junit</code> - a unit testing library based on the <a href="https://junit.org/junit5/" target="_blank" rel="noopener">JUnit 5</a> framework with integration of the <a href="https://site.mockito.org/" target="_blank" rel="noopener">Mockito</a> framework.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>rxmicro-rest-client-exchange-json</code> - a library for converting Java models to <a href="https://www.json.org/" target="_blank" rel="noopener">JSON</a> format and vice versa on the HTTP client side.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>rxmicro-rest-client-exchange-json</code> libraries are required only during writing the
<a href="#testing-rest-based-microservice-tests-section">REST-based microservice tests</a> and <a href="#testing-integration-tests-section">integration tests</a>.
These dependencies can be omitted during writing the <a href="#testing-component-tests-section">component unit tests</a>.</p>
</div>
<div class="paragraph">
<p>The <code>rxmicro-test-mockito-junit</code> library depends on the <code>rxmicro-test-junit</code>, so only one of them needs to be added:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If only the <a href="https://junit.org/junit5/" target="_blank" rel="noopener">JUnit 5</a> framework is required, use the <code>rxmicro-test-junit</code> library.</p>
</li>
<li>
<p>If You still need to create mocks, then use the <code>rxmicro-test-mockito-junit</code> library.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="testing-prepare-maven-compiler-plugin-settings-section"><a class="anchor" href="#testing-prepare-maven-compiler-plugin-settings-section"></a><a class="link" href="#testing-prepare-maven-compiler-plugin-settings-section">1.3. Configuring the <code>maven-compiler-plugin</code>:</a></h3>
<div class="paragraph">
<p>To solve <a href="#testing-how-it-works-section">problems with the Java module system</a> when writing the tests, it is necessary to add the additional execution to the <code>maven-compiler-plugin</code> configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
    &lt;version&gt;${maven-compiler-plugin.version}&lt;/version&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;configuration&gt;
        &lt;release&gt;11&lt;/release&gt;
        &lt;annotationProcessorPaths&gt;
            &lt;annotationProcessorPath&gt;
                &lt;groupId&gt;io.rxmicro&lt;/groupId&gt;
                &lt;artifactId&gt;rxmicro-annotation-processor&lt;/artifactId&gt;
                &lt;version&gt;${rxmicro.version}&lt;/version&gt;
            &lt;/annotationProcessorPath&gt;
        &lt;/annotationProcessorPaths&gt;
    &lt;/configuration&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;id&gt;source-compile&lt;/id&gt;
            &lt;goals&gt;
                &lt;goal&gt;compile&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;annotationProcessors&gt;
                    &lt;annotationProcessor&gt;
                        io.rxmicro.annotation.processor.RxMicroAnnotationProcessor
                    &lt;/annotationProcessor&gt;
                &lt;/annotationProcessors&gt;
                &lt;generatedSourcesDirectory&gt;
                    ${project.build.directory}/generated-sources/
                &lt;/generatedSourcesDirectory&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
        &lt;execution&gt;
            &lt;id&gt;test-compile&lt;/id&gt; <i class="conum" data-value="2"></i><b>(2)</b>
            &lt;goals&gt;
                &lt;goal&gt;testCompile&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;annotationProcessors&gt;
                    &lt;annotationProcessor&gt;
                        io.rxmicro.annotation.processor.RxMicroTestsAnnotationProcessor <i class="conum" data-value="3"></i><b>(3)</b>
                    &lt;/annotationProcessor&gt;
                &lt;/annotationProcessors&gt;
                &lt;generatedTestSourcesDirectory&gt;
                    ${project.build.directory}/generated-test-sources/ <i class="conum" data-value="4"></i><b>(4)</b>
                &lt;/generatedTestSourcesDirectory&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The plugin version defined in the <a href="#testing-prepare-lib-versions-section"><code>properties</code></a> section.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The separate configuration is required for the tests, so a new <code>execution</code> must be added.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The annotation processor class that handles the test configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Location of Java classes generated by the <code>RxMicro Test Annotation Processor</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>io.rxmicro.annotation.processor.RxMicroTestsAnnotationProcessor</code> generates additional classes required <strong>only during testing</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Therefore, You must always specify a separate folder for the generated classes!</strong></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="testing-prepare-maven-surefire-plugin-settings-section"><a class="anchor" href="#testing-prepare-maven-surefire-plugin-settings-section"></a><a class="link" href="#testing-prepare-maven-surefire-plugin-settings-section">1.4. Configuring the  <code>maven-surefire-plugin</code>:</a></h3>
<div class="paragraph">
<p>For a successful tests launch while building a project with <code>maven</code> it is necessary to update <code>maven-surefire-plugin</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
    &lt;version&gt;${maven-surefire-plugin.version}&lt;/version&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;configuration&gt;
        &lt;properties&gt;
            &lt;!-- https://junit.org/junit5/docs/5.5.1/api/org/junit/jupiter/api/Timeout.html --&gt;
            &lt;configurationParameters&gt;
                junit.jupiter.execution.timeout.default = 60                <i class="conum" data-value="2"></i><b>(2)</b>
                junit.jupiter.execution.timeout.mode = disabled_on_debug    <i class="conum" data-value="3"></i><b>(3)</b>
                junit.jupiter.execution.parallel.enabled = false            <i class="conum" data-value="4"></i><b>(4)</b>
            &lt;/configurationParameters&gt;
        &lt;/properties&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="https://mvnrepository.com/artifact/org.apache.maven.plugins/maven-surefire-plugin" target="_blank" rel="noopener">Last stable version of <code>maven-surefire-plugin</code></a>.<br>
<em>(The plugin version must be <code>2.22.1</code> or higher, otherwise <code>maven</code> will ignore the tests!.)</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In case of an error in the code which uses reactive programming, an infinite function execution may occur.
In order to detect such cases, it is necessary to set a global timeout for all methods in the tests.
<em>(By default, timeout is set in seconds.
More detailed information on timeouts configuration is available <a href="https://junit.org/junit5/docs/current/user-guide/user-guide/#writing-tests-declarative-timeouts" target="_blank" rel="noopener">in official JUnit5 documentation</a>.)</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>While debugging, timeouts can be turned off.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>This property is useful for the tests debugging from IDE or <code>maven</code>.<br>
<em>(By setting this property the speed of test performance will decrease, so use this property for debugging only!)</em></td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>At the end of each subsection describing any the RxMicro framework feature, there is a link to the project, the source codes of which were used in this subsection.</p>
</div>
<div class="paragraph">
<p>Use these links to access a working example demonstrating the RxMicro framework feature described above!</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-annotations-section"><a class="anchor" href="#testing-annotations-section"></a><a class="link" href="#testing-annotations-section">2. <code>RxMicro Test Annotations</code></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The RxMicro framework supports additional <code>RxMicro Test annotations</code>, that extend the features of the <a href="https://junit.org/junit5/" target="_blank" rel="noopener">JUnit 5</a>, <a href="https://site.mockito.org/" target="_blank" rel="noopener">Mockito</a> and <a href="http://dbunit.sourceforge.net/" target="_blank" rel="noopener">DbUnit</a>
test frameworks and add additional features required for efficient writing of all supported test types.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The RxMicro framework supports two types of annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>RxMicro Annotations</code> used by the <code>RxMicro Annotation Processor</code> during the compiling and therefore available <strong>only during the compilation process</strong>.</p>
</li>
<li>
<p>The <code>RxMicro Test Annotations</code> used by the test framework during the test run and therefore available using the <code>reflection</code> mechanism.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These types of annotations do not complement each other!
Each of these types is designed to perform its tasks.</p>
</div>
<div class="paragraph">
<p><strong>So when writing tests, be careful not to use the <code>RxMicro Annotations</code> as they are not available for the test framework!</strong></p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Supported <code>RxMicro Test Annotations</code></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Annotation</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/Alternative.java" target="_blank" rel="noopener"><code>@Alternative</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares the test class field as an <a href="#testing-alternatives-section">alternative</a>.</p>
<p class="tableblock"><em>The RxMicro framework supports alternatives only for <a href="#testing-rest-based-microservice-tests-section">REST-based microservice tests</a> and <a href="#testing-component-tests-section">component unit tests</a>.</em></p>
<p class="tableblock"><a id="testing-annotations-WithConfig-inline"></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/WithConfig.java" target="_blank" rel="noopener"><code>@WithConfig</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares the <strong>static</strong> field of the test class as a configuration which must be registered in the configuration manager before starting the test.</p>
<p class="tableblock"><em>This annotation allows declaring a configuration using <a href="core.html#core-config-java-classes-section">Java classes</a>.</em>
<em>(The configuration defined in this way is only available while the test is running.)</em></p>
<p class="tableblock">The source code of the project that uses the <code>@WithConfig</code> annotation, is available at the following link:</p>
<p class="tableblock"><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-microservice-with-config" target="_blank" rel="noopener"><code>testing-microservice-with-config</code></a></p>
<p class="tableblock"><em>The RxMicro framework supports test configuration only for <a href="#testing-rest-based-microservice-tests-section">REST-based microservice tests</a> and <a href="#testing-component-tests-section">component unit tests</a>.</em></p>
<p class="tableblock"><a id="testing-annotations-SetConfigValue-inline"></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/SetConfigValue.java" target="_blank" rel="noopener"><code>@SetConfigValue</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows overriding the default value for any configuration available only for the test environment.</p>
<p class="tableblock"><em>This annotation allows declaring a configuration using <a href="core.html#core-config-annotations-section">annotations</a>.</em>
<em>(The configuration defined in this way is only available while the test is running.
It means that this annotation is analogous to the <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/DefaultConfigValue.java" target="_blank" rel="noopener"><code>DefaultConfigValue</code></a> annotation!)</em></p>
<p class="tableblock"><em>The RxMicro framework supports test configuration only for <a href="#testing-rest-based-microservice-tests-section">REST-based microservice tests</a> and <a href="#testing-component-tests-section">component unit tests</a>.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/BlockingHttpClientSettings.java" target="_blank" rel="noopener"><code>@BlockingHttpClientSettings</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to <a href="#testing-BlockingHttpClient-settings-section">configure the following component:</a>
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/BlockingHttpClient.java" target="_blank" rel="noopener"><code>BlockingHttpClient</code></a>, in order to execute HTTP requests in tests.</p>
<p class="tableblock"><em>(This annotation applies only to the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/BlockingHttpClient.java" target="_blank" rel="noopener"><code>BlockingHttpClient</code></a> type fields.)</em></p>
<p class="tableblock"><em>The RxMicro framework supports the <code>BlockingHttpClient</code> component only for <a href="#testing-rest-based-microservice-tests-section">REST-based microservice tests</a> and <a href="#testing-integration-tests-section">REST-based microservice integration tests</a>.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/RxMicroRestBasedMicroServiceTest.java" target="_blank" rel="noopener"><code>@RxMicroRestBasedMicroServiceTest</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares the test class as a <a href="#testing-rest-based-microservice-tests-section">REST-based microservice test</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/RxMicroComponentTest.java" target="_blank" rel="noopener"><code>@RxMicroComponentTest</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares the test class as a <a href="#testing-component-tests-section">component unit test</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/RxMicroIntegrationTest.java" target="_blank" rel="noopener"><code>@RxMicroIntegrationTest</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares the test class as a <a href="#testing-integration-tests-section">REST-based microservice integration test</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-dbunit-junit/src/main/java/io/rxmicro/test/dbunit/junit/DbUnitTest.java" target="_blank" rel="noopener"><code>@DbUnitTest</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares the test class as a <a href="#testing-integration-tests-section">DBUnit integration test</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/BeforeThisTest.java" target="_blank" rel="noopener"><code>@BeforeThisTest</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is used to specify the method to be invoked by the RxMicro framework <a href="#testing-before-test-section">before running the test method</a>.</p>
<p class="tableblock"><em>The RxMicro framework supports the <code>@BeforeThisTest</code> annotation only for <a href="#testing-rest-based-microservice-tests-section">REST-based microservice tests</a> and <a href="#testing-component-tests-section">component unit tests</a>.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/BeforeIterationMethodSource.java" target="_blank" rel="noopener"><code>@BeforeIterationMethodSource</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is used to specify the methods to be invoked by the RxMicro framework before <a href="#testing-before-test-section">performing each iteration of the parameterized test</a>.</p>
<p class="tableblock"><em>The RxMicro framework supports the <code>@BeforeIterationMethodSource</code> annotation only for <a href="#testing-rest-based-microservice-tests-section">REST-based microservice tests</a> and <a href="#testing-component-tests-section">component unit tests</a>.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-mockito-junit/src/main/java/io/rxmicro/test/mockito/junit/InitMocks.java" target="_blank" rel="noopener"><code>@InitMocks</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informs the test framework about the need to <a href="#InitMocks-inline">create mocks and inject them into the test class fields</a>, annotated by the
<a href="https://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/Mock.html" target="_blank" rel="noopener"><code>@Mock</code></a> annotation.</p>
<p class="tableblock"><em>(Using the <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-mockito-junit/src/main/java/io/rxmicro/test/mockito/junit/InitMocks.java" target="_blank" rel="noopener"><code>@InitMocks</code></a>
annotation is preferable to the analogous
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-mockito-junit/src/main/java/io/rxmicro/test/mockito/junit/InitMocks.java#L60" target="_blank" rel="noopener"><code>@ExtendWith(MockitoExtension.class)</code></a> construction.)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-dbunit/src/main/java/io/rxmicro/test/dbunit/InitialDataSet.java" target="_blank" rel="noopener"><code>@InitialDataSet</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides <a href="#testing-dbunit-initial-data-set">the init state of tested database before execution of the test method</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-dbunit/src/main/java/io/rxmicro/test/dbunit/ExpectedDataSet.java" target="_blank" rel="noopener"><code>@ExpectedDataSet</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides <a href="#testing-dbunit-expected-data-set">the expected state of tested database after execution of the test method</a>.</p>
<p class="tableblock">If expected state does not match to the actual database state the <code>java.lang.AssertionError</code> will be thrown.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-dbunit/src/main/java/io/rxmicro/test/dbunit/RollbackChanges.java" target="_blank" rel="noopener"><code>@RollbackChanges</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares the <a href="#testing-dbunit-rollback-changes">transactional test</a>.</p>
<p class="tableblock">The transaction test means that all changes made by test will rolled back after the test execution.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="testing-alternatives-section"><a class="anchor" href="#testing-alternatives-section"></a><a class="link" href="#testing-alternatives-section">3. Alternatives</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>For efficient unit testing, the RxMicro framework supports the mechanism of alternatives.</p>
</div>
<div class="paragraph">
<p><strong>Alternatives</strong> are test components, usually being mocks with predefined behaviors, that are injected by the RxMicro framework into the tested classes.
Alternatives are a powerful mechanism for writing unit tests.</p>
</div>
<div class="paragraph">
<p>The RxMicro framework supports alternatives only for <a href="#testing-rest-based-microservice-tests-section">REST-based microservice tests</a> and <a href="#testing-component-tests-section">component unit tests</a>.</p>
</div>
<div class="paragraph">
<p>When developing a microservice project, two types of components are distinguished:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>RxMicro component</em> - a class that is part of the RxMicro framework (for example, <code>HttpClientFactory</code>) or a class generated by the <code>RxMicro Annotation Processor</code> (Data Repository, Rest client, etc).</p>
</li>
<li>
<p><em>Custom component</em> - a developer-written class that is part of a microservice project.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These two types of components have different life cycles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The instances of the RxMicro components are created in the classes generated by the <code>RxMicro Annotation Processor</code>, and are registered in the runtime container.
When a reference to the RxMicro component is required, the custom class requests it in the runtime container.</p>
</li>
<li>
<p>The instances of custom components are created independently by the developer in the code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Due to the difference in life cycles between the two types of the RxMicro components, the RxMicro framework also supports two types of alternatives:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>alternatives of the RxMicro components</strong>;</p>
</li>
<li>
<p><strong>alternatives of custom components</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These types of alternatives differ in the algorithms of injection into the tested class.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="injection_algorithm_for_the_alternative_of_the_rxmicro_component"><a class="anchor" href="#injection_algorithm_for_the_alternative_of_the_rxmicro_component"></a><a class="link" href="#injection_algorithm_for_the_alternative_of_the_rxmicro_component">3.1. Injection Algorithm for the Alternative of the RxMicro Component</a></h3>
<div class="paragraph">
<p>To inject the alternative of the RxMicro component, the RxMicro framework uses the following algorithm:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The alternative instance is created by the developer in the test code or by the testing framework automatically.</p>
</li>
<li>
<p>Once all alternatives have been created, they are registered in the runtime container.</p>
</li>
<li>
<p>Once all alternatives have been registered, the RxMicro framework creates an instance of the tested class.</p>
</li>
<li>
<p>In the constructor or static section of the tested class, a request to the runtime container to get a reference to the RxMicro component is executed.</p>
</li>
<li>
<p>Since the runtime container already contains an alternative instead of the real component, the alternative is injected into the instance of the tested class.</p>
</li>
<li>
<p>After initialization, the instance of the tested class contains references to alternatives instead of the real RxMicro components.</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="injection_algorithm_for_the_alternative_of_the_custom_component"><a class="anchor" href="#injection_algorithm_for_the_alternative_of_the_custom_component"></a><a class="link" href="#injection_algorithm_for_the_alternative_of_the_custom_component">3.2. Injection Algorithm for the Alternative of the Custom Component</a></h3>
<div class="paragraph">
<p>To inject the alternative of the custom component, the RxMicro framework uses the following algorithm:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The alternative instance is created by the developer in the test code or by the testing framework automatically.</p>
</li>
<li>
<p>The RxMicro framework creates an instance of the tested class.</p>
</li>
<li>
<p>In the constructor or static section of the tested class, instances of the real custom components are created.</p>
</li>
<li>
<p>After initialization, the instance of the tested class contains references to the real custom components.</p>
</li>
<li>
<p>After creating an instance of the tested class, the RxMicro framework injects the custom component alternatives using the  <code>reflection</code> mechanism.<br>
<em>(I.e. the alternatives replace the real instances already after creating an instance of the tested class.)</em>;</p>
</li>
<li>
<p>After alternative injection, the instance of the tested class contains references to the alternatives of the RxMicro components instead of the real RxMicro components.<br>
<em>(The real component instances will be removed by the garbage collector later.)</em>;</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Thus, the main difference of the injection algorithm for the custom component alternatives is that during the injection process, the real component instances are always created.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the real component creates a reference to an external resource, then this resource <strong>will not be</strong> released automatically when injecting the alternative!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is recommended to use the <a href="cdi.html#cdi-section"><code>rxmicro.cdi</code></a> module to create the custom component alternatives that work with external resources.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the <a href="cdi.html#cdi-section"><code>rxmicro.cdi</code></a> module is used by the developer to create the custom component instances, then <strong>all</strong> custom components are injected using the algorithm of the RxMicro component alternative injection.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="testing-alternatives-usage-section"><a class="anchor" href="#testing-alternatives-usage-section"></a><a class="link" href="#testing-alternatives-usage-section">3.3. Alternative Usage</a></h3>
<div class="paragraph">
<p>The alternative mechanism is a universal tool that can be applied to the simplest project, which doesn&#8217;t use the <code>RxMicro Annotations</code>.<br>
Let&#8217;s look at the project consisting of two components: the <code>ChildComponent</code> interface and the <code>ParentComponent</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface ChildComponent {

    String getValue();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class ParentComponent {

    private final ChildComponent childComponent = () -&gt; "production"; <i class="conum" data-value="1"></i><b>(1)</b>

    public String getEnvironment() {
        return childComponent.getValue();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>ParentComponent</code> class depends on the <code>ChildComponent</code>.<br>
<em>(This dependency specified explicitly in the source code.)</em></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When writing a unit test for the <code>ParentComponent</code>, it is necessary to replace the real <code>ChildComponent</code> with a mock.
Otherwise, it wouldn&#8217;t be a unit test, but an integration one.</p>
</div>
<div class="paragraph">
<p>For this replacement, it is most convenient to use the alternative:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><i class="conum" data-value="1"></i><b>(1)</b>
@RxMicroComponentTest(ParentComponent.class)
final class ParentComponent1Test {

    <i class="conum" data-value="3"></i><b>(3)</b>
    @Alternative
    private final ChildComponent childComponent = () -&gt; "test"; <i class="conum" data-value="4"></i><b>(4)</b>

    private ParentComponent parentComponent; <i class="conum" data-value="2"></i><b>(2)</b>

    @Test
    void Should_use_alternative() {
        assertEquals("test", parentComponent.getEnvironment()); <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The alternatives are supported by the RxMicro framework only during component unit tests or REST-based microservice tests.
Therefore, it must be declared that this test is a test of the <code>ParentComponent</code> component.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The instance of the tested component will be created by the RxMicro framework automatically.<br>
<em>(The instance is created using the <code>reflection</code> mechanism, so the tested class must contain an available constructor without parameters.)</em><br>
In order to invoke any method of the tested component, a reference to that component is required.
Therefore, the RxMicro framework requires that the developer declares an uninitialized field of the tested component.
After starting the test, a reference to the instance of the tested component will be injected into this field using the <code>reflection</code> mechanism.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In order to use the alternative mechanism, it is necessary to declare test field as alternative by using the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/Alternative.java" target="_blank" rel="noopener"><code>@Alternative</code></a> annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Alternative is a test component with predefined behavior.
Therefore, it is necessary to define what value should be returned when invoking the <code>getValue</code> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>When testing the <code>getEnvironment</code> method, the alternative method is invoked instead of the real component one.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If You would like to inject the alternative to the <strong>final</strong> field, don&#8217;t forget to configure <code>maven-surefire-plugin</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
    &lt;configuration&gt;
        &lt;argLine&gt;
            --add-opens java.base/java.lang.reflect=rxmicro.reflection <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;/argLine&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>- It is necessary to add this <code>opens</code> instruction.</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using alternatives it is very convenient to use a dynamic class with programmable behavior.
For this purpose, it is very convenient to use the <a href="https://site.mockito.org/" target="_blank" rel="noopener">Mockito</a> framework:</p>
</div>
<div id="InitMocks-inline" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><i class="conum" data-value="2"></i><b>(2)</b>
@InitMocks
@RxMicroComponentTest(ParentComponent.class)
final class ParentComponent2Test {

    private ParentComponent parentComponent;

    <i class="conum" data-value="1"></i><b>(1)</b>
    @Mock
    @Alternative
    private ChildComponent childComponent;

    @Test
    void Should_use_alternative() {
        when(childComponent.getValue()).thenReturn("test"); <i class="conum" data-value="3"></i><b>(3)</b>
        assertEquals("test", parentComponent.getEnvironment()); <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>To create a mock instance, it is necessary to use the <a href="https://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/Mock.html" target="_blank" rel="noopener"><code>@Mock</code></a> annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In order for JUnit to handle all fields annotated by the <a href="https://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/Mock.html" target="_blank" rel="noopener"><code>@Mock</code></a> annotation before invoking test methods, it is necessary to annotate the test class by the <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-mockito-junit/src/main/java/io/rxmicro/test/mockito/junit/InitMocks.java" target="_blank" rel="noopener"><code>@InitMocks</code></a> annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Before testing, it is necessary to program the behavior of the <code>getValue</code> method of the declared mock.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>When testing the <code>getEnvironment</code> method, the method from the alternative is invoked instead of the real component one.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If You would like to inject the alternative to the <strong>final</strong> field, don&#8217;t forget to configure <code>maven-surefire-plugin</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
    &lt;configuration&gt;
        &lt;argLine&gt;
            --add-opens java.base/java.lang.reflect=rxmicro.reflection <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;/argLine&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>- It is necessary to add this <code>opens</code> instruction.</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When creating mock alternatives, the <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-mockito-junit/src/main/java/io/rxmicro/test/mockito/junit/InitMocks.java" target="_blank" rel="noopener"><code>@InitMocks</code></a>
annotation should be over the <code>@RxMicroComponentTest</code> annotation (or <code>@RxMicroRestBasedMicroServiceTest</code> when writing REST-based microservice tests), otherwise, <strong>the alternative will be injected before creating a mock instance, (i.e. injection of the <code>null</code> instance), which will cause an error!</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-component-alternatives-simplest" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-component-alternatives-simplest</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="components_with_custom_constructors"><a class="anchor" href="#components_with_custom_constructors"></a><a class="link" href="#components_with_custom_constructors">3.4. Components with Custom Constructors</a></h3>
<div class="paragraph">
<p>In case the custom component does not contain an available constructor without parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class ParentComponent {

    private final String prefix;

    private final ChildComponent childComponent = () -&gt; "production"; <i class="conum" data-value="1"></i><b>(1)</b>

    public ParentComponent(final String prefix) { <i class="conum" data-value="2"></i><b>(2)</b>
        this.prefix = requireNonNull(prefix);
    }

    public String getEnvironment() {
        return prefix + " " + childComponent.getValue();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>ParentComponent</code> depends on the <code>ChildComponent</code>.<br>
<em>(This dependency is specified explicitly in the source code.)</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When creating the <code>ParentComponent</code> class instance in the constructor, the value of the <code>prefix</code> parameter must be passed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>then the RxMicro framework won&#8217;t be able to create an instance of this class.</p>
</div>
<div class="paragraph">
<p><strong>Therefore, the developer should create an instance of this class in one of the following methods: <a href="https://junit.org/junit5/docs/current/user-guide/api/org.junit.jupiter.api/org/junit/jupiter/api/BeforeEach.html" target="_blank" rel="noopener"><code>@BeforeEach</code></a>,
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/BeforeThisTest.java" target="_blank" rel="noopener"><code>@BeforeThisTest</code></a> or
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/BeforeIterationMethodSource.java" target="_blank" rel="noopener"><code>@BeforeIterationMethodSource</code></a></strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroComponentTest(ParentComponent.class)
final class ParentComponentTest {

    private ParentComponent parentComponent;

    <i class="conum" data-value="2"></i><b>(2)</b>
    @Mock
    @Alternative
    private ChildComponent childComponent;

    @BeforeEach
    void beforeEach() {
        parentComponent = new ParentComponent("prefix"); <i class="conum" data-value="1"></i><b>(1)</b>
    }

    @Test
    void Should_use_alternative() {
        when(childComponent.getValue()).thenReturn("test");
        assertEquals("prefix test", parentComponent.getEnvironment()); <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>ParentComponent</code> class instance is created inside the method annotated by the <a href="https://junit.org/junit5/docs/current/user-guide/api/org.junit.jupiter.api/org/junit/jupiter/api/BeforeEach.html" target="_blank" rel="noopener"><code>@BeforeEach</code></a> annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>childComponent</code> alternative will be injected into the <code>ParentComponent</code> class instance after invoking the <code>beforeEach()</code> method and before the <code>Should_use_alternative()</code> test method.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>When testing the <code>getEnvironment</code> method, the alternative method is invoked instead of the real component one.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If You would like to inject the alternative to the <strong>final</strong> field, don&#8217;t forget to configure <code>maven-surefire-plugin</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
    &lt;configuration&gt;
        &lt;argLine&gt;
            --add-opens java.base/java.lang.reflect=rxmicro.reflection <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;/argLine&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>- It is necessary to add this <code>opens</code> instruction.</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-component-alternatives-simplest" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-component-alternatives-simplest</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="ambiguity_resolving"><a class="anchor" href="#ambiguity_resolving"></a><a class="link" href="#ambiguity_resolving">3.5. Ambiguity Resolving</a></h3>
<div class="paragraph">
<p>The alternative created by the developer can be injected by the RxMicro framework not only in the tested component, but also in any of its child components.</p>
</div>
<div class="paragraph">
<p>During such injection, the ambiguity problem may occur.</p>
</div>
<div class="sect3">
<h4 id="ambiguity_resolving_demonstration"><a class="anchor" href="#ambiguity_resolving_demonstration"></a><a class="link" href="#ambiguity_resolving_demonstration">3.5.1. Ambiguity Resolving Demonstration</a></h4>
<div class="paragraph">
<p>Let&#8217;s assume there is some business service in the project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface BusinessService {

    String getValue();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This business service is a dependency for three interdependent components: <code>Child</code>, <code>Parent</code>, <code>GrandParent</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class Child {

    private final BusinessService childBusinessService = () -&gt; "Child";

    public String getValue() {
        return childBusinessService.getValue();
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class Parent {

    private final Child child = new Child();

    private final BusinessService parentBusinessService = () -&gt; "Parent";

    public String getValue() {
        return parentBusinessService.getValue() + " : " + child.getValue();
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class GrandParent {

    private final Parent parent = new Parent();

    private final BusinessService grandParentBusinessService = () -&gt; "GrandParent";

    public String getValue() {
        return grandParentBusinessService.getValue() + " : " + parent.getValue();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When invoking the <code>GrandParent.getValue</code> method, this method is invoked on the business services of all <code>Child</code>, <code>Parent</code> and <code>GrandParent</code> dependent components according to the dependency hierarchy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final class GrandParent1Test {

    private final GrandParent grandParent = new GrandParent();

    @Test
    void Should_return_default_values() {
        assertEquals("GrandParent : Parent : Child", grandParent.getValue());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using an alternative, the behavior of the <code>GrandParent.getValue</code> method is changed:</p>
</div>
<div id="GrandParent2Test-inline" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroComponentTest(GrandParent.class)
final class GrandParent2Test {

    private GrandParent grandParent;

    @Mock
    <i class="conum" data-value="1"></i><b>(1)</b>
    @Alternative
    private BusinessService businessService;

    @Test
    void Should_inject_alternatives_correctly() {
        when(businessService.getValue()).thenReturn("Mock"); <i class="conum" data-value="2"></i><b>(2)</b>

        assertEquals("Mock : Mock : Mock", grandParent.getValue()); <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An alternative to the business service is created.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Before testing, the behavior of the <code>getValue</code> method of created mock is programmed.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>As a result of the test, You can see that this alternative is injected into <strong>all</strong> <code>Child</code>, <code>Parent</code> and <code>GrandParent</code> dependent components.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If You would like to inject the alternative to the <strong>final</strong> field, don&#8217;t forget to configure <code>maven-surefire-plugin</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
    &lt;configuration&gt;
        &lt;argLine&gt;
            --add-opens java.base/java.lang.reflect=rxmicro.reflection <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;/argLine&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>- It is necessary to add this <code>opens</code> instruction.</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If You create 2 or more (no more than 3 in this test example) alternatives, then each alternative can be injected in a separate business component:</p>
</div>
<div id="GrandParent3Test-inline" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroComponentTest(GrandParent.class)
final class GrandParent3Test {

    private GrandParent grandParent;

    @Mock
    @Alternative
    private BusinessService grandParentBusinessService;

    @Mock
    @Alternative(name = "childBusinessService")
    private BusinessService businessService;

    @Test
    void Should_inject_alternatives_correctly() {
        when(grandParentBusinessService.getValue()).thenReturn("GrandParentMock");
        when(businessService.getValue()).thenReturn("ChildMock");

        assertEquals("GrandParentMock : Parent : ChildMock", grandParent.getValue()); <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>grandParentBusinessService</code> alternative is injected into the <code>GrandParent</code> component, and the <code>businessService</code> alternative is injected into the <code>Child</code> component;</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If You would like to inject the alternative to the <strong>final</strong> field, don&#8217;t forget to configure <code>maven-surefire-plugin</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
    &lt;configuration&gt;
        &lt;argLine&gt;
            --add-opens java.base/java.lang.reflect=rxmicro.reflection <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;/argLine&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>- It is necessary to add this <code>opens</code> instruction.</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-component-alternatives-ambiguty-resolving" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-component-alternatives-ambiguty-resolving</code></a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ambiguity_resolving_algorithm"><a class="anchor" href="#ambiguity_resolving_algorithm"></a><a class="link" href="#ambiguity_resolving_algorithm">3.5.2. Ambiguity Resolving Algorithm</a></h4>
<div class="paragraph">
<p>To resolve ambiguities, the RxMicro framework uses the following algorithm:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For each tested component, a search for injection candidates is performed.</p>
</li>
<li>
<p>As a result, a map is formed with a user type as its key and a list of candidates for injection as its value.
<strong>(The RxMicro framework does not support polymorphism rules when injecting alternatives.
Thus, the alternative of the <code>A</code> type can only be injected in the field with the <code>A</code> type)</strong>.</p>
</li>
<li>
<p>After receiving a map with candidates for injection, the RxMicro framework passes through this map.</p>
</li>
<li>
<p>For each user type, a list of candidates and a list of alternatives is requested.</p>
</li>
<li>
<p>If there is only one alternative and only one candidate for the user type, the RxMicro framework injects this alternative into the candidate field;</p>
</li>
<li>
<p>If more than one alternative and only one candidate is found, the RxMicro framework will throw out an error;</p>
</li>
<li>
<p>If there is more than one candidate and only one alternative, then:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The RxMicro framework analyzes the injection candidate field name:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>if the candidate field name matches the alternative field name, the RxMicro framework injects this alternative;</p>
</li>
<li>
<p>if the candidate field name matches the value of the <code>name</code> parameter of the <code>@Alternative</code> annotation, the RxMicro framework injects this alternative;</p>
</li>
<li>
<p>otherwise this candidate will be skipped;</p>
</li>
</ol>
</div>
</li>
<li>
<p>if no alternative has been injected, the RxMicro framework injects this alternative in <strong>all</strong> candidate fields.<br>
<em>(This is the behavior that occurs in the <a href="#GrandParent2Test-inline"><code>GrandParent2Test</code></a> test.)</em></p>
</li>
</ol>
</div>
</li>
<li>
<p>If there is more than one candidate and more than one alternative, then:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The RxMicro framework analyzes the injection candidate field name:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>if the candidate field name matches the alternative field name, the RxMicro framework injects this alternative;<br>
<em>(In the <a href="#GrandParent3Test-inline"><code>GrandParent3Test</code></a> test, the <code>grandParentBusinessService</code> alternative is injected in the <code>GrandParent</code> component field, because the names of the alternative and component fields are equal.)</em>;</p>
</li>
<li>
<p>if the candidate field name matches the value of the <code>name</code> parameter of the <code>@Alternative</code> annotation, the RxMicro framework injects this alternative;<br>
<em>(In the <a href="#GrandParent3Test-inline"><code>GrandParent3Test</code></a> test, the <code>businessService</code> alternative is injected in the <code>Child</code> component field, because the <code>name</code> parameter of the <code>@Alternative</code> annotation is equal to the <code>childBusinessService</code>.</em> <em>And in the <code>Child</code> class, the field name with the <code>BusinessService</code> type is also equal to the <code>childBusinessService</code>.)</em></p>
</li>
<li>
<p>otherwise this candidate will be skipped;</p>
</li>
</ol>
</div>
</li>
<li>
<p><em>(When more than one candidate and more than one alternative is found, it is possible that none of the alternatives will be injected.)</em></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="cdi_beans_alternatives"><a class="anchor" href="#cdi_beans_alternatives"></a><a class="link" href="#cdi_beans_alternatives">3.6. CDI Beans Alternatives</a></h3>
<div class="paragraph">
<p>If the developer uses the <a href="cdi.html#cdi-section"><code>rxmicro.cdi</code></a> module in the project, then <strong>all</strong> custom components are considered as beans and follow the injection algorithm for the alternatives of the RxMicro components.</p>
</div>
<div class="paragraph">
<p><em>When using the <code>rxmicro.cdi</code> module, <strong>You must always inject dependencies using the CDI mechanism only</strong>:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class ParentComponent {

    @Inject
    ChildComponent childComponent; <i class="conum" data-value="1"></i><b>(1)</b>

    @Inject
    ChildComponentImpl childComponentImpl; <i class="conum" data-value="1"></i><b>(1)</b>

    public String getEnvironment() {
        return childComponent.getValue() + " " + childComponentImpl.getValue();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>ParentComponent</code> class depends on the <code>ChildComponent</code> and <code>ChildComponentImpl</code> components.<br>
<em>(These dependencies are injected using the CDI mechanisms.)</em></td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The above example is a demonstration of the features of alternatives of custom components if <a href="cdi.html#cdi-section"><code>rxmicro.cdi</code></a> module enabled.
That&#8217;s why the <code>ChildComponentImpl</code> implementation is injected in the <code>ParentComponent</code> component.
In real projects, it&#8217;s recommended to inject only interfaces to ensure greater flexibility.</p>
</div>
<div class="paragraph">
<p><em>Please note that since the <code>ChildComponentImpl</code> class implements the <code>ChildComponent</code>  interface, and <a href="cdi.html#cdi-singletons-section">all CDI beans are singletons</a>, the <code>childComponent</code> and <code>childComponentImpl</code> fields will contain references to the same <code>ChildComponentImpl</code> instance!</em></p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class ChildComponentImpl implements ChildComponent {

    public ChildComponentImpl() {
        System.out.println("ChildComponentImpl created"); <i class="conum" data-value="1"></i><b>(1)</b>
    }

    @Override
    public String getValue() {
        return "production";
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When creating the <code>ChildComponentImpl</code> instance, an information message is displayed in the console.<br>
<em>(This message is required to ensure that no real custom instance is created when CDI bean alternatives are used!)</em></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When testing, if no alternatives are created, the tested component uses the real custom component instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroComponentTest(ParentComponent.class)
final class ParentComponent1Test {

    private ParentComponent parentComponent;

    private SystemOut systemOut;

    @Test
    void Should_use_alternatives() {
        assertEquals("production production", parentComponent.getEnvironment());              <i class="conum" data-value="1"></i><b>(1)</b>
        assertEquals("ChildComponentImpl created", systemOut.asString()); <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When invoking the <code>getEnvironment</code> method, the real instances of custom components are used.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When starting the test, only one <code>ChildComponentImpl</code> class instance is created.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When testing, if alternatives are created, the tested component uses them instead of the real custom component instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroComponentTest(ParentComponent.class)
final class ParentComponent2Test {

    private ParentComponent parentComponent;

    @Mock
    @Alternative
    private ChildComponent childComponent;

    @Mock
    @Alternative
    private ChildComponentImpl childComponentImpl;

    private SystemOut systemOut;

    @Test
    void Should_use_alternatives() {
        when(childComponent.getValue()).thenReturn("mock");
        when(childComponentImpl.getValue()).thenReturn("mock");

        assertEquals("mock mock", parentComponent.getEnvironment());   <i class="conum" data-value="1"></i><b>(1)</b>
        assertTrue(
                systemOut.isEmpty(),   <i class="conum" data-value="2"></i><b>(2)</b>
                format("Output not empty: '?'", systemOut.asString())
        );
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When invoking the <code>getEnvironment</code> method, the alternatives of the real custom component instances are used.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When starting the test, the <code>ChildComponentImpl</code> class instance is not created.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using alternatives for complex components, it is possible to use alternatives together with real components:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroComponentTest(ParentComponent.class)
final class ParentComponent3Test {

    private ParentComponent parentComponent;

    @Mock
    @Alternative
    private ChildComponent childComponent;

    private SystemOut systemOut;

    @Test
    void Should_use_alternatives() {
        when(childComponent.getValue()).thenReturn("mock");

        assertEquals("mock production", parentComponent.getEnvironment());                    <i class="conum" data-value="1"></i><b>(1)</b>
        assertEquals("ChildComponentImpl created", systemOut.asString()); <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When invoking the <code>getEnvironment</code> method, an alternative and a real instance are used.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When starting the test, only one <code>ChildComponentImpl</code> class instance is created.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-component-alternatives-cdi" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-component-alternatives-cdi</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-how-it-works-section"><a class="anchor" href="#testing-how-it-works-section"></a><a class="link" href="#testing-how-it-works-section">4. How It Works</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Java 9 has introduced the <a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html" target="_blank" rel="noopener"><code>JPMS</code></a>.</p>
</div>
<div class="paragraph">
<p>This system requires that a developer defines the <code>module-info.java</code> descriptor for each project.
In this descriptor, the developer must describe all the dependencies of the current project.
In the context of the unit module system, the tests required for each project should be configured as a separate module, since they depend on libraries that should not be available in the <code>runtime</code>.
Usually such libraries are unit testing libraries (e.g. <a href="https://junit.org/junit5/" target="_blank" rel="noopener">JUnit 5</a>), mock creation libraries (e.g. <a href="https://site.mockito.org/" target="_blank" rel="noopener">Mockito</a>), etc.</p>
</div>
<div class="paragraph">
<p>When trying to create a separate <code>module-info.java</code> descriptor available only for unit tests, many modern IDEs report an error.</p>
</div>
<div class="paragraph">
<p><strong>Therefore, the simplest and most common solution to this problem is to organize unit tests in the form of
<a href="https://www.logicbig.com/tutorials/core-java-tutorial/modules/automatic-modules.html" target="_blank" rel="noopener">automatic module</a>.<br>
This solution allows You to correct compilation errors, but when starting tests, there will be runtime errors.<br>
To fix runtime errors, when starting the Java virtual machine, You must add
<a href="https://nipafx.dev/five-command-line-options-hack-java-module-system/" target="_blank" rel="noopener">options that configure the Java module system at runtime</a>.</strong></p>
</div>
<div class="paragraph">
<p>In case the tests are run, these options must be added to the <code>maven-surefire-plugin</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.22.1&lt;/version&gt;
    &lt;configuration&gt;
        &lt;argLine&gt;
            @{argLine}
            --add-exports ...
            --add-opens ...
            --patch-module ...
            --add-modules ...
            --add-reads ...
        &lt;/argLine&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The specified configuration options for the Java module system at runtime can also be added using the features of the
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Module.html" target="_blank" rel="noopener"><code>java.lang.Module</code></a> class.</p>
</div>
<div class="paragraph">
<p><strong>In order the developer is relieved of the need to add the necessary options to the <code>maven-surefire-plugin</code> configuration, the RxMicro framework provides a special
<code>io.rxmicro.annotation.processor.RxMicroTestsAnnotationProcessor</code> component.</strong></p>
</div>
<div class="paragraph">
<p>To activate this component, it is necessary to add a new execution to the <code>maven-compiler-plugin</code> configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;execution&gt;
    &lt;id&gt;test-compile&lt;/id&gt;
    &lt;goals&gt;
        &lt;goal&gt;testCompile&lt;/goal&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;/goals&gt;
    &lt;configuration&gt;
        &lt;annotationProcessors&gt;
            &lt;annotationProcessor&gt;
                io.rxmicro.annotation.processor.RxMicroTestsAnnotationProcessor <i class="conum" data-value="2"></i><b>(2)</b>
            &lt;/annotationProcessor&gt;
        &lt;/annotationProcessors&gt;
        &lt;generatedTestSourcesDirectory&gt;
            ${project.build.directory}/generated-test-sources/  <i class="conum" data-value="3"></i><b>(3)</b>
        &lt;/generatedTestSourcesDirectory&gt;
    &lt;/configuration&gt;
&lt;/execution&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The separate configuration is required for the tests, so a new <code>execution</code> must be added.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The annotation processor class that handles the test configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Location of Java classes generated by the <code>RxMicro Test Annotation Processor</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This annotation processor generates one single <code>rxmicro.$$ComponentTestFixer</code> class, that automatically opens access to all packages of the current project to unnamed modules:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class $$ComponentTestFixer {

    static {
        final Module currentModule = $$ComponentTestFixer.class.getModule();
        currentModule.addExports("rxmicro", RX_MICRO_REFLECTION_MODULE);
    }

    public $$ComponentTestFixer() {
        final Module currentModule = getClass().getModule();
        if (currentModule.isNamed()) {
            logInfoTestMessage("Fix the environment for componnet test(s)...");
            final Module unnamedModule = getClass().getClassLoader().getUnnamedModule(); <i class="conum" data-value="1"></i><b>(1)</b>
            final Set&lt;Module&gt; modules = unmodifiableOrderedSet(
                    unnamedModule, RX_MICRO_REFLECTION_MODULE
            );
            for (final Module module : modules) {
                for (final String packageName : currentModule.getPackages()) {
                    currentModule.addOpens(packageName, module); <i class="conum" data-value="2"></i><b>(2)</b>
                    logInfoTestMessage(
                            "opens ?/? to ?", <i class="conum" data-value="3"></i><b>(3)</b>
                            currentModule.getName(),
                            packageName,
                            module.isNamed() ? module.getName() : "ALL-UNNAMED"
                    );
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using the standard Java API, the RxMicro framework retrieves the references to the current and unnamed modules.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Using the features of the <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Module.html" target="_blank" rel="noopener"><code>java.lang.Module</code></a> class, the RxMicro framework opens the full access to all classes from all packages from the current module.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>To inform the developer about the successful performance of the  <code>rxmicro.$$ComponentTestFixer</code> class, the RxMicro framework displays to the console the information that access was successfully provided.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When running different types of tests, sometimes a different configuration of the Java module system is required.
Thus, for each type of test, the RxMicro framework creates a separate class in the <code>rxmicro</code> system package:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Names of generated classes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Test type</strong></th>
<th class="tableblock halign-left valign-top"><strong>Name of the generated class</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST-based microservice test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$$RestBasedMicroServiceTestFixer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Component unit test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$$ComponentTestFixer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST-based microservice integration test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$$IntegrationTestFixer</code></p></td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before starting tests, the RxMicro framework uses a generated class to configure the module system for the test environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">[INFO] -------------------------------------------------------
[INFO]  <strong>T E S T S</strong>
[INFO] -------------------------------------------------------
...
[INFO] Fix the environment for component test(s)...
[INFO] <strong>opens</strong> examples.testing/io.rxmicro.examples.testing to ALL-UNNAMED <i class="conum" data-value="1"></i><b>(1)</b>
[INFO] <strong>opens</strong> examples.testing/rxmicro to ALL-UNNAMED
[INFO] Running <strong>io.rxmicro.examples.testing.ParentComponent1Test</strong> <i class="conum" data-value="2"></i><b>(2)</b>
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.278 s
[INFO] Running <strong>io.rxmicro.examples.testing.ParentComponent2Test</strong>
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.378 s
[INFO]
[INFO] Results:
[INFO]
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] <strong>BUILD SUCCESS</strong>
[INFO] ------------------------------------------------------------------------</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All packages of the current module are opened before starting tests.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>After configuring the module system for the test environment, Unit tests are started.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Thus, for the successful writing of tests using the RxMicro framework, besides adding the required libraries, do not forget to configure the <code>maven-compiler-plugin</code> by adding the following annotation processor for the test environment: <code>io.rxmicro.annotation.processor.RxMicroTestsAnnotationProcessor</code>.</strong></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="testing-before-test-section"><a class="anchor" href="#testing-before-test-section"></a><a class="link" href="#testing-before-test-section">5. The <code>@BeforeThisTest</code> and <code>@BeforeIterationMethodSource</code> Annotations</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to perform any actions before invoking the test method, the
<a href="https://junit.org/junit5/" target="_blank" rel="noopener">JUnit 5</a> framework provides a special <a href="https://junit.org/junit5/docs/current/user-guide/api/org.junit.jupiter.api/org/junit/jupiter/api/BeforeEach.html" target="_blank" rel="noopener"><code>@BeforeEach</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>According to the working rules of the <a href="https://junit.org/junit5/" target="_blank" rel="noopener">JUnit 5</a> framework, if the test class contains a method annotated by the
<a href="https://junit.org/junit5/docs/current/user-guide/api/org.junit.jupiter.api/org/junit/jupiter/api/BeforeEach.html" target="_blank" rel="noopener"><code>@BeforeEach</code></a> annotation, then this method should be invoked before invoking each test method in the test class.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the possibilities of using the <a href="https://junit.org/junit5/docs/current/user-guide/api/org.junit.jupiter.api/org/junit/jupiter/api/BeforeEach.html" target="_blank" rel="noopener"><code>@BeforeEach</code></a> annotation.
We&#8217;ll use the example of a project consisting of two components: ChildComponent interface and ParentComponent class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface ChildComponent {

    String getValue();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class ParentComponent {

    private final ChildComponent childComponent = () -&gt; "production";

    public String getEnvironment() {
        return childComponent.getValue();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the mock alternative, it is possible to program the behavior in the method annotated by the <a href="https://junit.org/junit5/docs/current/user-guide/api/org.junit.jupiter.api/org/junit/jupiter/api/BeforeEach.html" target="_blank" rel="noopener"><code>@BeforeEach</code></a> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroComponentTest(ParentComponent.class)
final class ParentComponent1Test {

    private ParentComponent parentComponent;

    @Mock
    @Alternative
    private ChildComponent childComponent;

    <i class="conum" data-value="1"></i><b>(1)</b>
    @BeforeEach
    void beforeEach() {
        when(childComponent.getValue()).thenReturn("mock");
    }

    @Test
    void Should_use_alternative() {
        assertEquals("mock", parentComponent.getEnvironment());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Since the <code>beforeEach()</code> method will be surely invoked by the <a href="https://junit.org/junit5/" target="_blank" rel="noopener">JUnit 5</a>
framework before invoking the <code>Should_use_alternative()</code> test method, the programmed mock behavior will be used during the test;</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The weak point in using the method annotated by the <a href="https://junit.org/junit5/docs/current/user-guide/api/org.junit.jupiter.api/org/junit/jupiter/api/BeforeEach.html" target="_blank" rel="noopener"><code>@BeforeEach</code></a>
annotation, is that it is impossible to program different behavior for two or more test methods in the same class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BeforeEach
void beforeEach() {
    when(childComponent.getValue()).thenReturn("mock");
}

@Test
void Should_use_alternative1() {
    assertEquals("mock1", parentComponent.getEnvironment()); // failed
}

@Test
void Should_use_alternative2() {
    assertEquals("mock2", parentComponent.getEnvironment()); // failed
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The standard solution to this problem consists in programming behavior in the test method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
void Should_use_alternative1() {
    when(childComponent.getValue()).thenReturn("mock1");
    assertEquals("mock1", parentComponent.getEnvironment());
}

@Test
void Should_use_alternative2() {
    when(childComponent.getValue()).thenReturn("mock2");
    assertEquals("mock2", parentComponent.getEnvironment());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the alternative configuration in the test method is not always convenient.<br>
<strong>This can cause a problem, especially when it is necessary to configure the RxMicro component alternative before its registration in the runtime container!</strong></p>
</div>
<div class="paragraph">
<p>To solve this problem, the RxMicro framework provides two additional annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/BeforeThisTest.java" target="_blank" rel="noopener"><code>@BeforeThisTest</code></a>;</p>
</li>
<li>
<p><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/BeforeIterationMethodSource.java" target="_blank" rel="noopener"><code>@BeforeIterationMethodSource</code></a>;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/BeforeThisTest.java" target="_blank" rel="noopener"><code>@BeforeThisTest</code></a>
annotation allows You to specify the method to be invoked before invoking a specific test method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroComponentTest(ParentComponent.class)
final class ParentComponent4Test {

    private ParentComponent parentComponent;

    @Mock
    @Alternative
    private ChildComponent childComponent;

    void beforeTest1() { <i class="conum" data-value="1"></i><b>(1)</b>
        when(childComponent.getValue()).thenReturn("mock1");
    }

    @Test
    <i class="conum" data-value="2"></i><b>(2)</b>
    @BeforeThisTest(method = "beforeTest1")
    void Should_use_alternative1() {
        assertEquals("mock1", parentComponent.getEnvironment());
    }

    void beforeTest2() {
        when(childComponent.getValue()).thenReturn("mock2");
    }

    @Test
    @BeforeThisTest(method = "beforeTest2")
    void Should_use_alternative2() {
        assertEquals("mock2", parentComponent.getEnvironment());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>To configure the mock alternative, it is necessary to create a method in the test class.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If this method needs to be invoked before the test method, it is necessary to specify the name of this method using the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/BeforeThisTest.java" target="_blank" rel="noopener"><code>@BeforeThisTest</code></a> annotation.<br>
<em>(The <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/BeforeThisTest.java" target="_blank" rel="noopener"><code>@BeforeThisTest</code></a> annotation must annotate the test method!)</em>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When creating parametrized tests, it is necessary to use the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/BeforeIterationMethodSource.java" target="_blank" rel="noopener"><code>@BeforeIterationMethodSource</code></a>
annotation instead of the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/BeforeThisTest.java" target="_blank" rel="noopener"><code>@BeforeThisTest</code></a> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroComponentTest(ParentComponent.class)
final class ParentComponent5Test {

    private ParentComponent parentComponent;

    @Mock
    @Alternative
    private ChildComponent childComponent;

    void beforeEachPreparer1() {
        when(childComponent.getValue()).thenReturn(new BigDecimal("23").toString());
    }

    void beforeEachPreparer2() {
        when(childComponent.getValue()).thenReturn("23");
    }

    @ParameterizedTest
    <i class="conum" data-value="1"></i><b>(1)</b>
    @BeforeIterationMethodSource(methods = {
            "beforeEachPreparer1",
            "beforeEachPreparer2"
    })
    void Should_use_alternative2(final String method) { <i class="conum" data-value="2"></i><b>(2)</b>
        assertEquals("23", parentComponent.getEnvironment());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using the <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/BeforeIterationMethodSource.java" target="_blank" rel="noopener"><code>@BeforeIterationMethodSource</code></a>
annotation, the developer specifies an array of methods.
Each method in this array must be invoked before executing a new iteration of the parameterized test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>For reporting it is recommended to specify the <code>final String method</code> parameter of the parameterized test.
This parameter is not used in the test, but if it is present, the <a href="https://junit.org/junit5/" target="_blank" rel="noopener">JUnit 5</a> framework automatically passes the method name to it.
Thus, in the execution report of the parameterized test, for each iteration the method that was invoked before execution of this iteration will be specified.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-component-before-test" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-component-before-test</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="testing-rest-based-microservice-tests-section"><a class="anchor" href="#testing-rest-based-microservice-tests-section"></a><a class="link" href="#testing-rest-based-microservice-tests-section">6. REST-based Microservice Testing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The REST-based microservice test is a standard Unit test that tests only the source code of a microservice.
If the current microservice depends on external services (e.g. database, other REST-based microservices, etc.), then it is allowed to use mocks for these external services during its testing.
If several REST-based microservices need to be tested, it is recommended to use the <a href="#testing-integration-tests-section">REST-based microservice integration testing</a>.</p>
</div>
<div class="paragraph">
<p>For easy writing of microservice tests, the RxMicro framework provides:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The additional <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/RxMicroRestBasedMicroServiceTest.java" target="_blank" rel="noopener"><code>@RxMicroRestBasedMicroServiceTest</code></a> annotation, that informs the RxMicro framework about the need to start the tested REST-based microservice and prepare the environment to execute test HTTP requests.</p>
</li>
<li>
<p>A special <strong>blocking</strong> HTTP client to execute HTTP requests during testing:
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/BlockingHttpClient.java" target="_blank" rel="noopener"><code>BlockingHttpClient</code></a>.</p>
</li>
<li>
<p>The <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/SystemOut.java" target="_blank" rel="noopener"><code>SystemOut</code></a> interface for easy console access.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For each microservice test, the RxMicro framework performs the following actions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Before starting all the test methods in the class:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>checks the test class for compliance with the rules of REST-based microservice testing defined by the RxMicro framework;</p>
</li>
<li>
<p>starts an HTTP server on a random free port;</p>
</li>
<li>
<p>creates an instance of the <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/BlockingHttpClient.java" target="_blank" rel="noopener"><code>BlockingHttpClient</code></a> type;</p>
</li>
<li>
<p>connects the created <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/BlockingHttpClient.java" target="_blank" rel="noopener"><code>BlockingHttpClient</code></a> to the running HTTP server.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Before starting each test method:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>if necessary, invokes the methods defined using the <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/BeforeThisTest.java" target="_blank" rel="noopener"><code>@BeforeThisTest</code></a>
or <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/BeforeIterationMethodSource.java" target="_blank" rel="noopener"><code>@BeforeIterationMethodSource</code></a> annotations;</p>
</li>
<li>
<p>if necessary, registers the RxMicro component alternatives in the RxMicro container;</p>
</li>
<li>
<p>registers the tested REST-based microservice on the running HTTP server;</p>
</li>
<li>
<p>if necessary, injects the custom component alternatives to the REST-based microservice;</p>
</li>
<li>
<p>injects a reference to the <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/BlockingHttpClient.java" target="_blank" rel="noopener"><code>BlockingHttpClient</code></a> instance into the test class;</p>
</li>
<li>
<p>if necessary, creates the <code>System.out</code> mock, and injects it into the test class.</p>
</li>
</ol>
</div>
</li>
<li>
<p>After performing each test method:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>deletes all registered components from the RxMicro container;</p>
</li>
<li>
<p>deletes all registered REST-based microservices on the running HTTP server;</p>
</li>
<li>
<p>if necessary, restores the <code>System.out</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>After performing all the tests in the class:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>clears the resources of the <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/BlockingHttpClient.java" target="_blank" rel="noopener"><code>BlockingHttpClient</code></a> component;</p>
</li>
<li>
<p>stops the HTTP server and releases the selected resources.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="basic_principles"><a class="anchor" href="#basic_principles"></a><a class="link" href="#basic_principles">6.1. Basic Principles</a></h3>
<div class="paragraph">
<p>To understand the REST-based microservice testing principles, let&#8217;s create the simplest microservice that returns the <code>"Hello World!"</code> message.</p>
</div>
<div class="paragraph">
<p>Since the microservice will return a JSON object, it is necessary to create a response model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class Response {

    final String message;

    public Response(final String message) {
        this.message = requireNonNull(message);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When there is the <code>GET</code> request to the microservice, it should return the <code>"Hello World!"</code> message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final class MicroService {

    @GET("/")
    CompletableFuture&lt;Response&gt; get() {
        return completedFuture(new Response("Hello World!"));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The testing process of the REST-based microservice is to perform an HTTP request after the RxMicro framework starts the tested microservice on the HTTP server.
After receiving a response from the microservice, this response is compared to the expected response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><i class="conum" data-value="1"></i><b>(1)</b>
@RxMicroRestBasedMicroServiceTest(MicroService.class)
class MicroServiceTest {

    private BlockingHttpClient blockingHttpClient; <i class="conum" data-value="2"></i><b>(2)</b>

    @Test
    void Should_handle_GET_request() {
        final ClientHttpResponse response = blockingHttpClient.get("/");

        assertEquals(jsonObject("message", "Hello World!"), response.getBody()); <i class="conum" data-value="3"></i><b>(3)</b>
        assertEquals(200, response.getStatusCode());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>To start the HTTP server and register the tested REST-based microservice, it is necessary to annotate the test class by the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/RxMicroRestBasedMicroServiceTest.java" target="_blank" rel="noopener"><code>@RxMicroRestBasedMicroServiceTest</code></a> annotation.
In the parameter of this annotation it is specified which REST-based microservice class will be tested in the current test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>To execute <strong>blocking</strong> HTTP requests, the RxMicro framework supports the special
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/BlockingHttpClient.java" target="_blank" rel="noopener"><code>BlockingHttpClient</code></a> component.
The developer must declare a reference to this component, and while starting the test, the RxMicro framework will automatically inject the created
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/BlockingHttpClient.java" target="_blank" rel="noopener"><code>BlockingHttpClient</code></a> class instance, using the <code>reflection</code> mechanism.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Upon receiving the HTTP response from the microservice, the developer should compare the response body with the expected result in the test.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To get additional info about writing tests that require JSON object comparison, please read <a href="core.html#core-json-rxmicro-json-module-usage"><code>rxmicro.json</code> Module Usage</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-microservice-basic" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-microservice-basic</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When compiling, the RxMicro framework searches for <code>RxMicro Annotations</code> in the source code and generates additional classes necessary for the integral work of the microservice.</p>
</div>
<div class="paragraph">
<p><strong>When changing the <code>RxMicro Annotations</code> in the source code, DON&#8217;T FORGET to recompile the ALL source code, not just the changed file, for the changes to take effect:</strong> <code>mvn clean compile</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="testing-rest-based-microservice-tests-complex-alternative-usage-section"><a class="anchor" href="#testing-rest-based-microservice-tests-complex-alternative-usage-section"></a><a class="link" href="#testing-rest-based-microservice-tests-complex-alternative-usage-section">6.2. Features of Testing Complex Microservices that use Alternatives</a></h3>
<div class="sect3">
<h4 id="features_of_rest_client_testing"><a class="anchor" href="#features_of_rest_client_testing"></a><a class="link" href="#features_of_rest_client_testing">6.2.1. Features of REST Client Testing</a></h4>
<div class="paragraph">
<p>This section will cover the features of testing REST-based microservices that use REST clients.</p>
</div>
<div class="paragraph">
<p>The source code of such REST-based microservice consists of the <code>Response</code> model class, <code>ExternalMicroService</code> REST client and <code>ConsumeMicroService</code> HTTP request handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class Response {

    String message;

    public Response(final String message) {
        this.message = requireNonNull(message);
    }

    public Response() {
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RestClient
public interface ExternalMicroService {

    @GET("/")
    CompletableFuture&lt;Response&gt; get();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final class MicroService {

    private final ExternalMicroService externalMicroService =
            getRestClient(ExternalMicroService.class);

    @GET("/")
    CompletableFuture&lt;Response&gt; get() {
        return externalMicroService.get();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most logical way to test such microservice is to create a mock alternative for the <code>ExternalMicroService</code> component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroRestBasedMicroServiceTest(MicroService.class)
final class MicroServiceBusinessLogicOnlyTest {

    private BlockingHttpClient blockingHttpClient;

    @Mock
    @Alternative
    private ExternalMicroService externalMicroService;

    @Test
    void Should_delegate_call_to_ExternalMicroService() {
        when(externalMicroService.get()).thenReturn(completedFuture(new Response("mock")));

        final ClientHttpResponse response = blockingHttpClient.get("/");

        assertEquals(jsonObject("message", "mock"), response.getBody());
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To get additional info about writing tests that require JSON object comparison, please read <a href="core.html#core-json-rxmicro-json-module-usage"><code>rxmicro.json</code> Module Usage</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>But if on the basis of such test we build the source code coverage report, this report will show a low degree of coverage:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/testing/microservice/alternative/rest-client/jacoco-business-logic-only.jpg" alt="jacoco business logic only">
</div>
<div class="title">Figure 1. The test coverage report when using a mock alternative for REST client.</div>
</div>
<div class="paragraph">
<p>Such a result is caused by the fact that after creating a mock alternative for the <code>ExternalMicroService</code> component, the classes generated by the RxMicro framework are not used in the testing process for the REST client work.</p>
</div>
<div class="paragraph">
<p>If such a result is not acceptable, it is necessary to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>create a mock alternative to the <code>HttpClientFactory</code> RxMicro component;</p>
</li>
<li>
<p>use the static methods of the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-mockito/src/main/java/io/rxmicro/test/mockito/httpclient/HttpClientMockFactory.java" target="_blank" rel="noopener"><code>HttpClientMockFactory</code></a> class to program the mock behavior.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroRestBasedMicroServiceTest(MicroService.class)
final class MicroServiceWithAllGeneratedCodeTest {

    private BlockingHttpClient blockingHttpClient;

    @Mock
    @Alternative
    private HttpClientFactory httpClientFactory;

    void prepareExternalMicroServiceHttpClient() {
        prepareHttpClientMock(
                httpClientFactory,
                new HttpRequestMock.Builder()
                        .setMethod(GET)
                        .setPath("/")
                        .build(),
                jsonObject("message", "mock")
        );
    }

    @Test
    @BeforeThisTest(method = "prepareExternalMicroServiceHttpClient")
    void Should_delegate_call_to_ExternalMicroService() {
        final ClientHttpResponse response = blockingHttpClient.get("/");

        assertEquals(jsonObject("message", "mock"), response.getBody());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The modified test shows a coverage rate of 100%:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/testing/microservice/alternative/rest-client/jacoco-all-generated.jpg" alt="jacoco all generated">
</div>
<div class="title">Figure 2. The test coverage report when using the <code>HttpClientFactory</code> mock alternative.</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-microservice-alternatives-rest-client" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-microservice-alternatives-rest-client</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When compiling, the RxMicro framework searches for <code>RxMicro Annotations</code> in the source code and generates additional classes necessary for the integral work of the microservice.</p>
</div>
<div class="paragraph">
<p><strong>When changing the <code>RxMicro Annotations</code> in the source code, DON&#8217;T FORGET to recompile the ALL source code, not just the changed file, for the changes to take effect:</strong> <code>mvn clean compile</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="features_of_testing_mongo_repositories"><a class="anchor" href="#features_of_testing_mongo_repositories"></a><a class="link" href="#features_of_testing_mongo_repositories">6.2.2. Features of Testing Mongo Repositories</a></h4>
<div class="paragraph">
<p>This section will cover the features of testing REST-based microservices that use mongo repositories.</p>
</div>
<div class="paragraph">
<p>The source code of such REST-based microservice consists of the <code>Entity</code> entity model, <code>Response</code> model class, <code>DataRepository</code> mongo repository and <code>ConsumeMicroService</code> HTTP request handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class Response {

    final String message;

    public Response(final String message) {
        this.message = requireNonNull(message);
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class Entity {

    String data;

    public String getData() {
        return data;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@MongoRepository(collection = "collection")
public interface DataRepository {

    @Find(query = "{_id: ?}")
    CompletableFuture&lt;Optional&lt;Entity&gt;&gt; findById(long id);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final class MicroService {

    private final DataRepository dataRepository =
            getRepository(DataRepository.class);

    @GET("/")
    CompletableFuture&lt;Optional&lt;Response&gt;&gt; get(final Long id) {
        return dataRepository.findById(id).thenApply(optionalEntity -&gt;
                optionalEntity.map(entity -&gt;
                        new Response(entity.getData())));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most logical way to test such microservice is to create a mock alternative for the <code>DataRepository</code> component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroRestBasedMicroServiceTest(MicroService.class)
final class MicroServiceBusinessLogicOnlyTest {

    private BlockingHttpClient blockingHttpClient;

    @Mock
    @Alternative
    private DataRepository dataRepository;

    @Mock
    private Entity entity;

    @Test
    void Should_return_Entity_data() {
        when(entity.getData())
                .thenReturn("data");
        when(dataRepository.findById(1))
                .thenReturn(completedFuture(Optional.of(entity)));

        final ClientHttpResponse response = blockingHttpClient.get("/?id=1");

        assertEquals(jsonObject("message", "data"), response.getBody());
        assertEquals(200, response.getStatusCode());
    }

    @Test
    void Should_return_Not_Found_error() {
        when(dataRepository.findById(1))
                .thenReturn(completedFuture(Optional.empty()));

        final ClientHttpResponse response = blockingHttpClient.get("/?id=1");

        assertEquals(jsonObject("message", "Not Found"), response.getBody());
        assertEquals(404, response.getStatusCode());
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To get additional info about writing tests that require JSON object comparison, please read <a href="core.html#core-json-rxmicro-json-module-usage"><code>rxmicro.json</code> Module Usage</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>But if on the basis of such test we build the source code coverage report, this report will show a low degree of coverage:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/testing/microservice/alternative/mongo-repo/jacoco-business-logic-only.jpg" alt="jacoco business logic only">
</div>
<div class="title">Figure 3. The test coverage report when using a mock alternative for Mongo repository.</div>
</div>
<div class="paragraph">
<p>Such a result is caused by the fact that after creating a mock alternative for the <code>DataRepository</code> component, the classes generated by the RxMicro framework are not used in the testing process for the mongo repository work.</p>
</div>
<div class="paragraph">
<p>If such a result is not acceptable, it is necessary to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>create a mock alternative to the <code>MongoDatabase</code> RxMicro component;</p>
</li>
<li>
<p>use the static methods of the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-mockito/src/main/java/io/rxmicro/test/mockito/mongo/MongoMockFactory.java" target="_blank" rel="noopener"><code>MongoMockFactory</code></a> class to program the mock behavior.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroRestBasedMicroServiceTest(MicroService.class)
final class MicroServiceWithAllGeneratedCodeTest {

    private static final FindOperationMock FIND_OPERATION_MOCK =
            new FindOperationMock.Builder()
                    .setAnyQuery()
                    //.setQuery("{_id: 1}")
                    .build();

    private BlockingHttpClient blockingHttpClient;

    @Mock
    @Alternative
    private MongoDatabase mongoDatabase;

    void prepareOneEntityFound() {
        prepareMongoOperationMocks(
                mongoDatabase,
                "collection",
                FIND_OPERATION_MOCK,
                new Document("data", "data")
        );
    }

    @Test
    @BeforeThisTest(method = "prepareOneEntityFound")
    void Should_return_Entity_data() {
        final ClientHttpResponse response = blockingHttpClient.get("/?id=1");

        assertEquals(jsonObject("message", "data"), response.getBody());
        assertEquals(200, response.getStatusCode());
    }

    void prepareNoEntityFound() {
        prepareMongoOperationMocks(
                mongoDatabase,
                "collection",
                FIND_OPERATION_MOCK
        );
    }

    @Test
    @BeforeThisTest(method = "prepareNoEntityFound")
    void Should_return_Not_Found_error() {
        final ClientHttpResponse response = blockingHttpClient.get("/?id=1");

        assertEquals(jsonObject("message", "Not Found"), response.getBody());
        assertEquals(404, response.getStatusCode());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The modified test shows a coverage rate of 100%:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/testing/microservice/alternative/mongo-repo/jacoco-all-generated.jpg" alt="jacoco all generated">
</div>
<div class="title">Figure 4. The test coverage report when using the <code>MongoDatabase</code> mock alternative.</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-microservice-alternatives-mongo-repository" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-microservice-alternatives-mongo-repository</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When compiling, the RxMicro framework searches for <code>RxMicro Annotations</code> in the source code and generates additional classes necessary for the integral work of the microservice.</p>
</div>
<div class="paragraph">
<p><strong>When changing the <code>RxMicro Annotations</code> in the source code, DON&#8217;T FORGET to recompile the ALL source code, not just the changed file, for the changes to take effect:</strong> <code>mvn clean compile</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="features_of_testing_postgres_repositories"><a class="anchor" href="#features_of_testing_postgres_repositories"></a><a class="link" href="#features_of_testing_postgres_repositories">6.2.3. Features of Testing Postgres Repositories</a></h4>
<div class="paragraph">
<p>This section will cover the features of testing REST-based microservices that use postgres repositories.</p>
</div>
<div class="paragraph">
<p>The source code of such REST-based microservice consists of the <code>Entity</code> entity model, <code>Response</code> model class, <code>DataRepository</code> mongo repository and <code>ConsumeMicroService</code> HTTP request handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class Response {

    final String message;

    public Response(final String message) {
        this.message = requireNonNull(message);
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Table
public final class Entity {

    @Column(length = Column.UNLIMITED_LENGTH)
    String data;

    public String getData() {
        return data;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@PostgreSQLRepository
public interface DataRepository {

    @Select("SELECT data FROM ${table} WHERE id=?")
    CompletableFuture&lt;Optional&lt;Entity&gt;&gt; findById(long id);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final class MicroService {

    private final DataRepository dataRepository = getRepository(DataRepository.class);

    @GET("/")
    CompletableFuture&lt;Optional&lt;Response&gt;&gt; get(final Long id) {
        return dataRepository.findById(id).thenApply(optionalEntity -&gt;
                optionalEntity.map(entity -&gt;
                        new Response(entity.getData())));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most logical way to test such microservice is to create a mock alternative for the <code>DataRepository</code> component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroRestBasedMicroServiceTest(MicroService.class)
final class MicroServiceBusinessLogicOnlyTest {

    private BlockingHttpClient blockingHttpClient;

    @Mock
    @Alternative
    private DataRepository dataRepository;

    @Mock
    private Entity entity;

    @Test
    void Should_return_Entity_data() {
        when(entity.getData())
                .thenReturn("data");
        when(dataRepository.findById(1))
                .thenReturn(completedFuture(Optional.of(entity)));

        final ClientHttpResponse response = blockingHttpClient.get("/?id=1");

        assertEquals(jsonObject("message", "data"), response.getBody());
        assertEquals(200, response.getStatusCode());
    }

    @Test
    void Should_return_Not_Found_error() {
        when(dataRepository.findById(1))
                .thenReturn(completedFuture(Optional.empty()));

        final ClientHttpResponse response = blockingHttpClient.get("/?id=1");

        assertEquals(jsonObject("message", "Not Found"), response.getBody());
        assertEquals(404, response.getStatusCode());
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To get additional info about writing tests that require JSON object comparison, please read <a href="core.html#core-json-rxmicro-json-module-usage"><code>rxmicro.json</code> Module Usage</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>But if on the basis of such test we build the source code coverage report, this report will show a low degree of coverage:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/testing/microservice/alternative/postgresql-repo/jacoco-business-logic-only.jpg" alt="jacoco business logic only">
</div>
<div class="title">Figure 5. The test coverage report when using a mock alternative for Postgresql repository.</div>
</div>
<div class="paragraph">
<p>Such a result is caused by the fact that after creating a mock alternative for the <code>DataRepository</code> component, the classes generated by the RxMicro framework are not used in the testing process for the postgres repository work.</p>
</div>
<div class="paragraph">
<p>If such a result is not acceptable, it is necessary to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>create a mock alternative to the <code>ConnectionPool</code> RxMicro component;</p>
</li>
<li>
<p>use the static methods of the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-mockito/src/main/java/io/rxmicro/test/mockito/r2dbc/SQLMockFactory.java" target="_blank" rel="noopener"><code>SQLMockFactory</code></a> class to program the mock behavior.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroRestBasedMicroServiceTest(MicroService.class)
final class MicroServiceWithAllGeneratedCodeTest {

    private static final SQLQueryWithParamsMock SQL_PARAMS_MOCK =
            new SQLQueryWithParamsMock.Builder()
                    .setAnySql()
                    //.setSql("SELECT data FROM entity WHERE id = $1")
                    //.setBindParams(1L)
                    .build();

    private BlockingHttpClient blockingHttpClient;

    @Mock
    @Alternative
    private ConnectionPool connectionPool;

    void prepareOneEntityFound() {
        prepareSQLOperationMocks(
                connectionPool,
                SQL_PARAMS_MOCK,
                "data"
        );
    }

    @Test
    @BeforeThisTest(method = "prepareOneEntityFound")
    void Should_return_Entity_data() {
        final ClientHttpResponse response = blockingHttpClient.get("/?id=1");

        assertEquals(jsonObject("message", "data"), response.getBody());
        assertEquals(200, response.getStatusCode());
    }

    void prepareNoEntityFound() {
        prepareSQLOperationMocks(
                connectionPool,
                SQL_PARAMS_MOCK,
                List.of()
        );
    }

    @Test
    @BeforeThisTest(method = "prepareNoEntityFound")
    void Should_return_Not_Found_error() {
        final ClientHttpResponse response = blockingHttpClient.get("/?id=1");

        assertEquals(jsonObject("message", "Not Found"), response.getBody());
        assertEquals(404, response.getStatusCode());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The modified test shows a coverage rate of 100%:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/testing/microservice/alternative/postgresql-repo/jacoco-all-generated.jpg" alt="jacoco all generated">
</div>
<div class="title">Figure 6. The test coverage report when using the <code>ConnectionPool</code> mock alternative.</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-microservice-alternatives-postgres-repository" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-microservice-alternatives-postgres-repository</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When compiling, the RxMicro framework searches for <code>RxMicro Annotations</code> in the source code and generates additional classes necessary for the integral work of the microservice.</p>
</div>
<div class="paragraph">
<p><strong>When changing the <code>RxMicro Annotations</code> in the source code, DON&#8217;T FORGET to recompile the ALL source code, not just the changed file, for the changes to take effect:</strong> <code>mvn clean compile</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom_and_the_rxmicro_framework_code_execution_order"><a class="anchor" href="#custom_and_the_rxmicro_framework_code_execution_order"></a><a class="link" href="#custom_and_the_rxmicro_framework_code_execution_order">6.3. Custom and the RxMicro Framework Code Execution Order</a></h3>
<div class="paragraph">
<p>For efficient writing of Rest-based microservice tests, it is necessary to know the execution order of user, and the RxMicro framework code.</p>
</div>
<div class="paragraph">
<p>When testing a Rest-based microservice, using the following test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroRestBasedMicroServiceTest(MicroService.class)
final class MicroServiceTest {

    @BeforeAll
    static void beforeAll() {
    }

    private BlockingHttpClient blockingHttpClient;

    private SystemOut systemOut;

    @Mock
    @Alternative
    private BusinessService businessService;

    public MicroServiceTest() {
    }

    @BeforeEach
    void beforeEach() {
    }

    void beforeTest1UserMethod() {
    }

    @Test
    @BeforeThisTest(method = "beforeTest1UserMethod")
    void test1() {
    }

    void beforeTest2UserMethod() {
    }

    @Test
    @BeforeThisTest(method = "beforeTest2UserMethod")
    void test2() {
    }

    @AfterEach
    void afterEach() {
    }

    @AfterAll
    static void afterAll() {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the execution order will be as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"><strong>RX-MICRO:</strong> Test class validated.
<strong>RX-MICRO:</strong> HTTP server started without any REST-based microservices using random free port.
<strong>RX-MICRO:</strong> Blocking HTTP client created and connected to the started HTTP server.
<strong>USER-TEST:</strong> '@org.junit.jupiter.api.BeforeAll' invoked.

<strong>USER-TEST:</strong> new instance of the REST-based microservice test class created.
<strong>MOCKITO:</strong> All mocks created and injected.
<strong>RX-MICRO:</strong> Alternatives of the RxMicro components registered in the RxMicro runtime containers.
<strong>RX-MICRO:</strong> Blocking HTTP client injected to the instance of the test class.
<strong>RX-MICRO:</strong> SystemOut instance created and injected to the instance of the test class.
<strong>USER-TEST:</strong> '@org.junit.jupiter.api.BeforeEach' invoked.
<strong>USER-TEST:</strong> 'beforeTest1UserMethod' invoked.
<strong>RX-MICRO:</strong> Current REST-based microservice instance created and registered in the HTTP server.
<strong>RX-MICRO:</strong> Alternatives of the user components injected to the REST-based microservice instance.
<strong>USER-TEST:</strong> 'test1()' invoked.
<strong>USER-TEST:</strong> '@org.junit.jupiter.api.AfterEach' invoked.
<strong>RX-MICRO:</strong> All registered alternatives removed from the RxMicro runtime containers.
<strong>RX-MICRO:</strong> Current REST-based microservice instance unregistered from the HTTP server.
<strong>RX-MICRO:</strong> System.out reset.
<strong>MOCKITO:</strong> All mocks destroyed.

<strong>USER-TEST:</strong> new instance of the REST-based microservice test class created.
<strong>MOCKITO:</strong> All mocks created and injected.
<strong>RX-MICRO:</strong> Alternatives of the RxMicro components registered in the RxMicro runtime containers.
<strong>RX-MICRO:</strong> Blocking HTTP client injected to the instance of the test class.
<strong>RX-MICRO:</strong> SystemOut instance created and injected to the instance of the test class.
<strong>USER-TEST:</strong> '@org.junit.jupiter.api.BeforeEach' invoked.
<strong>USER-TEST:</strong> 'beforeTest2UserMethod' invoked.
<strong>RX-MICRO:</strong> Current REST-based microservice instance created and registered in the HTTP server.
<strong>RX-MICRO:</strong> Alternatives of the user components injected to the REST-based microservice instance.
<strong>USER-TEST:</strong> 'test2()' invoked.
<strong>USER-TEST:</strong> '@org.junit.jupiter.api.AfterEach' invoked.
<strong>RX-MICRO:</strong> All registered alternatives removed from the RxMicro runtime containers.
<strong>RX-MICRO:</strong> Current REST-based microservice instance unregistered from the HTTP server.
<strong>RX-MICRO:</strong> System.out reset.
<strong>MOCKITO:</strong> All mocks destroyed.

<strong>USER-TEST:</strong> '@org.junit.jupiter.api.AfterAll' invoked.
<strong>RX-MICRO:</strong> Blocking HTTP client released.
<strong>RX-MICRO:</strong> HTTP server stopped.</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above execution order of user, and the RxMicro framework code the following clarifications are implied:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>MOCKITO</code> prefix means that the action is activated by the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-mockito-junit/src/main/java/io/rxmicro/test/mockito/junit/InitMocks.java" target="_blank" rel="noopener"><code>@InitMocks</code></a> annotation.</p>
</li>
<li>
<p>The <code>RX-MICRO</code> prefix means that the action is activated by the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/RxMicroRestBasedMicroServiceTest.java" target="_blank" rel="noopener"><code>@RxMicroRestBasedMicroServiceTest</code></a> annotation.</p>
</li>
<li>
<p>The <code>USER-TEST</code> prefix means that at this stage a custom method from the <code>MicroServiceTest</code> class is invoked.</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-component-tests-section"><a class="anchor" href="#testing-component-tests-section"></a><a class="link" href="#testing-component-tests-section">7. Testing of Microservice Components</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="basic_principles_2"><a class="anchor" href="#basic_principles_2"></a><a class="link" href="#basic_principles_2">7.1. Basic Principles</a></h3>
<div class="paragraph">
<p>The basic principles of component testing are covered by the <a href="#testing-alternatives-usage-section">Section 3.3, &#8220;Alternative Usage&#8221;</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="features_of_testing_complex_components_that_use_alternatives"><a class="anchor" href="#features_of_testing_complex_components_that_use_alternatives"></a><a class="link" href="#features_of_testing_complex_components_that_use_alternatives">7.2. Features of Testing Complex Components that Use Alternatives</a></h3>
<div class="paragraph">
<p>The features of testing complex components that use alternatives are the same as for <a href="#testing-rest-based-microservice-tests-complex-alternative-usage-section">REST-based microservice testing</a>.</p>
</div>
<div class="paragraph">
<p>For more information, we recommend that You familiarize yourself with the following examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Features of testing components that use REST clients:</p>
</li>
</ul>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-component-alternatives-rest-client" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-component-alternatives-rest-client</code></a>;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Features of testing components that use mongo repositories:</p>
</li>
</ul>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-component-alternatives-mongo-repository" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-component-alternatives-mongo-repository</code></a>;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Features of testing components that use postgres repositories:</p>
</li>
</ul>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-component-alternatives-postgres-repository" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-component-alternatives-postgres-repository</code></a>;</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="custom_and_the_rxmicro_framework_execution_order"><a class="anchor" href="#custom_and_the_rxmicro_framework_execution_order"></a><a class="link" href="#custom_and_the_rxmicro_framework_execution_order">7.3. Custom and the RxMicro Framework Execution Order</a></h3>
<div class="paragraph">
<p>For efficient writing of component tests, it is necessary to know the execution order of user, and the RxMicro framework code.</p>
</div>
<div class="paragraph">
<p>When testing a component, using the following test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@InitMocks
@RxMicroComponentTest(BusinessService.class)
final class BusinessServiceTest {

    @BeforeAll
    static void beforeAll() {
    }

    private BusinessService businessService;

    private SystemOut systemOut;

    @Mock
    @Alternative
    private BusinessService.ChildBusinessService childBusinessService;

    public BusinessServiceTest() {
    }

    @BeforeEach
    void beforeEach() {
    }

    void beforeTest1UserMethod() {
    }

    @Test
    @BeforeThisTest(method = "beforeTest1UserMethod")
    void test1() {
    }

    void beforeTest2UserMethod() {
    }

    @Test
    @BeforeThisTest(method = "beforeTest2UserMethod")
    void test2() {
    }

    @AfterEach
    void afterEach() {
    }

    @AfterAll
    static void afterAll() {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the execution order will be as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"><strong>RX-MICRO:</strong> Test class validated.
<strong>USER-TEST:</strong> '@org.junit.jupiter.api.BeforeAll' invoked.

<strong>USER-TEST:</strong> new instance of the component test class created.
<strong>MOCKITO:</strong> All mocks created and injected.
<strong>RX-MICRO:</strong> Alternatives of the RxMicro components registered in the RxMicro runtime containers.
<strong>RX-MICRO:</strong> SystemOut instance created and injected to the instance of the test class.
<strong>USER-TEST:</strong> '@org.junit.jupiter.api.BeforeEach' invoked.
<strong>USER-TEST:</strong> 'beforeTest1UserMethod' invoked.
<strong>RX-MICRO:</strong> Tested component instance created, if it is not created by user.
<strong>RX-MICRO:</strong> Alternatives of the user components injected to the tested component instance.
<strong>USER-TEST:</strong> 'test1()' method invoked.
<strong>USER-TEST:</strong> '@org.junit.jupiter.api.AfterEach' invoked.
<strong>RX-MICRO:</strong> All registered alternatives removed from the RxMicro runtime containers.
<strong>RX-MICRO:</strong> System.out reset.
<strong>MOCKITO:</strong> All mocks destroyed.

<strong>USER-TEST:</strong> new instance of the component test class created.
<strong>MOCKITO:</strong> All mocks created and injected.
<strong>RX-MICRO:</strong> Alternatives of the RxMicro components registered in the RxMicro runtime containers.
<strong>RX-MICRO:</strong> SystemOut instance created and injected to the instance of the test class.
<strong>USER-TEST:</strong> '@org.junit.jupiter.api.BeforeEach' invoked.
<strong>USER-TEST:</strong> 'beforeTest2UserMethod' invoked.
<strong>RX-MICRO:</strong> Tested component instance created, if it is not created by user.
<strong>RX-MICRO:</strong> Alternatives of the user components injected to the tested component instance.
<strong>USER-TEST:</strong> 'test2()' method invoked.
<strong>USER-TEST:</strong> '@org.junit.jupiter.api.AfterEach' invoked.
<strong>RX-MICRO:</strong> All registered alternatives removed from the RxMicro runtime containers.
<strong>RX-MICRO:</strong> System.out reset.
<strong>MOCKITO:</strong> All mocks destroyed.

<strong>USER-TEST:</strong> '@org.junit.jupiter.api.AfterAll' invoked.</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above execution order of user, and the RxMicro framework code the following clarifications are implied:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>MOCKITO</code> prefix means that the action is activated by the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-mockito-junit/src/main/java/io/rxmicro/test/mockito/junit/InitMocks.java" target="_blank" rel="noopener"><code>@InitMocks</code></a> annotation.</p>
</li>
<li>
<p>The <code>RX-MICRO</code> prefix means that the action is activated by the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/RxMicroComponentTest.java" target="_blank" rel="noopener"><code>@RxMicroComponentTest</code></a> annotation.</p>
</li>
<li>
<p>The <code>USER-TEST</code> prefix means that at this stage a custom method from the <code>BusinessServiceTest</code> class is invoked.</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-integration-tests-section"><a class="anchor" href="#testing-integration-tests-section"></a><a class="link" href="#testing-integration-tests-section">8. REST-based Microservice Integration Testing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The REST-based microservice integration testing allows You to test a complete system, which can consist of several REST-based microservices.</p>
</div>
<div class="paragraph">
<p>For easy writing of the REST-based microservices integration tests, the RxMicro framework provides:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The additional <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/RxMicroIntegrationTest.java" target="_blank" rel="noopener"><code>@RxMicroIntegrationTest</code></a> annotation, that informs the RxMicro framework about the need to create an HTTP client and inject it into the tested class.</p>
</li>
<li>
<p>A special <strong>blocking</strong> HTTP client to execute HTTP requests during testing:
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/BlockingHttpClient.java" target="_blank" rel="noopener"><code>BlockingHttpClient</code></a>.</p>
</li>
<li>
<p>The <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/SystemOut.java" target="_blank" rel="noopener"><code>SystemOut</code></a> interface for easy console access.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The main differences between integration testing and REST-based microservice testing:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>for integration tests, the RxMicro framework does not run an HTTP server;</p>
</li>
<li>
<p>the developer has to start and stop the system consisting of REST-based microservices;</p>
</li>
<li>
<p>the RxMicro framework does not support alternatives and additional configuration for integration tests;</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="testing-integration-tests-basic-section"><a class="anchor" href="#testing-integration-tests-basic-section"></a><a class="link" href="#testing-integration-tests-basic-section">8.1. Basic Principles</a></h3>
<div class="paragraph">
<p>To demonstrate the features of the integration testing, let&#8217;s look at the following microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class MicroService {

    @GET("/")
    void handle() {
        System.out.println("handle");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The integration test for this microservice will be as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><i class="conum" data-value="1"></i><b>(1)</b>
@RxMicroIntegrationTest
final class MicroServiceIntegrationTest {

    <i class="conum" data-value="2"></i><b>(2)</b>
    private static final int PORT = 55555;

    private static ServerInstance serverInstance;

    <i class="conum" data-value="5"></i><b>(5)</b>
    @BeforeAll
    static void beforeAll() {
        new Configs.Builder()
                .withConfigs(new HttpServerConfig()
                        .setPort(PORT))
                .build(); <i class="conum" data-value="4"></i><b>(4)</b>
        serverInstance = startRestServer(MicroService.class);<i class="conum" data-value="3"></i><b>(3)</b>
    }

    <i class="conum" data-value="6"></i><b>(6)</b>
    @BlockingHttpClientSettings(port = PORT)
    private BlockingHttpClient blockingHttpClient;

    <i class="conum" data-value="7"></i><b>(7)</b>
    private SystemOut systemOut;

    @Test
    void test() {
        final ClientHttpResponse response = blockingHttpClient.get("/");

        assertEquals(200, response.getStatusCode()); <i class="conum" data-value="8"></i><b>(8)</b>
        assertTrue(response.isBodyEmpty(), "Body not empty: " + response.getBody());<i class="conum" data-value="8"></i><b>(8)</b>
        assertEquals("handle", systemOut.asString()); <i class="conum" data-value="9"></i><b>(9)</b>
    }

    @AfterAll
    static void afterAll() throws InterruptedException {
        serverInstance.shutdownAndWait();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/RxMicroIntegrationTest.java" target="_blank" rel="noopener"><code>@RxMicroIntegrationTest</code></a>
annotation informs the RxMicro framework that this test is an integration test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The constant declares the port that will be used to start the HTTP server.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The integration test requires the developer to start the HTTP server manually.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Before running the HTTP server, You must set the necessary HTTP port.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The configuration and start of the HTTP server must be done before running the test method.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Since a port other than the standard HTTP port is used, You need to specify which port the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/BlockingHttpClient.java" target="_blank" rel="noopener"><code>BlockingHttpClient</code></a> component should use for connecting to the HTTP server.
The <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/BlockingHttpClient.java" target="_blank" rel="noopener"><code>BlockingHttpClient</code></a>
component configuration is performed using the special
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/BlockingHttpClientSettings.java" target="_blank" rel="noopener"><code>@BlockingHttpClientSettings</code></a> annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The integration test supports the possibility of creating the <code>System.out</code> mock.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>After receiving a response from the microservice, ensure that the request has been executed successfully.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>After receiving a response from the microservice, ensure that the microservice has sent the specified message to the <code>System.out</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This integration test demonstrates <strong>all</strong> features of the integration test activated by the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/RxMicroIntegrationTest.java" target="_blank" rel="noopener"><code>@RxMicroIntegrationTest</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>Thus, the integration test unlike the REST-based microservice test can only inject a blocking HTTP client and create a mock for the <code>System.out</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To get additional info about writing tests that require JSON object comparison, please read <a href="core.html#core-json-rxmicro-json-module-usage"><code>rxmicro.json</code> Module Usage</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-integration-basic" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-integration-basic</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When compiling, the RxMicro framework searches for <code>RxMicro Annotations</code> in the source code and generates additional classes necessary for the integral work of the microservice.</p>
</div>
<div class="paragraph">
<p><strong>When changing the <code>RxMicro Annotations</code> in the source code, DON&#8217;T FORGET to recompile the ALL source code, not just the changed file, for the changes to take effect:</strong> <code>mvn clean compile</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="testing-BlockingHttpClient-settings-section"><a class="anchor" href="#testing-BlockingHttpClient-settings-section"></a><a class="link" href="#testing-BlockingHttpClient-settings-section">8.2. The <code>BlockingHttpClient</code> Settings</a></h3>
<div class="paragraph">
<p>The <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/BlockingHttpClient.java" target="_blank" rel="noopener"><code>BlockingHttpClient</code></a> component, which is used for writing REST-based microservices and integration tests, is configured by the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/BlockingHttpClientSettings.java" target="_blank" rel="noopener"><code>@BlockingHttpClientSettings</code></a> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private static final int SERVER_PORT = getRandomFreePort(); <i class="conum" data-value="4"></i><b>(4)</b>

@BlockingHttpClientSettings(
        schema = HTTPS,                     <i class="conum" data-value="1"></i><b>(1)</b>
        host = "examples.rxmicro.io",       <i class="conum" data-value="2"></i><b>(2)</b>
        port = 9876,                        <i class="conum" data-value="3"></i><b>(3)</b>
        randomPortProvider = "SERVER_PORT", <i class="conum" data-value="4"></i><b>(4)</b>
        versionValue = "v1.1",              <i class="conum" data-value="5"></i><b>(5)</b>
        versionStrategy = HEADER,           <i class="conum" data-value="6"></i><b>(6)</b>
        requestTimeout = 15,                <i class="conum" data-value="7"></i><b>(7)</b>
        followRedirects = Option.ENABLED    <i class="conum" data-value="8"></i><b>(8)</b>
)
private BlockingHttpClient blockingHttpClient;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>schema</code> parameter allows You to specify the HTTP protocol schema.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>host</code> parameter allows You to specify the remote host on which the microservice is running.<br>
<em>(This parameter allows performing integration testing for remote microservices.)</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>port</code> parameter allows You to specify the static connection port.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>randomPortProvider</code> parameter allows You to specify the dynamic connection port.<br>
<em>(The port will be read from the static final variable of the current class with the <code>SERVER_PORT</code> name.)</em><br>
<em>(The <code>port</code> and <code>randomPortProvider</code> parameters are mutually exclusive.)</em></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>versionValue</code> allows You to specify <a href="rest-controller.html#rest-controller-versioning-section">the microservice version</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The <code>versionStrategy</code> parameter allows specifying <a href="rest-controller.html#rest-controller-versioning-section">the versioning strategy</a>, which is used in the tested microservice.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The <code>requestTimeout</code> parameter allows specifying the request timeout.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The <code>followRedirects</code> parameter returns follow redirect option for the blocking HTTP client</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="testing-integration-tests-docker-section"><a class="anchor" href="#testing-integration-tests-docker-section"></a><a class="link" href="#testing-integration-tests-docker-section">8.3. The <code>docker</code> Usage</a></h3>
<div class="paragraph">
<p>To perform the integration testing of microservices, it is convenient to use the <code>docker</code>.</p>
</div>
<div class="paragraph">
<p>This demonstration example uses the <code>docker</code> image: <a href="https://hub.docker.com/r/rxmicro/simple-hello-world" target="_blank" rel="noopener"><code>rxmicro/simple-hello-world</code></a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The source code of the project, on the basis of which this <code>docker</code> image was built, is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/docker-image-hello-world-microservice" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/docker-image-hello-world-microservice</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To start the <code>docker</code> containers in the integration test it is convenient to use the  <a href="https://www.testcontainers.org/" target="_blank" rel="noopener"><code>Testcontainers</code></a> Java library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><i class="conum" data-value="1"></i><b>(1)</b>
@RxMicroIntegrationTest
<i class="conum" data-value="2"></i><b>(2)</b>
@Testcontainers
final class HelloWorldMicroService_IT {

    <i class="conum" data-value="3"></i><b>(3)</b>
    @Container
    private static final DockerComposeContainer&lt;?&gt; compose =
            new DockerComposeContainer&lt;&gt;(new File("docker-compose.yml").getAbsoluteFile())
                    .withLocalCompose(true)
                    .withPull(false)
                    .withTailChildContainers(true)
                    .waitingFor("rxmicro-hello-world", Wait.forHttp("/http-health-check"));

    private BlockingHttpClient blockingHttpClient;

    @Test
    void Should_return_Hello_World() {
        final ClientHttpResponse response = blockingHttpClient.get("/");

        assertEquals(jsonObject("message", "Hello World!"), response.getBody()); <i class="conum" data-value="4"></i><b>(4)</b>
        assertEquals(200, response.getStatusCode());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-junit/src/main/java/io/rxmicro/test/junit/RxMicroIntegrationTest.java" target="_blank" rel="noopener"><code>@RxMicroIntegrationTest</code></a>
annotation informs the RxMicro framework that this test is an integration test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="https://github.com/testcontainers/testcontainers-java/blob/main/modules/junit-jupiter/src/main/java/org/testcontainers/junit/jupiter/Testcontainers.java" target="_blank" rel="noopener"><code>@Testcontainers</code></a>
annotation activates the start and stop of the <code>docker</code> containers to be used in this test.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="https://github.com/testcontainers/testcontainers-java/blob/main/modules/junit-jupiter/src/main/java/org/testcontainers/junit/jupiter/Container.java" target="_blank" rel="noopener"><code>@Container</code></a>
annotation indicates the <code>docker</code> container to be used in this test.
<em>(To start microservices in the <code>docker</code> containers the <code>docker-compose</code> utility is used.)</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>During the testing process, ensure that the tested microservice returns the <code>"Hello World!"</code> message.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To start the REST-based microservice in the <code>docker</code> container, the following configuration file for the <code>docker-compose</code> utility is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">version: '3.7'
services:
  rxmicro-hello-world:
    image: rxmicro/simple-hello-world
    ports:
      - 8080:8080
    healthcheck:
      test: wget http://localhost:8080/http-health-check || exit 1
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To get additional info about writing tests that require JSON object comparison, please read <a href="core.html#core-json-rxmicro-json-module-usage"><code>rxmicro.json</code> Module Usage</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-integration-docker" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-integration-docker</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-dbunit-tests-section"><a class="anchor" href="#testing-dbunit-tests-section"></a><a class="link" href="#testing-dbunit-tests-section">9. Database Testing Using DBUnit</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://dbunit.sourceforge.net/" target="_blank" rel="noopener">DbUnit</a> is an extension targeted at database-driven projects that, among other things, puts your database into a known state between test runs.
This is an excellent way to avoid the myriad of problems that can occur when one test case corrupts the database and causes subsequent tests to fail or exacerbate the damage.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="testing-dbunit-test-database-config"><a class="anchor" href="#testing-dbunit-test-database-config"></a><a class="link" href="#testing-dbunit-test-database-config">9.1. Test Database Configuration</a></h3>
<div class="paragraph">
<p>To communicate with test database the RxMicro framework uses the predefined
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test-dbunit/src/main/java/io/rxmicro/test/dbunit/TestDatabaseConfig.java" target="_blank" rel="noopener"><code>TestDatabaseConfig</code></a> config class.
This class is <a href="core.html#configuration-basic-structure-section">the usual RxMicro configuration class</a>.</p>
</div>
<div class="paragraph">
<p>It means that settings for test database can be configured using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>test-database.properties</code> classpath resource.</p>
</li>
<li>
<p><code>./test-database.properties</code> file.</p>
</li>
<li>
<p><code>$HOME/test-database.properties</code> file.</p>
</li>
<li>
<p><code>$HOME/.rxmicro/test-database.properties</code> file.</p>
</li>
<li>
<p>environment variables.</p>
</li>
<li>
<p>Java system properties.</p>
</li>
<li>
<p><a href="#testing-annotations-WithConfig-inline"><code>@WithConfig</code></a> annotation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Besides that the settings for test database can be changed using <code>TestDatabaseConfig.getCurrentTestDatabaseConfig()</code> static method.
This approach useful if test database is working at the <a href="https://www.docker.com/" target="_blank" rel="noopener">docker</a> container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BeforeEach
void beforeEach() {
    getCurrentTestDatabaseConfig()
            .setHost(postgresqlTestDockerContainer.getHost())
            .setPort(postgresqlTestDockerContainer.getFirstMappedPort());
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="testing-dbunit-retrieve-connection-strategies"><a class="anchor" href="#testing-dbunit-retrieve-connection-strategies"></a><a class="link" href="#testing-dbunit-retrieve-connection-strategies">9.2. Retrieve Connection Strategies</a></h3>
<div class="paragraph">
<p>The RxMicro framework provides the following retrieve connection to the test database strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One connection per all test classes.</p>
</li>
<li>
<p>One connection per test class (<strong>default strategy</strong>).</p>
</li>
<li>
<p>One connection per test method.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="one_connection_per_all_test_classes"><a class="anchor" href="#one_connection_per_all_test_classes"></a><a class="link" href="#one_connection_per_all_test_classes">9.2.1. One connection per all test classes</a></h4>
<div class="paragraph">
<p>This strategy informs the DBUnit to use single connection per all tests for your project.<br>
The RxMicro team recommends using this strategy for external databases only.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RxMicroIntegrationTest
@Testcontainers
<i class="conum" data-value="1"></i><b>(1)</b>
@DbUnitTest(retrieveConnectionStrategy = PER_ALL_TEST_CLASSES)
@TestMethodOrder(MethodOrderer.OrderAnnotation.class)
// FIXME "org.postgresql.util.PSQLException: FATAL: the database system is starting up" and remove @Ignore
@Ignore
final class DbStateUsingPerAllTestClassesConnectionTest {

    private static final int DB_PORT = getRandomFreePort();

    @WithConfig
    private static final TestDatabaseConfig CONFIG = new TestDatabaseConfig()
            .setType(DatabaseType.POSTGRES)
            .setPort(DB_PORT)
            .setUser("rxmicro")
            .setPassword("password")
            .setDatabase("rxmicro");

    @Container
    private static final GenericContainer&lt;?&gt; POSTGRESQL_TEST_DB =
            new FixedHostPortGenericContainer&lt;&gt;("rxmicro/postgres-test-db")
                    .withExposedPorts(5432)
                    .withFixedExposedPort(DB_PORT, 5432);

    @Test
    @ExpectedDataSet("dataset/rxmicro-test-dataset.xml")
    @Order(1)
    void Should_contain_expected_dataset() {

    }

    @Test
    @InitialDataSet("dataset/rxmicro-test-dataset-two-rows-only.xml")
    @ExpectedDataSet("dataset/rxmicro-test-dataset-two-rows-only.xml")
    @Order(2)
    void Should_set_and_compare_dataset() {

    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-basic" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-basic</code></a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="one_connection_per_test_class"><a class="anchor" href="#one_connection_per_test_class"></a><a class="link" href="#one_connection_per_test_class">9.2.2. One connection per test class</a></h4>
<div class="paragraph">
<p>This strategy informs the DBUnit to create a new connection before run all tests for each test class and to close after running all tests for each test class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RxMicroIntegrationTest
@Testcontainers
<i class="conum" data-value="1"></i><b>(1)</b>
@DbUnitTest
@TestMethodOrder(MethodOrderer.OrderAnnotation.class)
// FIXME "org.postgresql.util.PSQLException: FATAL: the database system is starting up" and remove @Ignore
@Ignore
final class DbStateUsingPerClassConnectionTest {

    @Container
    private static final GenericContainer&lt;?&gt; POSTGRESQL_TEST_DB =
            new GenericContainer&lt;&gt;("rxmicro/postgres-test-db")
                    .withExposedPorts(5432);

    @BeforeAll
    static void beforeAll() {
        getCurrentTestDatabaseConfig()
                .setHost(POSTGRESQL_TEST_DB.getHost())
                .setPort(POSTGRESQL_TEST_DB.getFirstMappedPort());
    }

    @Test
    @ExpectedDataSet("dataset/rxmicro-test-dataset.xml")
    @Order(1)
    void Should_contain_expected_dataset() {

    }

    @Test
    @InitialDataSet("dataset/rxmicro-test-dataset-two-rows-only.xml")
    @ExpectedDataSet("dataset/rxmicro-test-dataset-two-rows-only.xml")
    @Order(2)
    void Should_set_and_compare_dataset() {

    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-basic" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-basic</code></a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="one_connection_per_test_method"><a class="anchor" href="#one_connection_per_test_method"></a><a class="link" href="#one_connection_per_test_method">9.2.3. One connection per test method</a></h4>
<div class="paragraph">
<p>This strategy informs the DBUnit to create a new connection before each test method and to close after each one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RxMicroIntegrationTest
@Testcontainers
<i class="conum" data-value="1"></i><b>(1)</b>
@DbUnitTest(retrieveConnectionStrategy = PER_TEST_METHOD)
@TestMethodOrder(MethodOrderer.OrderAnnotation.class)
// FIXME "org.postgresql.util.PSQLException: FATAL: the database system is starting up" and remove @Ignore
@Ignore
final class DbStateUsingPerMethodConnectionTest {

    @Container
    private final GenericContainer&lt;?&gt; postgresqlTestDb =
            new GenericContainer&lt;&gt;("rxmicro/postgres-test-db")
                    .withExposedPorts(5432);

    @BeforeEach
    void beforeEach() {
        getCurrentTestDatabaseConfig()
                .setHost(postgresqlTestDb.getHost())
                .setPort(postgresqlTestDb.getFirstMappedPort());
    }

    @Test
    @ExpectedDataSet("dataset/rxmicro-test-dataset.xml")
    @Order(1)
    void Should_contain_expected_dataset() {

    }

    @Test
    @InitialDataSet("dataset/rxmicro-test-dataset-two-rows-only.xml")
    @ExpectedDataSet("dataset/rxmicro-test-dataset-two-rows-only.xml")
    @Order(2)
    void Should_set_and_compare_dataset() {

    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-basic" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-basic</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="testing-dbunit-initial-data-set"><a class="anchor" href="#testing-dbunit-initial-data-set"></a><a class="link" href="#testing-dbunit-initial-data-set">9.3. <code>@InitialDataSet</code> Annotation</a></h3>
<div class="paragraph">
<p>The <code>@InitialDataSet</code> annotation inform the RxMicro framework that it is necessary to prepare the tested database using <a href="http://dbunit.sourceforge.net/" target="_blank" rel="noopener">DbUnit</a> framework before test execution.
The <code>@InitialDataSet</code> annotation contains the dataset files that must be exported to the tested database before test execution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
<i class="conum" data-value="1"></i><b>(1)</b>
@InitialDataSet("dataset/rxmicro-test-dataset-two-rows-only.xml")
void prepare_database() {
    // do something with prepared database
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using data from the <code>@InitialDataSet</code> annotation the RxMicro framework prepares the tested database.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The init dataset can be provided using <a href="https://dbunit.sourceforge.net/org/dbunit/dataset/xml/FlatXmlDataSet.html" target="_blank" rel="noopener"><code>flat xml</code></a> format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;!DOCTYPE dataset SYSTEM "rxmicro-test-dataset.dtd"&gt;

&lt;dataset&gt;
    &lt;account id="1"
             email="richard.hendricks@piedpiper.com"
             first_name="Richard"
             last_name="Hendricks"
             balance="70000.00"
             role="CEO"/&gt;
    &lt;account id="3"
             email="dinesh.chugtai@piedpiper.com"
             first_name="Dinesh"
             last_name="Chugtai"
             balance="10000.00"
             role="Lead_Engineer"/&gt;

    &lt;product id="24"
             name="Apple iMac 27&amp;quot; with Retina 5K Display Late (MQ2Y2)"
             price="6200.00"
             count="7"/&gt;
    &lt;product id="25"
             name="Apple iMac 27&amp;quot; 2017 5K (MNEA2)"
             price="2100.00"
             count="17"/&gt;

    &lt;order/&gt;
&lt;/dataset&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-basic" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-basic</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="testing-dbunit-expected-data-set"><a class="anchor" href="#testing-dbunit-expected-data-set"></a><a class="link" href="#testing-dbunit-expected-data-set">9.4. <code>@ExpectedDataSet</code> Annotation</a></h3>
<div class="paragraph">
<p>The <code>@ExpectedDataSet</code> annotation inform the RxMicro framework that it is necessary to compare the actual database state with the expected one, defined using dataset file(s) after test execution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
<i class="conum" data-value="1"></i><b>(1)</b>
@ExpectedDataSet("dataset/rxmicro-test-dataset-two-rows-only.xml")
void verify_database_state() {
    // change database state
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using data from the <code>@ExpectedDataSet</code> annotation the RxMicro framework compares actual database state with the expected one after test execution.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The expected dataset can be provided using <a href="https://dbunit.sourceforge.net/org/dbunit/dataset/xml/FlatXmlDataSet.html" target="_blank" rel="noopener"><code>flat xml</code></a> format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;!DOCTYPE dataset SYSTEM "rxmicro-test-dataset.dtd"&gt;

&lt;dataset&gt;
    &lt;account id="1"
             email="richard.hendricks@piedpiper.com"
             first_name="Richard"
             last_name="Hendricks"
             balance="70000.00"
             role="CEO"/&gt;
    &lt;account id="3"
             email="dinesh.chugtai@piedpiper.com"
             first_name="Dinesh"
             last_name="Chugtai"
             balance="10000.00"
             role="Lead_Engineer"/&gt;

    &lt;product id="24"
             name="Apple iMac 27&amp;quot; with Retina 5K Display Late (MQ2Y2)"
             price="6200.00"
             count="7"/&gt;
    &lt;product id="25"
             name="Apple iMac 27&amp;quot; 2017 5K (MNEA2)"
             price="2100.00"
             count="17"/&gt;

    &lt;order/&gt;
&lt;/dataset&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-basic" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-basic</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="testing-dbunit-rollback-changes"><a class="anchor" href="#testing-dbunit-rollback-changes"></a><a class="link" href="#testing-dbunit-rollback-changes">9.5. <code>@RollbackChanges</code> Annotation</a></h3>
<div class="paragraph">
<p>The <code>@RollbackChanges</code> annotation starts a new transaction before initialization of database by the <code>@InitialDataSet</code> annotation (if it is present) and rolls back this transaction after comparing actual database state with expected one provided by the <code>@ExpectedDataSet</code> annotation (if it is present).</p>
</div>
<div class="paragraph">
<p>The isolation level of the test transaction can be configured using <code>isolationLevel</code> parameter declared at the <code>@RollbackChanges</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RxMicroIntegrationTest
@Testcontainers
<i class="conum" data-value="1"></i><b>(1)</b>
@DbUnitTest
@TestMethodOrder(MethodOrderer.OrderAnnotation.class)
// FIXME "org.postgresql.util.PSQLException: FATAL: the database system is starting up" and remove @Ignore
@Ignore
final class RollbackChangesTest {

    @Container
    private static final GenericContainer&lt;?&gt; POSTGRESQL_TEST_DB =
            new GenericContainer&lt;&gt;("rxmicro/postgres-test-db")
                    .withExposedPorts(5432);

    @BeforeAll
    static void beforeAll() {
        getCurrentTestDatabaseConfig()
                .setHost(POSTGRESQL_TEST_DB.getHost())
                .setPort(POSTGRESQL_TEST_DB.getFirstMappedPort());
    }

    @Test
    <i class="conum" data-value="2"></i><b>(2)</b>
    @RollbackChanges
    @InitialDataSet("dataset/rxmicro-test-dataset-empty.xml")
    @ExpectedDataSet("dataset/rxmicro-test-dataset-empty.xml")
    @Order(1)
    void Should_set_and_compare_dataset() {

    }

    @Test
    @ExpectedDataSet("dataset/rxmicro-test-dataset.xml")
    @Order(2)
    void Should_contain_expected_dataset() {

    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>For database testing it is necessary to inform the RxMicro framework that current test is DBUnit test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If test method annotated by the <code>@RollbackChanges</code> annotation all changes made by this test method will be rolled back.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-basic" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-basic</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="testing-dbunit-order-by"><a class="anchor" href="#testing-dbunit-order-by"></a><a class="link" href="#testing-dbunit-order-by">9.6. Ordered Comparison</a></h3>
<div class="paragraph">
<p>If the expected dataset is ordered, it is necessary to inform the RxMicro framework how to compare this dataset correctly.
For this case the <code>@ExpectedDataSet</code> annotation has <code>orderBy</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
@ExpectedDataSet(
        value = "dataset/rxmicro-test-dataset-products-order-by-price.xml",
        orderBy = "price" <i class="conum" data-value="1"></i><b>(1)</b>
)
@Order(1)
void Should_contain_expected_dataset() {

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>orderBy</code> parameter contains the column name(s) that must be used to sort the actual dataset before comparison.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>dataset/rxmicro-test-dataset-products-order-by-price.xml</code> dataset is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;!DOCTYPE dataset SYSTEM "rxmicro-test-dataset.dtd"&gt;

&lt;dataset&gt;
    &lt;product id="19" name="Apple iPod Touch 6 16Ð“Ð± (MKGX2)" price="310.00" count="48"/&gt;
    &lt;product id="17" name="Apple iPod Touch 6 16Ð“Ð± (MKH62)" price="320.00" count="54"/&gt;
    &lt;product id="18" name="Apple iPod Touch 6 32Ð“Ð± (MKJ02)" price="380.00" count="52"/&gt;
    &lt;product id="20" name="Apple iPod Touch 6 32Ð“Ð± (MKHV2)" price="420.00" count="55"/&gt;
    &lt;product id="14" name="Apple iPhone 7 Plus 32GB Black" price="510.00" count="3"/&gt;
    &lt;product id="6" name="Apple iPad (2019) 10.2&amp;quot; Wi-Fi 32GB Gold (MW762)" price="540.00"
             count="32"/&gt;
    &lt;product id="7" name="Apple iPad (2019) 10.2&amp;quot; Wi-Fi 128GB Silver (MW782)" price="620.00"
             count="37"/&gt;
    &lt;product id="8" name="Apple iPad mini 5 Wi-Fi 64Gb Space Gray (MUQW2)" price="645.00"
             count="26"/&gt;
    &lt;product id="12" name="Apple iPhone Xr 64GB Black (MRY42)" price="760.00" count="14"/&gt;
    &lt;product id="10" name="Apple iPhone Xs 64GB Space Gray (MT9E2)" price="840.00" count="21"/&gt;
    &lt;product id="13" name="Apple iPhone Xs 256GB Space Gray (MT9H2)" price="910.00" count="10"/&gt;
    &lt;product id="11" name="Apple iPhone 11 128GB Black" price="980.00" count="18"/&gt;
    &lt;product id="2" name="Apple MacBook A1534 12&amp;quot; Space Gray (MNYF2)" price="985.00"
             count="12"/&gt;
    &lt;product id="9" name="Apple iPad Pro 11&amp;quot; Wi-Fi 64GB Space Gray 2018 (MTXN2)" price="1100.00"
             count="18"/&gt;
    &lt;product id="4" name="Apple MacBook Pro 13 Retina Space Gray (MPXT2) 2017" price="1345.00"
             count="17"/&gt;
    &lt;product id="15" name="Apple iPhone 11 Pro 64GB Space Gray" price="1450.00" count="42"/&gt;
    &lt;product id="16" name="Apple iPhone 11 Pro 256GB Midnight Green" price="1720.00" count="38"/&gt;
    &lt;product id="22" name="Apple iMac 21.5&amp;apos; Middle 2017 (MMQA2)" price="1740.00" count="14"/&gt;
    &lt;product id="5" name="Apple MacBook Pro 15&amp;quot; Retina Z0RF00052 (Mid 2015)" price="1860.00"
             count="11"/&gt;
    &lt;product id="23" name="Apple iMac 21&amp;quot; Retina 4K MRT32 (Early 2019)" price="1920.00"
             count="11"/&gt;
    &lt;product id="25" name="Apple iMac 27&amp;quot; 2017 5K (MNEA2)" price="2100.00" count="17"/&gt;
    &lt;product id="3" name="Apple MacBook Pro 16&amp;quot; 512GB 2019 (MVVJ2) Space Gray" price="2540.00"
             count="8"/&gt;
    &lt;product id="1" name="Apple MacBook Pro 15&amp;quot; Retina Z0WW00024 Space Gray" price="5750.00"
             count="10"/&gt;
    &lt;product id="24" name="Apple iMac 27&amp;quot; with Retina 5K Display Late (MQ2Y2)" price="6200.00"
             count="7"/&gt;
    &lt;product id="21" name="Apple iMac Pro 27&amp;quot; Z0UR000AC / Z0UR8 (Late 2017)" price="7800.00"
             count="6"/&gt;
&lt;/dataset&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-basic" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-basic</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="testing-dbunit-supported-expressions"><a class="anchor" href="#testing-dbunit-supported-expressions"></a><a class="link" href="#testing-dbunit-supported-expressions">9.7. Supported Expressions</a></h3>
<div class="paragraph">
<p>The RxMicro framework supports expressions for datasets.<br>
Expressions can be useful to set dynamic parameters.</p>
</div>
<div class="paragraph">
<p>The RxMicro framework supports the following expressions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${null}</code> - null value.</p>
</li>
<li>
<p><code>${now}</code> - is <code>java.time.Instant.now()</code> value for the initial dataset;</p>
<div class="ulist">
<ul>
<li>
<p><code>${instant:now}</code> is alias for <code>${now}</code>;</p>
</li>
<li>
<p><code>${timestamp:now}</code> is alias for <code>${now}</code>;</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>${now}</code> - is <code>java.time.Instant.now()</code> value for the expected dataset;</p>
<div class="ulist">
<ul>
<li>
<p><code>${instant:now}</code> is alias for <code>${now}</code>;</p>
</li>
<li>
<p><code>${timestamp:now}</code> is alias for <code>${now}</code>;</p>
</li>
<li>
<p><code>${now:${CUSTOM-DURATION}}</code> is alias for <code>${now}</code>;</p>
</li>
<li>
<p><code>${instant:now:${CUSTOM-DURATION}}</code> is alias for <code>${now}</code>;</p>
</li>
<li>
<p><code>${timestamp:now:${CUSTOM-DURATION}}</code> is alias for <code>${now}</code>;</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>${interval:${MIN}:${MAX}}</code> - is an instant interval that can be compared with <code>java.time.Instant</code> and <code>java.sql.Timestamp</code> instances correctly.</p>
<div class="ulist">
<ul>
<li>
<p><code>${interval:${MEDIAN}:${LEFT-DELTA}:${RIGHT-DELTA}}</code> is alias for <code>${interval:${MIN}:${MAX}}</code>;</p>
</li>
<li>
<p><code>${instant:interval:${MEDIAN}:${LEFT-DELTA}:${RIGHT-DELTA}}</code> is alias for <code>${interval:${MIN}:${MAX}}</code>;</p>
</li>
<li>
<p><code>${timestamp:interval:${MEDIAN}:${LEFT-DELTA}:${RIGHT-DELTA}}</code> is alias for <code>${interval:${MIN}:${MAX}}</code>;</p>
</li>
<li>
<p><code>${instant:interval:${MIN}:${MAX}}</code> is alias for <code>${interval:${MIN}:${MAX}}</code>;</p>
</li>
<li>
<p><code>${timestamp:interval:${MIN}:${MAX}}</code> is alias for <code>${interval:${MIN}:${MAX}}</code>;</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>${int:interval:${MIN}:${MAX}}</code> - is an integer number interval that can be compared with <code>java.lang.Short</code>, <code>java.lang.Integer</code> and <code>java.lang.Long</code> instances correctly.</p>
<div class="ulist">
<ul>
<li>
<p><code>${integer:interval:${MIN}:${MAX}}</code> is alias for <code>${int:interval:${MIN}:${MAX}}</code>;</p>
</li>
<li>
<p><code>${tinyint:interval:${MIN}:${MAX}}</code> is alias for <code>${int:interval:${MIN}:${MAX}}</code>;</p>
</li>
<li>
<p><code>${short:interval:${MIN}:${MAX}}</code> is alias for <code>${int:interval:${MIN}:${MAX}}</code>;</p>
</li>
<li>
<p><code>${smallint:interval:${MIN}:${MAX}}</code> is alias for <code>${int:interval:${MIN}:${MAX}}</code>;</p>
</li>
<li>
<p><code>${long:interval:${MIN}:${MAX}}</code> is alias for <code>${int:interval:${MIN}:${MAX}}</code>;</p>
</li>
<li>
<p><code>${bigint:interval:${MIN}:${MAX}}</code> is alias for <code>${int:interval:${MIN}:${MAX}}</code>;</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="testing-dbunit-supported-expressions-null"><a class="anchor" href="#testing-dbunit-supported-expressions-null"></a><a class="link" href="#testing-dbunit-supported-expressions-null">9.7.1. <code>${null}</code> Expression</a></h4>
<div class="paragraph">
<p>If dataset must contain <code>null</code> value, the <code>${null}</code> expression must be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;!DOCTYPE dataset SYSTEM "rxmicro-test-dataset.dtd"&gt;

&lt;dataset&gt;
    &lt;account id="1"
             email="richard.hendricks@piedpiper.com"
             first_name="Richard"
             last_name="Hendricks"
             role="CEO"
             balance="${null}"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/dataset&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set <code>null</code> value to the <code>balance</code> column.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
@InitialDataSet(
        <i class="conum" data-value="1"></i><b>(1)</b>
        value = "dataset/with-null-expression-dataset.xml",
        <i class="conum" data-value="2"></i><b>(2)</b>
        executeStatementsBefore = "ALTER TABLE account ALTER COLUMN balance DROP NOT NULL")
<i class="conum" data-value="4"></i><b>(4)</b>
@ExpectedDataSet("dataset/with-null-expression-dataset.xml")
void Should_set_and_compare_null_correctly() throws SQLException {
    try (Connection connection = getJDBCConnection()) {
        try (Statement st = connection.createStatement()) {
            try (ResultSet rs = st.executeQuery("SELECT balance FROM account WHERE id=1")) {
                if (rs.next()) {
                    <i class="conum" data-value="3"></i><b>(3)</b>
                    assertNull(rs.getTimestamp(1, GREGORIAN_CALENDAR_WITH_UTC_TIME_ZONE));
                } else {
                    fail("Test database does not contain account with id=1");
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The dataset with <code>${null}</code> expression.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The test database does not support <code>null</code> values for <code>account.balance</code> column.
To demonstrate how <code>${null}</code> expression is worked it is necessary to drop <code>NOT NULL</code> constraint.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The actual row contains <code>null</code> value.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>After test execution the test database must contain <code>null</code> value.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-expressions" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-expressions</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="testing-dbunit-supported-expressions-now"><a class="anchor" href="#testing-dbunit-supported-expressions-now"></a><a class="link" href="#testing-dbunit-supported-expressions-now">9.7.2. <code>${now}</code> Expression</a></h4>
<div class="paragraph">
<p>The <code>${now}</code> expression useful if it is necessary to work with current instant: set and compare.</p>
</div>
<div class="paragraph">
<p>If dataset must contain <code>java.time.Instant.now()</code> value, the <code>${now}</code> expression must be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;!DOCTYPE dataset SYSTEM "rxmicro-test-dataset.dtd"&gt;

&lt;dataset&gt;
    &lt;order id="1"
           id_account="1"
           id_product="1"
           count="10"
           created="${now}"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/dataset&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set current instant value to the <code>created</code> column.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
@InitialDataSet(
        <i class="conum" data-value="1"></i><b>(1)</b>
        value = "dataset/with-now-expression-dataset.xml",
        <i class="conum" data-value="2"></i><b>(2)</b>
        executeStatementsBefore = {
                "ALTER TABLE \"order\" DROP CONSTRAINT IF EXISTS order_fk_account",
                "ALTER TABLE \"order\" DROP CONSTRAINT IF EXISTS order_fk_product"
        })
<i class="conum" data-value="3"></i><b>(3)</b>
@ExpectedDataSet("dataset/with-now-expression-dataset.xml")
void Should_set_and_compare_now_correctly() throws SQLException {
    try (Connection connection = getJDBCConnection()) {
        try (Statement st = connection.createStatement()) {
            try (ResultSet rs = st.executeQuery("SELECT created FROM \"order\" WHERE id=1")) {
                if (rs.next()) {
                    <i class="conum" data-value="4"></i><b>(4)</b>
                    final Instant actual =
                            rs.getTimestamp(1, GREGORIAN_CALENDAR_WITH_UTC_TIME_ZONE).toInstant();
                    <i class="conum" data-value="5"></i><b>(5)</b>
                    assertInstantEquals(Instant.now(), actual);
                } else {
                    fail("Test database does not contain order with id=1");
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The dataset with <code>${now}</code> expression.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The test database contains foreign keys.
To demonstrate how <code>${now}</code> expression is worked it is necessary to drop these foreign keys.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The expected dataset must contain current instant value too.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The actual row contains current instant value.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>To compare current instant value it is necessary to use <code>ExAssertions.assertInstantEquals</code> method.
This method verifies that instants are equal within the default <code>delta</code> configured via <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/GlobalTestConfig.java" target="_blank" rel="noopener"><code>GlobalTestConfig</code></a> config class.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>${now}</code> expression can be used to verify that unit test creates <code>java.time.Instant.now()</code> value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
@InitialDataSet(
        <i class="conum" data-value="1"></i><b>(1)</b>
        value = "dataset/empty-database.xml",
        <i class="conum" data-value="2"></i><b>(2)</b>
        executeStatementsBefore = {
                "ALTER TABLE \"order\" DROP CONSTRAINT IF EXISTS order_fk_account",
                "ALTER TABLE \"order\" DROP CONSTRAINT IF EXISTS order_fk_product"
        })
<i class="conum" data-value="4"></i><b>(4)</b>
@ExpectedDataSet("dataset/with-now-expression-dataset.xml")
void Should_compare_now_correctly() throws SQLException {
    final String sql = "INSERT INTO \"order\" VALUES(?,?,?,?,?)";
    try (Connection connection = getJDBCConnection()) {
        try (PreparedStatement st = connection.prepareStatement(sql)) {
            st.setInt(1, 1);
            st.setInt(2, 1);
            st.setInt(3, 1);
            st.setInt(4, 10);
            final Timestamp now = Timestamp.from(Instant.now()); <i class="conum" data-value="3"></i><b>(3)</b>
            st.setTimestamp(5, now, GREGORIAN_CALENDAR_WITH_UTC_TIME_ZONE);
            st.executeUpdate();
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The empty dataset.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The test database contains foreign keys.
To demonstrate how <code>${now}</code> expression is worked it is necessary to drop these foreign keys.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>java.time.Instant.now()</code> value is stored to test database.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>After test execution the test database must contain <code>java.time.Instant.now()</code> value.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>dataset/with-now-expression-dataset.xml</code> classpath resource contains the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;!DOCTYPE dataset SYSTEM "rxmicro-test-dataset.dtd"&gt;

&lt;dataset&gt;
    &lt;order id="1"
           id_account="1"
           id_product="1"
           count="10"
           created="${now}"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/dataset&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>created</code> column must contain <code>java.time.Instant.now()</code> value.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-expressions" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-expressions</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="testing-dbunit-supported-expressions-int-interval"><a class="anchor" href="#testing-dbunit-supported-expressions-int-interval"></a><a class="link" href="#testing-dbunit-supported-expressions-int-interval">9.7.3. <code>${instant:interval}</code> Expression</a></h4>
<div class="paragraph">
<p>The <code>${instant:interval}</code> expression allows comparing this expression with <code>java.time.Instant</code> and <code>java.sql.Timestamp</code> instances correctly.</p>
</div>
<div class="paragraph">
<p>This expression is useful if Your business logic generates random instant value within predefined boundaries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
@InitialDataSet(
        <i class="conum" data-value="1"></i><b>(1)</b>
        value = "dataset/empty-database.xml",
        <i class="conum" data-value="2"></i><b>(2)</b>
        executeStatementsBefore = {
                "ALTER TABLE \"order\" DROP CONSTRAINT IF EXISTS order_fk_account",
                "ALTER TABLE \"order\" DROP CONSTRAINT IF EXISTS order_fk_product"
        })
<i class="conum" data-value="4"></i><b>(4)</b>
@ExpectedDataSet("dataset/with-instant-interval-expression-dataset.xml")
void Should_compare_instant_interval_correctly() throws SQLException {
    final String sql = "INSERT INTO \"order\" VALUES(?,?,?,?,?)";
    try (Connection connection = getJDBCConnection()) {
        try (PreparedStatement st = connection.prepareStatement(sql)) {
            st.setInt(1, 1);
            st.setInt(2, 1);
            st.setInt(3, 1);
            st.setInt(4, 10);
            final Duration duration = Duration.ofSeconds(new Random().nextInt(10) + 1);
            final Timestamp now = Timestamp.from(Instant.now().plus(duration)); <i class="conum" data-value="3"></i><b>(3)</b>
            st.setTimestamp(5, now, GREGORIAN_CALENDAR_WITH_UTC_TIME_ZONE);
            st.executeUpdate();
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The empty dataset.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The test database contains foreign keys.
To demonstrate how <code>${now}</code> expression is worked it is necessary to drop these foreign keys.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>java.time.Instant.now() + [1 SECOND - 10 SECOND]</code> value is stored to test database.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>After test execution the test database must contain <code>java.time.Instant.now() + [1 SECOND - 10 SECOND]</code> value.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>dataset/with-now-expression-dataset.xml</code> classpath resource contains the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;!DOCTYPE dataset SYSTEM "rxmicro-test-dataset.dtd"&gt;

&lt;dataset&gt;
    &lt;order id="1"
           id_account="1"
           id_product="1"
           count="10"
           created="${interval:now:PT1S:PT12S}"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/dataset&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>created</code> column must contain <code>java.time.Instant.now() + [1 SECOND - 12 SECOND]</code> value.
<code>12</code> instead of <code>10</code> is used because 2 second is compare delta!</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-expressions" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-expressions</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="testing-dbunit-supported-expressions-instant-interval"><a class="anchor" href="#testing-dbunit-supported-expressions-instant-interval"></a><a class="link" href="#testing-dbunit-supported-expressions-instant-interval">9.7.4. <code>${int:interval}</code> Expression</a></h4>
<div class="paragraph">
<p>The <code>${int:interval}</code> expression allows comparing this expression with <code>java.lang.Short</code>, <code>java.lang.Integer</code> and <code>java.lang.Long</code> instances correctly.</p>
</div>
<div class="paragraph">
<p>This expression is useful if Your business logic generates random integer number value within predefined boundaries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
@InitialDataSet("dataset/empty-database.xml")
<i class="conum" data-value="2"></i><b>(2)</b>
@ExpectedDataSet("dataset/with-int-interval-expression-dataset.xml")
void Should_compare_int_interval_correctly() throws SQLException {
    final String sql = "INSERT INTO product VALUES(?,?,?,?)";
    try (Connection connection = getJDBCConnection()) {
        try (PreparedStatement st = connection.prepareStatement(sql)) {
            st.setInt(1, 1);
            st.setString(2, "name");
            st.setBigDecimal(3, new BigDecimal("6200.00"));
            st.setInt(4, new Random().nextInt(10)); <i class="conum" data-value="1"></i><b>(1)</b>
            st.executeUpdate();
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The actual product count is random value from <code>0</code> to <code>9</code>.
To compare the actual dataset it is necessary to use <code>${int:interval}</code> expression.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>After test execution the test database must contain random integer number value from <code>0</code> to <code>9</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The expected dataset with the integer number interval from <code>0</code> to <code>9</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;!DOCTYPE dataset SYSTEM "rxmicro-test-dataset.dtd"&gt;

&lt;dataset&gt;
    &lt;product id="1"
             name="name"
             price="6200.00"
             count="${int:interval:0:9}"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/dataset&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set integer number interval from <code>0</code> to <code>9</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-expressions" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-dbunit/testing-dbunit-expressions</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-none grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="java-integration.html#java-integration-section"><strong><span class="icon"><i class="fa fa-angle-double-left"></i></span> Java EcoSystem Integration</strong></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="index.html#index-section"><strong><span class="icon"><i class="fa fa-angle-double-up"></i></span> Home</strong></a></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><a href="appendices.html#appendices-section"><strong>Appendices  <span class="icon"><i class="fa fa-angle-double-right"></i></span></strong></a></p></td>
</tr>
</tbody>
</table>
<hr>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-166298262-2"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-166298262-2');
</script>
</div>
</div>
</div>
</div>
</div>
</body>
</html>