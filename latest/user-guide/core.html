<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.15">
<meta name="description" content="A modern, JVM-based, full stack framework designed to develop distributed reactive applications that use a microservice architecture.">
<meta name="keywords" content="rx, rxmicro, reactive java, reactive jvm, microservice java, reactive microservice, micro service java, reactive micro service">
<meta name="author" content="nedis">
<title>Core Concepts</title>
<link rel="stylesheet" href="../styles/rxmicro-doc.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body id="core-section" class="article toc2 toc-left">
<div id="header">
<h1>Core Concepts</h1>
<div class="details">
<span id="author" class="author">nedis</span><br>
<span id="email" class="email"><a href="mailto:rxmicro.io@gmail.com">rxmicro.io@gmail.com</a></span><br>
<span id="revnumber">version 0.11,</span>
<span id="revdate">2022-12-14 20:00:09 UTC</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#core-how-it-works-section">1. How It Works?</a>
<ul class="sectlevel2">
<li><a href="#core-how-it-works-core-schema">1.1. A Common Work Schema</a></li>
<li><a href="#generating_of_additional_classes">1.2. Generating of Additional Classes.</a>
<ul class="sectlevel3">
<li><a href="#an_additional_class_for_the_rest_controller">1.2.1. An Additional Class for the REST Controller.</a></li>
<li><a href="#an_modelwriter_class">1.2.2. An <code>ModelWriter</code> Class.</a></li>
<li><a href="#a_java_model_converter">1.2.3. A Java Model Converter.</a></li>
<li><a href="#an_aggregator_of_the_rest_controllers">1.2.4. An Aggregator of the REST Controllers.</a></li>
<li><a href="#core-how-it-works-environment-customizer">1.2.5. An Environment Customizer.</a></li>
</ul>
</li>
<li><a href="#using_the_debug_mode">1.3. Using the Debug Mode</a></li>
</ul>
</li>
<li><a href="#rxmicro-annotation-processor-options-section">2. <code>RxMicro Annotation Processor</code> Options</a></li>
<li><a href="#core-dont-block-current-thread">3. Don&#8217;t Block Current Thread!</a>
<ul class="sectlevel2">
<li><a href="#prohibited_operations">3.1. Prohibited Operations</a></li>
<li><a href="#recommended_approach">3.2. Recommended Approach</a></li>
</ul>
</li>
<li><a href="#core-reactive-libraries-support">4. Reactive Libraries Support</a>
<ul class="sectlevel2">
<li><a href="#core-reactive-bussiness-process-result-types-section">4.1. Expected Business Process Results</a></li>
<li><a href="#recommendations_for_choosing_a_library">4.2. Recommendations for Choosing a Library</a></li>
</ul>
</li>
<li><a href="#base_model">5. Base Model</a></li>
<li><a href="#strings_formatting">6. Strings Formatting</a></li>
<li><a href="#core-encapsulation">7. Encapsulation</a>
<ul class="sectlevel2">
<li><a href="#a_private_modifier_usage">7.1. A <code>private</code> Modifier Usage</a></li>
<li><a href="#a_separate_package_usage">7.2. A Separate Package Usage</a></li>
<li><a href="#a_getters_usage">7.3. A <code>getters</code> Usage</a></li>
<li><a href="#performance_comparison">7.4. Performance Comparison</a></li>
<li><a href="#approach_selection_recommendations">7.5. Approach Selection Recommendations</a></li>
</ul>
</li>
<li><a href="#configuration-section">8. Configuration</a>
<ul class="sectlevel2">
<li><a href="#configuration-basic-structure-section">8.1. Basic Structure of the Config Module</a></li>
<li><a href="#core-config-types">8.2. Configuration Types</a>
<ul class="sectlevel3">
<li><a href="#configuration_using_classpath_resources">8.2.1. Configuration Using <code>classpath</code> Resources.</a></li>
<li><a href="#core-config-properties-files-section">8.2.2. Configuration Using <code>properties</code> Files.</a></li>
<li><a href="#configuration_using_environment_variables">8.2.3. Configuration Using Environment Variables.</a></li>
<li><a href="#configuration_using_java_system_properties">8.2.4. Configuration Using Java System Properties</a></li>
<li><a href="#core-config-java-classes-section">8.2.5. Configuration Using Java Classes.</a></li>
<li><a href="#core-config-annotations-section">8.2.6. Configuration Using Java Annotations.</a></li>
<li><a href="#core-config-command-line-args-section">8.2.7. Configuration Using Command Line Arguments.</a></li>
</ul>
</li>
<li><a href="#config_sources_setting">8.3. Config Sources Setting</a>
<ul class="sectlevel3">
<li><a href="#core-config-order-default-section">8.3.1. Default Reading Order of Config Sources.</a></li>
<li><a href="#core-config-order-settings">8.3.2. Custom Reading Order of Config Sources.</a></li>
<li><a href="#logging_the_config_reading_process">8.3.3. Logging the Config Reading Process</a></li>
</ul>
</li>
<li><a href="#dynamic_configuration">8.4. Dynamic Configuration</a></li>
<li><a href="#core-config-user-defined-config">8.5. User Defined Configurations</a></li>
<li><a href="#supported_parameter_types">8.6. Supported Parameter Types</a>
<ul class="sectlevel3">
<li><a href="#supported_primitive_parameter_types">8.6.1. Supported Primitive Parameter Types</a></li>
<li><a href="#core_config_supported_custom_parameter_types">8.6.2. Supported Custom Parameter Types</a></li>
<li><a href="#supported_container_parameter_types">8.6.3. Supported Container Parameter Types</a></li>
</ul>
</li>
<li><a href="#configuration_verifiers">8.7. Configuration Verifiers</a></li>
</ul>
</li>
<li><a href="#logger">9. Logger</a>
<ul class="sectlevel2">
<li><a href="#logger_configuration">9.1. Logger Configuration</a>
<ul class="sectlevel3">
<li><a href="#using_configuration_file">9.1.1. Using Configuration File</a></li>
<li><a href="#default_reading_order_of_config_sources">9.1.2. Default Reading Order of Config Sources.</a></li>
<li><a href="#using_additional_config_sources_for_logging_configuration">9.1.3. Using Additional Config Sources for Logging Configuration</a></li>
<li><a href="#using_environment_variables_and_java_system_properties">9.1.4. Using Environment Variables And Java System Properties</a></li>
</ul>
</li>
<li><a href="#logger_handler">9.2. Logger Handler</a></li>
<li><a href="#pattern_formatter">9.3. Pattern Formatter</a></li>
<li><a href="#custom_log_event">9.4. Custom Log Event</a></li>
<li><a href="#multiline_logs_issue_for_docker_environment">9.5. Multiline Logs Issue For Docker Environment</a>
<ul class="sectlevel3">
<li><a href="#solution_from_rxmicro_framework">9.5.1. Solution From RxMicro Framework</a></li>
<li><a href="#how_to_view_original_log_events">9.5.2. How To View Original Log Events?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#core-rx-micro-json-section">10. JSON</a>
<ul class="sectlevel2">
<li><a href="#core-json-type-mapping">10.1. A Mapping Between JSON and Java Types</a></li>
<li><a href="#core-json-rxmicro-json-module-usage">10.2. <code>rxmicro.json</code> Module Usage</a></li>
<li><a href="#core-json-rxmicro-json-wrappers">10.3. Json Wrappers</a></li>
</ul>
</li>
<li><a href="#native_transports">11. Native Transports</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<table class="tableblock frame-none grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="quick-start.html#quick-start-section"><strong><span class="icon"><i class="fa fa-angle-double-left"></i></span> Quick Start</strong></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="index.html#index-section"><strong><span class="icon"><i class="fa fa-angle-double-up"></i></span> Home</strong></a></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><a href="rest-controller.html#rest-controller-section"><strong>REST Controller  <span class="icon"><i class="fa fa-angle-double-right"></i></span></strong></a></p></td>
</tr>
</tbody>
</table>
<hr>
<div class="paragraph">
<p>&#169; 2019-2022 rxmicro.io.
Free use of this software is granted under the terms of the <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/LICENSE" target="_blank" rel="noopener"><code>Apache License 2.0</code></a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Copies of this entity may be made for Your own use and for distribution to others, provided that You do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</p>
</div>
<div class="paragraph">
<p>If You find errors or omissions in this entity, please don’t hesitate to submit an
<a href="https://github.com/rxmicro/rxmicro-usage/issues" target="_blank" rel="noopener"><strong>issue</strong></a> or open <a href="https://github.com/rxmicro/rxmicro-usage/pulls" target="_blank" rel="noopener"><strong>a pull request</strong></a> with a fix.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This section will describe the basic working concepts of the RxMicro framework.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="core-how-it-works-section"><a class="anchor" href="#core-how-it-works-section"></a><a class="link" href="#core-how-it-works-section">1. How It Works?</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The RxMicro framework uses the
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.compiler/javax/annotation/processing/Processor.html" target="_blank" rel="noopener">Java annotation processor</a>, which generates standard code using <code>RxMicro Annotations</code>.</p>
</div>
<div class="paragraph">
<p>Thus, the RxMicro framework is a framework of declarative programming.</p>
</div>
<div class="paragraph">
<p>Using the RxMicro framework, the developer focuses on writing the business logic of a microservice.
Then he configures the desired standard behavior with <code>RxMicro Annotations</code>.
When compiling a project, the <code>RxMicro Annotation Processor</code> generates additional classes.
Generated classes contain a standard logic that ensures the functionality of the created microservice.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="core-how-it-works-core-schema"><a class="anchor" href="#core-how-it-works-core-schema"></a><a class="link" href="#core-how-it-works-core-schema">1.1. A Common Work Schema</a></h3>
<div class="paragraph">
<p>The common work schema can be presented as follows:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/core/how-it-work/core-schema.jpg" alt="core schema">
</div>
<div class="title">Figure 1. The RxMicro framework common work schema.</div>
</div>
<div class="paragraph">
<p>While solving a business task, the developer writes <code>Micro service source code</code>.
Then the developer configures the desired standard microservice behavior via <code>RxMicro Annotations</code>.
After that, the developer compiles the project.</p>
</div>
<div class="paragraph">
<p>Since the <code>RxMicro Annotation Processor</code> is configured in <code>maven</code>, when compiling a project this processor handles the source code of the microservice and generates the additional classes: <code>Micro service generated code</code>.
After that, the compiler compiles the source and generated microservice codes: <code>Micro service byte code</code> and <code>Micro service generated byte code</code>.</p>
</div>
<div class="paragraph">
<p>The compiled source and generated codes along with the <code>RxMicro runtime libraries</code> perform useful work.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="generating_of_additional_classes"><a class="anchor" href="#generating_of_additional_classes"></a><a class="link" href="#generating_of_additional_classes">1.2. Generating of Additional Classes.</a></h3>
<div class="paragraph">
<p>Let&#8217;s have a look at <a href="#core-how-it-works-core-schema">the RxMicro framework common work schema</a>, by the example of the REST-based microservice project, which displays the <code>"Hello World!"</code> message in JSON format.<br>
<em>(This project was considered in the <a href="quick-start.html#quick-start-section">quick-start.html</a> section.)</em></p>
</div>
<div class="paragraph">
<p>While implementing a business task (in this example, it&#8217;s a task of displaying the <code>"Hello World!"</code> message in JSON format) the developer wrote the following <code>Micro service source code</code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/core/how-it-work/micro-src.jpg" alt="micro src">
</div>
</div>
<div class="paragraph">
<p>In order to inform the RxMicro framework about the need to generate additional classes by which a written <code>Micro service source code</code> can be built into an HTTP server to handle the desired HTTP requests, the developer added the following <code>RxMicro Annotation</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@GET("/")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the <code>RxMicro Annotation Processor</code> is configured in maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;configuration&gt;
    &lt;annotationProcessors&gt;
        &lt;annotationProcessor&gt;
            io.rxmicro.annotation.processor.RxMicroAnnotationProcessor
        &lt;/annotationProcessor&gt;
    &lt;/annotationProcessors&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>then when compiling a project this processor handles the source code of the REST-based microservice and generates the <code>Micro service generated code</code> additional classes:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/core/how-it-work/micro-gen-src.jpg" alt="micro gen src">
</div>
</div>
<div class="paragraph">
<p>After the source code of additional classes was successfully generated by the <code>RxMicro Annotation Processor</code>, the compiler compiles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>REST-based microservice source code in <code>Micro service byte code</code>:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/core/how-it-work/micro-byte.jpg" alt="micro byte">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Generated code of additional classes in <code>Micro service byte code</code>:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/core/how-it-work/micro-gen-byte.jpg" alt="micro gen byte">
</div>
</div>
<div class="paragraph">
<p>As a result of the compiler&#8217;s work, the REST-based microservice byte code and the byte code of the generated additional classes will be stored jointly in the same <code>jar</code> archive:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/core/how-it-work/all-byte.jpg" alt="all byte">
</div>
</div>
<div class="paragraph">
<p>For successful start of the compiled classes, the <code>RxMicro runtime libraries</code> are required:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/core/how-it-work/rxmicro-runtime-libs.jpg" alt="rxmicro runtime libs">
</div>
</div>
<div class="paragraph">
<p>The <code>Micro service byte code</code>, <code>Micro service byte code</code> and <code>RxMicro runtime libraries</code> are the program components of microservice, which perform useful work.</p>
</div>
<div class="paragraph">
<p>Below we will look closely at each generated additional class and what functions it performs.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The names of all classes generated by the RxMicro framework start with the <code>$$</code> prefix.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="an_additional_class_for_the_rest_controller"><a class="anchor" href="#an_additional_class_for_the_rest_controller"></a><a class="link" href="#an_additional_class_for_the_rest_controller">1.2.1. An Additional Class for the REST Controller.</a></h4>
<div class="paragraph">
<p>Any REST-based microservice, contains at least one REST controller.
For the simplest project, REST-based microservice and REST controller are the same class.</p>
</div>
<div class="paragraph">
<p>Therefore, when analyzing such projects, such terms as <strong>REST controller</strong>, <strong>REST-based microservice</strong> and <strong>microservice</strong> are synonymous, because physically they are the same class.</p>
</div>
<div class="paragraph">
<p>The considered REST-based microservice, which displays the <code>"Hello World!"</code> message, is the simplest project, therefore the <code>HelloWorldMicroService</code> class is a REST controller.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information on the differences between <strong>REST controller</strong>, <strong>REST-based microservice</strong> and <strong>microservice</strong>, refer to the <a href="microservice.html#microservice-section">microservice.html</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For each REST controller class the RxMicro framework generates an additional class that performs the following functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creates a REST controller object.<br>
<em>(In case of <a href="cdi.html#cdi-section"><code>rxmicro.cdi</code></a> module activation, after creation it also injects the required dependencies.)</em></p>
</li>
<li>
<p>Creates <code>ModelReader</code> objects that convert HTTP request parameters, headers and body to Java model.</p>
</li>
<li>
<p>Creates <code>ModelWriter</code> objects that convert the Java response model to HTTP response headers and body;</p>
</li>
<li>
<p>Registers all HTTP request handlers of current REST controller in the router.</p>
</li>
<li>
<p>When receiving an HTTP request via the <code>ModelReader</code> object, converts the HTTP request to the Java request model and invokes the corresponding REST controller handler.</p>
</li>
<li>
<p>After receiving the resulting Java response model via the <code>ModelWriter</code> object, converts the Java model into an HTTP response and sends the response to the client.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Such an additional class for the <code>HelloWorldMicroService</code> class is the <code>$$HelloWorldMicroService</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class $$HelloWorldMicroService extends AbstractRestController {

    private HelloWorldMicroService restController;

    private $$ResponseModelWriter responseModelWriter;

    @Override
    protected void postConstruct() {
        restController = new HelloWorldMicroService(); <i class="conum" data-value="1"></i><b>(1)</b>
        responseModelWriter =
                new $$ResponseModelWriter(restServerConfig.isHumanReadableOutput()); <i class="conum" data-value="2"></i><b>(2)</b>
    }

    @Override
    public void register(final RestControllerRegistrar registrar) { <i class="conum" data-value="3"></i><b>(3)</b>
        registrar.register(
                this,
                new Registration(
                        "",
                        "sayHelloWorld()",
                        this::sayHelloWorld, <i class="conum" data-value="4"></i><b>(4)</b>
                        false,
                        new ExactUrlRequestMappingRule( <i class="conum" data-value="5"></i><b>(5)</b>
                                "GET",
                                "/",
                                false
                        )
                )
        );
    }

    private CompletionStage&lt;HttpResponse&gt; sayHelloWorld(final PathVariableMapping mapping,
                                                        final HttpRequest request) {
        final HttpHeaders headers = HttpHeaders.of();
        return restController.sayHelloWorld() <i class="conum" data-value="6"></i><b>(6)</b>
                .thenApply(response -&gt; buildResponse(response, 200, headers)); <i class="conum" data-value="7"></i><b>(7)</b>
    }

    private HttpResponse buildResponse(final Response model,
                                       final int statusCode,
                                       final HttpHeaders headers) {
        final HttpResponse response = httpResponseBuilder.build();
        response.setStatus(statusCode);
        response.setOrAddHeaders(headers);
        responseModelWriter.write(model, response); <i class="conum" data-value="8"></i><b>(8)</b>
        return response;
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>$$HelloWorldMicroService</code> component creates an instance of the REST controller class.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>$$HelloWorldMicroService</code> component creates an instance of the <code>ModelWriter</code> that converts the Java response model to the HTTP response headers and body.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>$$HelloWorldMicroService</code> component registers all HTTP request handlers of the current REST controller.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The registration object contains a reference to the HTTP request handler of the current REST controller.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The registration object contains a rule, according to which the router determines whether to invoke this HTTP request handler.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>When receiving HTTP request, the <code>$$HelloWorldMicroService</code> invokes REST controller method.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>After invoking the REST controller method, an asynchronous result handler is added.<br>
<em>(When using the reactive approach, <a href="#core-dont-block-current-thread">the current thread cannot be blocked</a>, so the
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CompletionStage.html#thenApply(java.util.function.Function)" target="_blank" rel="noopener"><code>thenApply</code></a> method is used for delayed result handling.)</em></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>After receiving the Java response model object, the result handler creates an HTTP response based on the data received from the model, which is subsequently sent to the client.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="an_modelwriter_class"><a class="anchor" href="#an_modelwriter_class"></a><a class="link" href="#an_modelwriter_class">1.2.2. An <code>ModelWriter</code> Class.</a></h4>
<div class="paragraph">
<p>To convert a Java model to an HTTP response, You will need a separate component that performs the following functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Defines in what format to return an HTTP response depending on the project settings.</p>
</li>
<li>
<p>Creates converter objects that support the specified messaging format.</p>
</li>
<li>
<p>When converting a Java model to an HTTP response, manages the conversion process by delegating invocations to the appropriate components.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Such a separate component for the <code>Response</code> model class is the <code>$$ResponseModelWriter</code> class:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The code of the <code>$$ResponseModelWriter</code> generated class depends on the response model class structure, and the format used for message exchange with the client.</p>
</div>
<div class="paragraph">
<p>Since the format of message exchange with the client is set in <code>module-info.java</code> of the project (<code>requires rxmicro.rest.server.exchange.json;</code>), and is the configuration for all REST controllers and all their handlers, then within the current project, the <code>$$ResponseModelWriter</code> will depend only on the response model class structure.</p>
</div>
<div class="paragraph">
<p>Therefore, if several handlers from different REST controllers will return the <code>Response</code> class model, only one <code>$$ResponseModelWriter</code> class will be generated.
As a result, in each additional REST controller class, the instance of this class will be used.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class $$ResponseModelWriter extends ModelWriter&lt;Response&gt; {

    private final $$ResponseModelToJsonConverter responseModelToJsonConverter; <i class="conum" data-value="1"></i><b>(1)</b>

    private final ExchangeDataFormatConverter&lt;Object&gt; exchangeDataFormatConverter; <i class="conum" data-value="2"></i><b>(2)</b>

    private final String outputMimeType;

    public $$ResponseModelWriter(final boolean humanReadableOutput) {
        exchangeDataFormatConverter =
            new JsonExchangeDataFormatConverter(humanReadableOutput); <i class="conum" data-value="3"></i><b>(3)</b>
        responseModelToJsonConverter = new $$ResponseModelToJsonConverter();
        outputMimeType = exchangeDataFormatConverter.getMimeType();
    }

    @Override
    public void write(final Response model,
                      final HttpResponse response) {
        response.setHeader(HttpHeaders.CONTENT_TYPE, outputMimeType); <i class="conum" data-value="4"></i><b>(4)</b>
        final Map&lt;String, Object&gt; json = responseModelToJsonConverter.toJsonObject(model); <i class="conum" data-value="5"></i><b>(5)</b>
        response.setContent(exchangeDataFormatConverter.toBytes(json)); <i class="conum" data-value="6"></i><b>(6)</b>
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Since the JSON message exchange format is specified in the settings, a component that can convert the Java response model to a JSON response model is required.
<em>(This task is specific for each response model, so to avoid using <code>reflection</code>, You need to generate a separate converter component.)</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>To convert any low-level model (in this example, it&#8217;s a JSON response model) into a byte array, You also need a separate converter component.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Since the JSON messaging format is specified in the settings, it is assumed that the JSON model will be converted to an byte array, which will be created from the Java response model.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Since the JSON message exchange format is specified in the settings, it is necessary to set the HTTP header: <code>Content-Type = application/json</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>When the HTTP response is formed, it is necessary to convert Java response model to JSON model.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The last step is to convert the JSON model to a byte array, that will be written to the HTTP response body.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="a_java_model_converter"><a class="anchor" href="#a_java_model_converter"></a><a class="link" href="#a_java_model_converter">1.2.3. A Java Model Converter.</a></h4>
<div class="paragraph">
<p>To avoid using <code>reflection</code>, You need a component that can convert Java model to JSON model.</p>
</div>
<div class="paragraph">
<p>This component must support the following functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Convert Java model to JSON model of any complexity.</p>
</li>
<li>
<p>Support all possible class field access models to be an all-purpose tool.<br>
<em>(Supported class field access models are described in details in the <a href="#core-encapsulation">Section 7, &#8220;Encapsulation&#8221;</a>.)</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Such a separate component for the <code>Response</code> model class is the <code>$$ResponseModelToJsonConverter</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class $$ResponseModelToJsonConverter extends ModelToJsonConverter&lt;Response&gt; {

    @Override
    <i class="conum" data-value="1"></i><b>(1)</b>
    public Map&lt;String, Object&gt; toJsonObject(final Response model) {
        final JsonObjectBuilder builder = new JsonObjectBuilder();
        putValuesToBuilder(model, builder);
        return builder.build();
    }

    public void putValuesToBuilder(final Response model,
                                   final JsonObjectBuilder builder) {
        builder.put("message", model.message); <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>JSON object is presented as <code>Map&lt;String, Object&gt;</code>.<br>
<em>(More information about JSON format support by the RxMicro framework can be found in the <a href="#core-rx-micro-json-section">Section 10, &#8220;JSON&#8221;</a>.)</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The value of the <code>message</code> field is read from the Java model by direct reference to the field.<br>
<em>(Supported class field access models are described in details in the <a href="#core-encapsulation">Section 7, &#8220;Encapsulation&#8221;</a>.)</em></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="an_aggregator_of_the_rest_controllers"><a class="anchor" href="#an_aggregator_of_the_rest_controllers"></a><a class="link" href="#an_aggregator_of_the_rest_controllers">1.2.4. An Aggregator of the REST Controllers.</a></h4>
<div class="paragraph">
<p>To integrate developer code into the RxMicro framework infrastructure, You need aggregators.</p>
</div>
<div class="paragraph">
<p>The aggregators perform the following functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Register all generated additional classes for REST controllers;</p>
</li>
<li>
<p>Customize the runtime environment;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The aggregators are invoked by the RxMicro framework using <code>reflection</code>.<br>
<em>(That' s why aggregators have a permanent and predefined names and are located in the special package: <code>rxmicro</code>.)</em></p>
</div>
<div class="paragraph">
<p><strong>An Aggregator of the REST Controllers for any project is always the <code>rxmicro.MODULE_NAME.$$RestControllerAggregatorImpl</code> class</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package rxmicro.MODULE_NAME; <i class="conum" data-value="1"></i><b>(1)</b>

public final class $$RestControllerAggregatorImpl extends RestControllerAggregator { <i class="conum" data-value="2"></i><b>(2)</b>

    static {
        $$EnvironmentCustomizer.customize(); <i class="conum" data-value="3"></i><b>(3)</b>
    }

    protected List&lt;AbstractMicroService&gt; listAllRestControllers() {
        return List.of(
                new io.rxmicro.examples.quick.start.$$HelloWorldMicroService() <i class="conum" data-value="4"></i><b>(4)</b>
        );
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All aggregators are <strong>always</strong> generated in the special package: <code>rxmicro.MODULE_NAME</code>, where <code>MODULE_NAME</code> is the module name or <code>unnamed</code> constant if the current project does not declare the <code>module-info.java</code> descriptor (Read more: <a href="java-integration.html#java-integration-unnamed-module"><code>Unnamed Modules Support</code></a>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The predefined name of the REST controller aggregator class is always <code>$$RestControllerAggregatorImpl</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>When the aggregator class is loaded by the RxMicro framework, the component of the <a href="#core-how-it-works-environment-customizer">current environment customization</a> is invoked.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The aggregator registers all generated additional classes for REST controllers;</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="core-how-it-works-environment-customizer"><a class="anchor" href="#core-how-it-works-environment-customizer"></a><a class="link" href="#core-how-it-works-environment-customizer">1.2.5. An Environment Customizer.</a></h4>
<div class="paragraph">
<p>Java 9 has introduced the <a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html" target="_blank" rel="noopener"><code>JPMS</code></a>.</p>
</div>
<div class="paragraph">
<p>This system requires that a developer configures access to classes in the <code>module-info.java</code> file of the microservice project.</p>
</div>
<div class="paragraph">
<p>To enable the RxMicro framework to load aggregator classes, You must export the <code>rxmicro.MODULE_NAME</code> package to the <code>rxmicro.reflection</code> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">module examples.quick.start {
    requires rxmicro.rest.server.netty;
    requires rxmicro.rest.server.exchange.json;

    exports rxmicro.MODULE_NAME to rxmicro.reflection; <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allow access of reflection util classes from the <code>rxmicro.reflection</code> module to all classes from the <code>rxmicro.MODULE_NAME</code> package.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>But the <code>rxmicro.MODULE_NAME</code> package is created automatically and after deleting all the generated files, it won&#8217;t be possible to compile the <code>module-info.java</code> because of the following error:</p>
</div>
<div class="paragraph">
<p><code>package is empty or does not exist: rxmicro.MODULE_NAME</code>.</p>
</div>
<div class="paragraph">
<p>To solve this problem, the RxMicro framework generates the <code>rxmicro.MODULE_NAME.$$EnvironmentCustomizer</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package rxmicro.MODULE_NAME; <i class="conum" data-value="1"></i><b>(1)</b>

final class $$EnvironmentCustomizer {

    static {
        exportTheRxmicroPackageToReflectionModule(); <i class="conum" data-value="2"></i><b>(2)</b>
        invokeAllStaticSections($$EnvironmentCustomizer.class.getModule(), "$$EnvironmentCustomizer"); <i class="conum" data-value="3"></i><b>(3)</b>
        // All required customization must be here
    }

    public static void customize() {
        //do nothing. All customization is done at the static section
    }

    private static void exportTheRxmicroPackageToReflectionModule() {
        final Module currentModule = $$EnvironmentCustomizer.class.getModule();
        currentModule.addExports("rxmicro.MODULE_NAME", RX_MICRO_REFLECTION_MODULE); <i class="conum" data-value="4"></i><b>(4)</b>
    }

    private $$EnvironmentCustomizer() {
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All customizers are <strong>always</strong> generated in the special package: <code>rxmicro.MODULE_NAME</code>, where <code>MODULE_NAME</code> is the module name or <code>unnamed</code> constant if the current project does not declare the <code>module-info.java</code> descriptor (Read more: <a href="java-integration.html#java-integration-unnamed-module"><code>Unnamed Modules Support</code></a>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When the class is loaded, the <code>exportTheRxmicroPackageToReflectionModule()</code> static method is invoked.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Finds all <code>$$EnvironmentCustomizer</code> classes that are defined in other modules in the current module path and invokes static sections.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>In this method body, the export of the <code>rxmicro.MODULE_NAME</code> package to the <code>rxmicro.reflection</code> module is performed dynamically using the capabilities of the <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Module.html" target="_blank" rel="noopener"><code>java.lang.Module</code></a> class.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Due to this additional class, all necessary settings for the <a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html" target="_blank" rel="noopener"><code>JPMS</code></a> are created automatically.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the RxMicro framework needs additional automatic settings for its correct work, these settings will be automatically added by the <code>RxMicro Annotation Processor</code> to the <code>rxmicro.MODULE_NAME.$$EnvironmentCustomizer</code> class.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="using_the_debug_mode"><a class="anchor" href="#using_the_debug_mode"></a><a class="link" href="#using_the_debug_mode">1.3. Using the Debug Mode</a></h3>
<div class="paragraph">
<p>To get a better idea of how the RxMicro framework works, You can use the debug mode.</p>
</div>
<div class="paragraph">
<p>To do this, set breakpoints and start the microservice in debug mode.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/core/how-it-work/micro-service-start-debug.jpg" alt="micro service start debug">
</div>
<div class="title">Figure 2. Starting the microservice in debug mode.</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The code generated by the <code>RxMicro Annotation Processor</code> is a usual source code.
So You can use breakpoints for this code as well as for Your source code.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/core/how-it-work/micro-service-handle-request-debug.jpg" alt="micro service handle request debug">
</div>
<div class="title">Figure 3. HTTP request handling by microservice in debug mode.</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rxmicro-annotation-processor-options-section"><a class="anchor" href="#rxmicro-annotation-processor-options-section"></a><a class="link" href="#rxmicro-annotation-processor-options-section">2. <code>RxMicro Annotation Processor</code> Options</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>RxMicro Annotation Processor</code> supports the following options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Options supported by the <code>RxMicro Annotation Processor</code>.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Option</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
<th class="tableblock halign-left valign-top"><strong>Type</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RX_MICRO_MAX_JSON_NESTED_DEPTH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximum stack size for recursive invocations when analyzing models containing JSON nested objects.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>positive int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RX_MICRO_LOG_LEVEL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RxMicro Annotation Processor</code> logging level.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum {<code>OFF</code>, <code>INFO</code>, <code>DEBUG</code>}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INFO</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RX_MICRO_DOC_DESTINATION_DIR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the resulting directory <a href="project-documentation.html#project-documentation-section">for generated documentation</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asciidoc: <code>./src/main/asciidoc</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RX_MICRO_BUILD_UNNAMED_MODULE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the <a href="java-integration.html#java-integration-unnamed-module"><code>unnamed module</code></a> support for a microservice project.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RX_MICRO_DOC_ANALYZE_PARENT_POM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">this option allows analyzing parent <code>pom.xml</code> if child <code>pom.xml</code> does not contain required property.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RX_MICRO_STRICT_MODE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">activates additional validation rules during compilation process.</p>
<p class="tableblock"><strong>The RxMicro team strong recommends enabling the strict mode for your production code.</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These options are set using the compiler arguments in <code>maven-compiler-plugin</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
    &lt;version&gt;${maven-compiler-plugin.version}&lt;/version&gt;
    &lt;configuration&gt;
        &lt;release&gt;11&lt;/release&gt;
        &lt;compilerArgs&gt;
            &lt;arg&gt;-ARX_MICRO_MAX_JSON_NESTED_DEPTH=20&lt;/arg&gt;
            &lt;arg&gt;-ARX_MICRO_LOG_LEVEL=INFO&lt;/arg&gt;
            &lt;arg&gt;-ARX_MICRO_DOC_DESTINATION_DIR=./src/main/asciidoc&lt;/arg&gt;
            &lt;arg&gt;-ARX_MICRO_BUILD_UNNAMED_MODULE=false&lt;/arg&gt;
            &lt;arg&gt;-ARX_MICRO_DOC_ANALYZE_PARENT_POM=true&lt;/arg&gt;
            &lt;arg&gt;-ARX_MICRO_STRICT_MODE=false&lt;/arg&gt;
        &lt;/compilerArgs&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that it is necessary to add the <code>-A</code> prefix before setting the value of the option.</p>
</div>
<div class="paragraph">
<p>The common format is as follows: <code>-A${name}=${value}</code>.
For example: <code>-ARX_MICRO_LOG_LEVEL=OFF</code></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="core-dont-block-current-thread"><a class="anchor" href="#core-dont-block-current-thread"></a><a class="link" href="#core-dont-block-current-thread">3. Don&#8217;t Block Current Thread!</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In modern computer architecture, IO operations are the slowest ones.
As a result, when using
<a href="https://en.wikipedia.org/wiki/Multithreading_(computer_architecture)" target="_blank" rel="noopener">multithreading programming model</a>, the use of CPU and RAM is extremely inefficient.
For a single-user monolithic application such inefficiency is imperceptible.
But for a multi-user distributed application with a much higher number of IO operations, this problem generates huge financial costs for additional hardware and coordination between client data streams (Read more: <a href="https://en.wikipedia.org/wiki/C10k_problem" target="_blank" rel="noopener">C10k problem</a>).</p>
</div>
<div class="paragraph">
<p>Therefore, the <a href="https://en.wikipedia.org/wiki/Event-driven_architecture" target="_blank" rel="noopener">Event-driven architecture (EDA)</a> is used for efficient use of the hardware resources of a multi-user distributed application.</p>
</div>
<div class="paragraph">
<p>The most popular Java framework that uses Event-driven architecture for IO operations is <a href="https://netty.io/" target="_blank" rel="noopener">Netty</a>.
To write efficient programs using Netty, it is necessary to comply with certain rules and restrictions.
The most important of these is the following requirement: <strong>Don&#8217;t block current thread!</strong></p>
</div>
<div class="paragraph">
<p>The RxMicro framework is a framework that runs on Netty.
Therefore, all requirements for applications that utilize Netty also cover the RxMicro framework.</p>
</div>
<div class="sect2">
<h3 id="prohibited_operations"><a class="anchor" href="#prohibited_operations"></a><a class="link" href="#prohibited_operations">3.1. Prohibited Operations</a></h3>
<div class="paragraph">
<p>Consequently, when writing microservice applications based on the RxMicro framework, the following operations are <strong>prohibited</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Data reading from a socket or file in a blocking style using <code>java.io.InputStream</code> and child classes.</p>
</li>
<li>
<p>Data writing to a socket or file in a blocking style using <code>java.io.OutputStream</code> and child classes.</p>
</li>
<li>
<p>Interaction with a database using of the blocking driver (all <code>JDBC</code> drivers).</p>
</li>
<li>
<p>Waiting on a lock or a monitor (<code>java.util.concurrent.locks.Lock</code>, <code>Object.wait</code>).</p>
</li>
<li>
<p>Putting the thread into sleep mode (<code>Thread.sleep</code>, <code>TimeUnit.sleep</code>).</p>
</li>
<li>
<p>Any other <a href="https://en.wikipedia.org/wiki/Blocking_(computing)" target="_blank" rel="noopener"><strong>blocking operations</strong></a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="recommended_approach"><a class="anchor" href="#recommended_approach"></a><a class="link" href="#recommended_approach">3.2. Recommended Approach</a></h3>
<div class="paragraph">
<p>The absence of blocking operations in the microservice allows handling many concurrent connections, using a small number of threads and, as a result, to effectively use hardware resources of the computer.</p>
</div>
<div class="paragraph">
<p>Therefore, when designing microservices via the RxMicro framework, You must follow by the following rule:</p>
</div>
<div class="paragraph">
<p><strong>When implementing a microservice, if the result can be obtained immediately, it must be returned immediately.</strong></p>
</div>
<div class="paragraph">
<p><strong>Otherwise, You must return
<a href="https://github.com/reactive-streams/reactive-streams-jvm/blob/v1.0.3/README.md#specification" target="_blank" rel="noopener">Publisher</a> or
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CompletableFuture.html" target="_blank" rel="noopener">CompletableFuture</a>, which will generate the result later.</strong></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="core-reactive-libraries-support"><a class="anchor" href="#core-reactive-libraries-support"></a><a class="link" href="#core-reactive-libraries-support">4. Reactive Libraries Support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The RxMicro framework supports the following reactive programming libraries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/package-summary.html" target="_blank" rel="noopener"><strong>java.util.concurrent</strong></a>:
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CompletableFuture.html" target="_blank" rel="noopener">CompletableFuture</a>,
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CompletionStage.html" target="_blank" rel="noopener">CompletionStage</a>;</p>
</li>
<li>
<p><a href="https://projectreactor.io/docs/core/release/reference/index.html" target="_blank" rel="noopener"><strong>Project Reactor</strong>: Mono, Flux</a>;</p>
</li>
<li>
<p><a href="https://github.com/ReactiveX/RxJava/blob/3.x/README.md" target="_blank" rel="noopener"><strong>RxJava</strong>: Completable, Single, Maybe, Flowable</a>;</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="core-reactive-bussiness-process-result-types-section"><a class="anchor" href="#core-reactive-bussiness-process-result-types-section"></a><a class="link" href="#core-reactive-bussiness-process-result-types-section">4.1. Expected Business Process Results</a></h3>
<div class="paragraph">
<p>When writing reactive programs, the following 4 expected results of any business process are possible:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It is important to complete the business process, but the result is missing or unimportant.</p>
</li>
<li>
<p>The business process returns the result in a single instance or nothing.</p>
</li>
<li>
<p>The business process returns the required result in a single instance.</p>
</li>
<li>
<p>The business process returns the result as <code>(0 .. n)</code> object stream.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When writing a business service using reactive libraries, it is recommended to comply with the following agreements:</p>
</div>
<table id="core-reactive-bussiness-process-reactive-class-mapping-table" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Which class from a reactive library must be choose?</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Reactive Library</strong></th>
<th class="tableblock halign-left valign-top"><strong>java.util.concurrent</strong></th>
<th class="tableblock halign-left valign-top"><strong>Project Reactor</strong></th>
<th class="tableblock halign-left valign-top"><strong>RxJava3</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Without result</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CompletableFuture&lt;Void&gt;
CompletionStage&lt;Void&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mono&lt;Void&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Completable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Optional result</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CompletableFuture&lt;Optional&lt;MODEL&gt;&gt;
CompletionStage&lt;Optional&lt;MODEL&gt;&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mono&lt;MODEL&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maybe&lt;MODEL&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Required result</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CompletableFuture&lt;MODEL&gt;
CompletionStage&lt;MODEL&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mono&lt;MODEL&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single&lt;MODEL&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Stream result</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CompletableFuture&lt;List&lt;MODEL&gt;&gt;
CompletionStage&lt;List&lt;MODEL&gt;&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flux&lt;MODEL&gt;, Mono&lt;List&lt;MODEL&gt;&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flowable&lt;MODEL&gt;, Single&lt;List&lt;MODEL&gt;&gt;</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>The following types of results <code>Flux&lt;MODEL&gt;</code> and <code>Mono&lt;List&lt;MODEL&gt;&gt;</code>, as well as <code>Flowable&lt;MODEL&gt;</code>, <code>Single&lt;List&lt;MODEL&gt;&gt;</code> are not absolutely equivalent!</strong></p>
</div>
<div class="paragraph">
<p>For the <code>Flux&lt;MODEL&gt;</code> and <code>Flowable&lt;MODEL&gt;</code> types, the result handler can be invoked before all data is received from a data source, e.g. from a database.</p>
</div>
<div class="paragraph">
<p>Whereas for <code>Mono&lt;List&lt;MODEL&gt;&gt;</code> and <code>Single&lt;List&lt;MODEL&gt;&gt;</code>
the result handler is invoked <strong>only</strong> after <strong>all</strong> the data is received from the data source!</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="recommendations_for_choosing_a_library"><a class="anchor" href="#recommendations_for_choosing_a_library"></a><a class="link" href="#recommendations_for_choosing_a_library">4.2. Recommendations for Choosing a Library</a></h3>
<div class="paragraph">
<p>General recommendation for choosing a reactive programming library when using the RxMicro framework:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If Your microservice contains simple logic, You can use the lightweight and Java-provided
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/package-summary.html" target="_blank" rel="noopener"><strong>java.util.concurrent</strong></a> library, represented by the
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CompletableFuture.html" target="_blank" rel="noopener"><code>CompletableFuture</code></a> class and the <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CompletionStage.html" target="_blank" rel="noopener"><code>CompletionStage</code></a> interface.</p>
</li>
<li>
<p>If Your microservice contains more complex logic, to describe which You need to use
<a href="http://reactivex.io/documentation/operators.html" target="_blank" rel="noopener">complex operators</a>, it is recommended to choose <strong>Project Reactor</strong> or <strong>RxJava</strong>.</p>
</li>
<li>
<p>When choosing between the <strong>Project Reactor</strong> and <strong>RxJava</strong> follow the recommendations:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If You are more familiar with the <strong>Project Reactor</strong>, then use it, otherwise use <strong>RxJava</strong>.</p>
</li>
<li>
<p>If You need <code>r2dbc</code> based reactive SQL repositories (<code>rxmicro.data.sql.r2dbc</code> module), then use the <strong>Project Reactor</strong>.<br>
<em>(Since <code>r2dbc</code> drivers already use the <strong>Project Reactor</strong>.)</em></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Thus, when writing microservices via the RxMicro framework, You can use any Java reactive programming library that You prefer!</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>FYI</strong> All libraries support a blocking getting of the result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class BlockingGetResult {

    public static void main(final String[] args) {
        final String blockingResult1 =
                CompletableFuture.completedFuture("Hello")
                        .join();

        final String blockingResult2 =
                Mono.just("Hello")
                        .block();

        final String blockingResult3 =
                Single.just("Hello")
                        .blockingGet();

        System.out.println(blockingResult1);
        System.out.println(blockingResult2);
        System.out.println(blockingResult3);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The main need in blocking getting of the result, using reactive programming, arises at Unit testing implementation.
Since the main popular frameworks for unit testing (<a href="https://junit.org/junit5/" target="_blank" rel="noopener"><code>JUnit</code></a>, <a href="https://testng.org/" target="_blank" rel="noopener"><code>TestNG</code></a>, etc.) use the usual thread (blocking) programming model.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="base_model"><a class="anchor" href="#base_model"></a><a class="link" href="#base_model">5. Base Model</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Java applications use <code>java.lang.Object.toString()</code> method very often for debug purposes.
Thus a developer must override this method for all model classes in his(her) project.</p>
</div>
<div class="paragraph">
<p>To help with overriding of this method for all model classes the RxMicro framework introduces the <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-model/src/main/java/io/rxmicro/model/BaseModel.java" target="_blank" rel="noopener"><code>BaseModel</code></a> class.
This class uses the <code>reflection</code> to generate string representation of the model class on fly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class CustomModel extends BaseModel {

    String string;

    Integer integer;

    //...

    //toString method not necessary!
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>reflection</code> mechanism is slow one, so use the generated string representation of the model class only for debug purposes!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>According to <a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html" target="_blank" rel="noopener"><code>JPMS</code></a> requirements all <code>reflection</code> access must be configured at the <code>module-info.java</code> descriptor using <code>exports</code> or opens` instructions.
It means that for correct usage the <code>BaseModel</code> feature, it is necessary to add the following instruction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">opens io.rxmicro.examples.base.model.model.package4 to
        rxmicro.reflection;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>io.rxmicro.examples.base.model.model.package4</code> is the package that contains custom model classes.</p>
</div>
<div class="paragraph">
<p>But the <code>BaseModel</code> feature is designed for debug purposes, so required <code>exports</code> or <code>opens</code> instructions are added automatically via generated <a href="#core-how-it-works-environment-customizer"><code>$$EnvironmentCustomizer</code></a> class if You do not add these instructions manually!
So You can use the <code>BaseModel</code> feature without any <code>module-info.java</code> modifications for Your project!</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="strings_formatting"><a class="anchor" href="#strings_formatting"></a><a class="link" href="#strings_formatting">6. Strings Formatting</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>While developing a software product it is necessary to format strings.</p>
</div>
<div class="paragraph">
<p>For this purpose, Java provides different approaches:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Mono&lt;? extends Result&gt; executeQuery(final Connection connection,
                                    final Long id) {
    final String sql = "SELECT * FROM account WHERE id = $1"; <i class="conum" data-value="1"></i><b>(1)</b>
    SLF4J_LOGGER.info("SQL: {}", sql); <i class="conum" data-value="2"></i><b>(2)</b>
    return Mono.from(connection.createStatement(sql)
            .bind(0, id)
            .execute())
            .onErrorResume(e -&gt; Mono.error(
                    new IllegalArgumentException(
                            String.format(
                                    "SQL '%s' contains syntax error: %s", sql, e.getMessage() <i class="conum" data-value="3"></i><b>(3)</b>
                            ))
                    )
            );
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>To generate an SQL query, You need to use <code>$1</code> placeholder.<br>
<em>(This placeholder depends on the used <a href="https://r2dbc.io/spec/1.0.0.RELEASE/spec/html/#statements.parameterized" target="_blank" rel="noopener">R2DBC driver</a>.
For postgresql, it&#8217;s a <code>$1</code> symbol.)</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>To generate a logging message, You need to use <code>{}</code> placeholder.<br>
<em>(This placeholder depends on the logging library used.
For SLF4J, it&#8217;s a <code>{}</code> symbol.)</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>To generate an error message, You need to use <code>%s</code> placeholder from a separate utility class, for example
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html#format(java.lang.String,java.lang.Object&#8230;&#8203;)" target="_blank" rel="noopener"><code>String.format</code></a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>While writing the code, a developer can easily confuse the required placeholder.</p>
</div>
<div class="paragraph">
<p><strong>To avoid such a problem, the RxMicro framework recommends using the universal <code>?</code> placeholder</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Mono&lt;? extends Result&gt; executeQuery(final Connection connection,
                                    final Long id) {
    final String sql = "SELECT * FROM account WHERE id = ?"; <i class="conum" data-value="1"></i><b>(1)</b>
    RX_MICRO_LOGGER.info("SQL: ?", sql); <i class="conum" data-value="2"></i><b>(2)</b>
    return Mono.from(connection.createStatement(sql)
            .bind(0, id)
            .execute())
            .onErrorResume(e -&gt; Mono.error(
                    new InvalidStateException(
                            "SQL '?' contains syntax error: ?", sql, e.getMessage()) <i class="conum" data-value="3"></i><b>(3)</b>
                    )
            );
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>To generate an SQL query, You need to use <code>?</code> placeholder.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>To generate a logging message, You need to use <code>?</code> placeholder.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>To generate an error message, You need to use <code>?</code> placeholder.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="core-encapsulation"><a class="anchor" href="#core-encapsulation"></a><a class="link" href="#core-encapsulation">7. Encapsulation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>When designing Java request and response models, there is a need to
<a href="https://en.wikipedia.org/wiki/Encapsulation_(computer_programming)" target="_blank" rel="noopener">protect data from unauthorized modification</a>.</p>
</div>
<div class="sect2">
<h3 id="a_private_modifier_usage"><a class="anchor" href="#a_private_modifier_usage"></a><a class="link" href="#a_private_modifier_usage">7.1. A <code>private</code> Modifier Usage</a></h3>
<div class="paragraph">
<p>The standard solution to this problem in Java is using the <code>private</code> modifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final class Response {

    private final String message; <i class="conum" data-value="1"></i><b>(1)</b>

    Response(final String message) {
        this.message = requireNonNull(message);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>By declaring the <code>message</code> field as <code>private</code>, the developer allows access to this field only from inside the class.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To violate encapsulation principles when necessary, Java provides powerful <code>reflection</code> mechanism.</p>
</div>
<div class="paragraph">
<p>The RxMicro framework is aware of this mechanism, so when generating a converter, the framework uses it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import static rxmicro.$$Reflections.getFieldValue; <i class="conum" data-value="1"></i><b>(1)</b>

public final class $$ResponseModelToJsonConverter extends ModelToJsonConverter&lt;Response&gt; {

    @Override
    public Map&lt;String, Object&gt; toJsonObject(final Response model) {
        final JsonObjectBuilder builder = new JsonObjectBuilder();
        putValuesToBuilder(model, builder);
        return builder.build();
    }

    public void putValuesToBuilder(final Response model,
                                   final JsonObjectBuilder builder) {
        builder.put("message", getFieldValue(model, "message")); <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Static import of method that allows reading field value with <code>reflection</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Reading the value of the <code>message</code> field from the response model.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using <code>reflection</code> when converting from Java model to JSON model while processing each request can <a href="#core-encapsulation-benchmark">reduce microservice performance</a>, where this problem can be avoided.
Therefore, when compiling this class, the <code>RxMicro Annotation Processor</code> generates a warning message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"><strong>[WARNING]</strong> Response.java:[27,26] <strong>PERFORMANCE WARNING</strong>: To read a value from io.rxmicro.example.hello.world.Response.message rxmicro will use the reflection.
It is recommended to add a getter or change the field modifier: from private to default, protected or public.</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the <a href="#rxmicro-annotation-processor-options-section"><code>RX_MICRO_STRICT_MODE</code></a> is set, the RxMicro Annotation Processor throws a compilation error instead of showing the <strong>PERFORMANCE WARNING</strong>.</p>
</div>
<div class="paragraph">
<p><strong>By default the reflection usage for model classes is not allowed for strict mode!</strong></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="a_separate_package_usage"><a class="anchor" href="#a_separate_package_usage"></a><a class="link" href="#a_separate_package_usage">7.2. A Separate Package Usage</a></h3>
<div class="paragraph">
<p>The best and <strong>recommended</strong> solution to this problem is to create a separate package (e.g. <code>model</code>) and declare all fields of the model classes without any access modifier (i.e. <code>default/package</code>).
Under this approach, fields can be accessed <strong>only</strong> from classes of the same package.
And the package contains <strong>only</strong> classes of models without any business logic:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/core/encapsulation/model-package.jpg" alt="model package">
</div>
<div class="title">Figure 4. Recommended structure to support encapsulation in Java models.</div>
</div>
<div class="paragraph">
<p><strong>Using model class fields without any access modifier (i.e. <code>default/package</code>) allows You to generate a converter that can read or write a value using direct access to the field by <code>.</code> operator.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="a_getters_usage"><a class="anchor" href="#a_getters_usage"></a><a class="link" href="#a_getters_usage">7.3. A <code>getters</code> Usage</a></h3>
<div class="paragraph">
<p>If the simplest logic is required when reading a value from a model field, You can use <code>getter</code>.</p>
</div>
<div class="paragraph">
<p>To do this, declare the field as <code>private</code> and add <code>getter</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class Response {

    private final String message;

    public Response(final String message) {
        this.message = requireNonNull(message);
    }

    public String getMessage() {
        if (message.isEmpty()) {
            return "&lt;Empty&gt;";
        } else {
            return message;
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, <code>getter</code> will be used in the generated converter to get the result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class $$ResponseModelToJsonConverter extends ModelToJsonConverter&lt;Response&gt; {

    @Override
    public Map&lt;String, Object&gt; toJsonObject(final Response model) {
        final JsonObjectBuilder builder = new JsonObjectBuilder();
        putValuesToBuilder(model, builder);
        return builder.build();
    }

    public void putValuesToBuilder(final Response model,
                                   final JsonObjectBuilder builder) {
        builder.put("message", model.getMessage()); <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>getter</code> invoking to get the value of the response model field.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="performance_comparison"><a class="anchor" href="#performance_comparison"></a><a class="link" href="#performance_comparison">7.4. Performance Comparison</a></h3>
<div class="paragraph">
<p>Performance test source code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Warmup(iterations = 5)
@Measurement(iterations = 5)
@Fork(value = 2, jvmArgsAppend = "-server")
@BenchmarkMode({
        Mode.Throughput,
        Mode.AverageTime,
        Mode.SingleShotTime
})
@State(Scope.Benchmark)
@OutputTimeUnit(MILLISECONDS)
@Threads(1)
public class ReadWriteFieldBenchmark {

    private final CustomClass customClass = new CustomClass("text");

    private final Map&lt;Class&lt;?&gt;, Map&lt;String, Field&gt;&gt; cache = new HashMap&lt;&gt;();

    public ReadWriteFieldBenchmark() {
        try {
            final Field field = CustomClass.class.getDeclaredField("value");
            if (!field.canAccess(customClass)) {
                field.setAccessible(true);
            }
            cache.put(CustomClass.class, new HashMap&lt;&gt;(Map.of("value", field)));
        } catch (final NoSuchFieldException e) {
            throw new RuntimeException(e);
        }
    }

    @Benchmark
    public void readDirectField() {
        var v = customClass.value;
    }

    @Benchmark
    public void writeDirectField() {
        customClass.value = "string";
    }

    @Benchmark
    public void readUsingGetter() {
        var v = customClass.getValue();
    }

    @Benchmark
    public void writeUsingSetter() {
        customClass.setValue("string");
    }

    @Benchmark // read field value using reflection with field search at the cache
    public void readUsingReflection() throws IllegalAccessException {
        var v = cache.get(CustomClass.class).get("value").get(customClass);
    }

    @Benchmark // write field value using reflection with field search at the cache
    public void writeUsingReflection() throws IllegalAccessException {
        cache.get(CustomClass.class).get("value").set(customClass, "string");
    }
}</code></pre>
</div>
</div>
<div id="core-encapsulation-benchmark" class="paragraph">
<p>Performance test results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-txt" data-lang="txt">Benchmark                                       Mode  Cnt       Score       Error   Units
ReadWriteFieldBenchmark.readDirectField         thrpt   10  753348.188 ± 90286.947  ops/ms
ReadWriteFieldBenchmark.readUsingGetter         thrpt   10  764112.155 ± 94525.371  ops/ms
ReadWriteFieldBenchmark.readUsingReflection     thrpt   10   26241.478 ±  3838.172  ops/ms
ReadWriteFieldBenchmark.writeDirectField        thrpt   10  344623.904 ± 18961.759  ops/ms
ReadWriteFieldBenchmark.writeUsingReflection    thrpt   10   19430.735 ±  2135.813  ops/ms
ReadWriteFieldBenchmark.writeUsingSetter        thrpt   10  323596.205 ± 28416.707  ops/ms
ReadWriteFieldBenchmark.readDirectField          avgt   10      ≈ 10⁻⁶               ms/op
ReadWriteFieldBenchmark.readUsingGetter          avgt   10      ≈ 10⁻⁶               ms/op
ReadWriteFieldBenchmark.readUsingReflection      avgt   10      ≈ 10⁻⁴               ms/op
ReadWriteFieldBenchmark.writeDirectField         avgt   10      ≈ 10⁻⁶               ms/op
ReadWriteFieldBenchmark.writeUsingReflection     avgt   10      ≈ 10⁻⁴               ms/op
ReadWriteFieldBenchmark.writeUsingSetter         avgt   10      ≈ 10⁻⁶               ms/op
ReadWriteFieldBenchmark.readDirectField            ss   10       0.001 ±     0.001   ms/op
ReadWriteFieldBenchmark.readUsingGetter            ss   10       0.001 ±     0.001   ms/op
ReadWriteFieldBenchmark.readUsingReflection        ss   10       0.008 ±     0.005   ms/op
ReadWriteFieldBenchmark.writeDirectField           ss   10       0.002 ±     0.001   ms/op
ReadWriteFieldBenchmark.writeUsingReflection       ss   10       0.011 ±     0.008   ms/op
ReadWriteFieldBenchmark.writeUsingSetter           ss   10       0.001 ±     0.001   ms/op</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Test results show that reading/writing by a direct reference or via <code>getter</code>/<code>setter</code> is performed <strong>28/17 times faster</strong>, than when using <code>reflection</code>!</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="approach_selection_recommendations"><a class="anchor" href="#approach_selection_recommendations"></a><a class="link" href="#approach_selection_recommendations">7.5. Approach Selection Recommendations</a></h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Thus, the RxMicro framework uses the following algorithm to read (write) from the fields of the Java model:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the field is declared with <code>public</code>, <code>protected</code> or <code>default/package</code> modifiers, the generated converter uses direct access to the field using the <code>.</code> operator;</p>
</li>
<li>
<p>If the field is declared with the <code>private</code> modifier and the developer created <code>getter</code>/<code>setter</code>, the generated converter uses the <code>getter</code>/<code>setter</code> invocation to get or write the field value;</p>
</li>
<li>
<p>If the field is declared with the <code>private</code> modifier without <code>getter</code>/<code>setter</code> declaration, the generated converter uses
<code>reflection</code> to access the model field.<br>
<em>(When generating this type of converter the <code>RxMicro Annotation Processor</code> informs the developer about <code>PERFORMANCE WARNING</code>.)</em></p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To benefit from the encapsulation advantages when designing microservices via the RxMicro framework, follow the recommendations:</p>
</div>
<div class="paragraph">
<p><strong>When creating request and response models, use a separate package and <code>default/package</code> access modifier!</strong></p>
</div>
<div class="paragraph">
<p><strong>If the simplest logic of reading (writing) the value of the model field is required, use <code>getter</code> (<code>setter</code>) and
<code>private</code> field access modifier.</strong></p>
</div>
<div class="paragraph">
<p><strong>Do not use the <code>private</code> modifier to access the model field without <code>getter</code> (<code>setter</code>)!</strong><br>
<strong>This approach offers no benefits!</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the <a href="#rxmicro-annotation-processor-options-section"><code>RX_MICRO_STRICT_MODE</code></a> is set, the RxMicro Annotation Processor throws a compilation error instead of showing the <strong>PERFORMANCE WARNING</strong>.</p>
</div>
<div class="paragraph">
<p><strong>By default the reflection usage for model classes is not allowed for strict mode!</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-section"><a class="anchor" href="#configuration-section"></a><a class="link" href="#configuration-section">8. Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The RxMicro framework provides the <code>rxmicro.config</code> module for flexible configuration of microservices to any environment.
This module provides the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for different types of configuration sources: files, classpath resources, environment variables, command line arguments, etc.;</p>
</li>
<li>
<p>Inheritance and redefinition of settings from different configuration sources;</p>
</li>
<li>
<p>Changing the order in which the configuration sources are read;</p>
</li>
<li>
<p>Configuration using annotations and Java classes.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="configuration-basic-structure-section"><a class="anchor" href="#configuration-basic-structure-section"></a><a class="link" href="#configuration-basic-structure-section">8.1. Basic Structure of the Config Module</a></h3>
<div class="paragraph">
<p>Each class that extends the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Config.java" target="_blank" rel="noopener"><code>Config</code></a>
abstract class is a configuration class.</p>
</div>
<div class="paragraph">
<p>Each configuration class defines its own namespace.
Each namespace clearly defines the corresponding configuration class.
The namespace is necessary to set the settings of the configuration class fields in text form.
(<em>Further details will be described below.</em>)</p>
</div>
<div class="paragraph">
<p>To work with configurations, the RxMicro framework provides the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Configs.java" target="_blank" rel="noopener"><code>Configs</code></a> configuration manager.</p>
</div>
<div class="paragraph">
<p>To read the current settings, You must use the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Configs.java#L101" target="_blank" rel="noopener"><code>Configs.getConfig(Class&lt;T&gt;)</code></a> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class ReadConfigMicroService {

    @GET("/")
    void readHttpServerPort() {
        final HttpServerConfig config = getConfig(HttpServerConfig.class); <i class="conum" data-value="1"></i><b>(1)</b>
        System.out.println("HTTP server port: " + config.getPort());
    }

    public static void main(final String[] args) {
        startRestServer(ReadConfigMicroService.class);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Getting the current HTTP server configuration using the <code>Configs.getConfig</code> static method.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To change the standard configuration settings, You must use the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Configs.java#L134" target="_blank" rel="noopener"><code>Configs.Builder</code></a> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class CustomizeConfigMicroService {

    @GET("/")
    void test() {
        // do something
    }

    public static void main(final String[] args) {
        new Configs.Builder()
                .withConfigs(new HttpServerConfig()
                        .setPort(9090)) <i class="conum" data-value="1"></i><b>(1)</b>
                .build(); <i class="conum" data-value="2"></i><b>(2)</b>
        startRestServer(CustomizeConfigMicroService.class); <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Setting the HTTP server custom port.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creating the configuration manager object.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>REST-based microservice should be started after configuration manager settings, otherwise changes will not take effect.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Each subsequent invocation of the <code>Configs.Builder.build()</code> method overrides all configuration manager settings.
<em>(In any microservice project there is only one configuration manager object!)</em></p>
</div>
<div class="paragraph">
<p>It means that if the developer creates several <code>Configs.Builder</code> instances, it will be the last invocation of the <code>build</code>
method that matters, the others will be ignored.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-common/config-basic" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-common/config-basic</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When compiling, the RxMicro framework searches for <code>RxMicro Annotations</code> in the source code and generates additional classes necessary for the integral work of the microservice.</p>
</div>
<div class="paragraph">
<p><strong>When changing the <code>RxMicro Annotations</code> in the source code, DON&#8217;T FORGET to recompile the ALL source code, not just the changed file, for the changes to take effect:</strong> <code>mvn clean compile</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Settings customization via the <code>Configs.Builder.build()</code> is one of the types of configuration.
This type of configuration is called <a href="#core-config-java-classes-section">configuration using Java classes</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="core-config-types"><a class="anchor" href="#core-config-types"></a><a class="link" href="#core-config-types">8.2. Configuration Types</a></h3>
<div class="paragraph">
<p>The RxMicro framework supports the following configuration types:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configuration using <code>classpath</code> resources.</p>
</li>
<li>
<p>Configuration using <code>properties</code> files.</p>
</li>
<li>
<p>Configuration using environment variables.</p>
</li>
<li>
<p>Configuration using Java system properties.</p>
</li>
<li>
<p>Configuration using Java classes.</p>
</li>
<li>
<p>Configuration using Java annotations.</p>
</li>
<li>
<p>Configuration using command line arguments.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="configuration_using_classpath_resources"><a class="anchor" href="#configuration_using_classpath_resources"></a><a class="link" href="#configuration_using_classpath_resources">8.2.1. Configuration Using <code>classpath</code> Resources.</a></h4>
<div class="paragraph">
<p>The RxMicro framework supports shared and separate classpath resources for the external configuration in relation to the microservice source code.</p>
</div>
<div class="paragraph">
<p>The only supported classpath resource format is the <code>properties</code> file format.</p>
</div>
<div class="sect4">
<h5 id="configuration_using_separate_classpath_resource"><a class="anchor" href="#configuration_using_separate_classpath_resource"></a><a class="link" href="#configuration_using_separate_classpath_resource">8.2.1.1. Configuration Using Separate <code>classpath</code> Resource.</a></h5>
<div class="paragraph">
<p>If the classpath of the current project contains the <code>http-server.properties</code> resource with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">port=9090 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Custom port for HTTP server.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>then the RxMicro framework when reading the <code>HttpServerConfig</code> class configuration will read this resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">2020-01-11 12:44:27.518 [INFO] io.rxmicro.rest.server.netty.internal.component.NettyServer :
Server started at 0.0.0.0:9090 using NETTY transport in 500 millis. <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The HTTP server has started at the <code>9090</code> port instead of the standard <code>8080</code> port.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>http-server</code> name is the default namespace for the <code>HttpServerConfig</code> class.
That&#8217;s why these settings are automatically applied when requesting the <code>HttpServerConfig</code> class configuration.</p>
</div>
<div class="paragraph">
<p>The default namespace for the configuration class is calculated using the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Config.java#L95" target="_blank" rel="noopener"><code>Config.getDefaultNameSpace(Class&lt;? extends Config&gt;)</code></a> method,</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="configuration_using_shared_classpath_resource"><a class="anchor" href="#configuration_using_shared_classpath_resource"></a><a class="link" href="#configuration_using_shared_classpath_resource">8.2.1.2. Configuration Using Shared <code>classpath</code> Resource.</a></h5>
<div class="paragraph">
<p>If the classpath of the current project contains the <code>rxmicro.properties</code> resource with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">http-server.port=9090 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Custom port for HTTP server.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>then the RxMicro framework when reading the <code>HttpServerConfig</code> class configuration will read this resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">2020-01-11 12:44:27.518 [INFO] io.rxmicro.rest.server.netty.internal.component.NettyServer :
Server started at 0.0.0.0:9090 using NETTY transport in 500 millis. <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The HTTP server has started at the <code>9090</code> port instead of the standard <code>8080</code> port.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>rxmicro</code> name for the <code>properties</code> file is constant.
That&#8217;s why when requesting any configuration, the RxMicro framework tries to read the content of this file, if it exists.</p>
</div>
<div class="paragraph">
<p>The <code>rxmicro</code> name is a named constant:
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Config.java#L74" target="_blank" rel="noopener"><code>Config.RX_MICRO_CONFIG_FILE_NAME</code></a>,</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since the <code>rxmicro.properties</code> resource is a shared resource for <strong>any</strong> configuration, You must specify a namespace when specifying the settings.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>That&#8217;s why when specifying the HTTP server port, You should specify the <code>http-server</code> prefix in the <code>rxmicro.properties</code> file.
<em>(When using the <code>http-server.properties</code> file, there was no such need!)</em></p>
</div>
<div class="paragraph">
<p>That means</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">http-server.port=9090</code></pre>
</div>
</div>
<div class="paragraph">
<p>instead of</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">port=9090</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="core-config-properties-files-section"><a class="anchor" href="#core-config-properties-files-section"></a><a class="link" href="#core-config-properties-files-section">8.2.2. Configuration Using <code>properties</code> Files.</a></h4>
<div class="paragraph">
<p>Similar to classpath resources, the RxMicro framework also supports shared and separate <code>properties</code> files for the external configuration in relation to the microservice source code.</p>
</div>
<div class="paragraph">
<p>Configuration files can be located:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in the current directory in relation to the microservice;</p>
</li>
<li>
<p>in the <code>$HOME</code> directory:</p>
<div class="ulist">
<ul>
<li>
<p>for Linux platform the <code>$HOME</code> directory is <code>/home/$USERNAME</code>;</p>
</li>
<li>
<p>for MacOS platform the <code>$HOME</code> directory is <code>/Users/$USERNAME</code>;</p>
</li>
<li>
<p>for Windows platform the <code>$HOME</code> directory is <code>C:\Documents and Settings\%USERNAME%</code> or <code>C:\Users\%USERNAME%</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>in the default rxmicro config directory: <code>$HOME/.rxmicro/</code> (predefined name and location).<br>
<em>(Using <code>$HOME/.rxmicro/</code> directory instead of <code>$HOME</code> one allows configuring this directory as <a href="https://www.docker.com/" target="_blank" rel="noopener">docker</a> or <a href="https://kubernetes.io/" target="_blank" rel="noopener">kubernetes</a> volume.)</em></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To find out the location of the <code>$HOME</code> directory on Your computer using Java, start the following program:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class GetHomeDirectory {

    public static void main(final String[] args) {
        System.out.println(System.getProperty("user.home"));
    }
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>By default, the function of searching and reading configuration files is disabled in the RxMicro framework!</strong></p>
</div>
<div class="paragraph">
<p>To activate this function, You must use the <code>Configs.Builder</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">new Configs.Builder()
        .withAllConfigSources() <i class="conum" data-value="1"></i><b>(1)</b>
        .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Activation of all available configuration sources for the current microservice.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Besides activating all available sources, it is possible to activate only configuration files in a given location.</p>
</div>
<div class="paragraph">
<p>For details on how to do this, go to the <a href="#core-config-order-settings">Section 8.3.2, &#8220;Custom Reading Order of Config Sources.&#8221;</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="configuration_using_separate_properties_file"><a class="anchor" href="#configuration_using_separate_properties_file"></a><a class="link" href="#configuration_using_separate_properties_file">8.2.2.1. Configuration Using Separate <code>properties</code> File.</a></h5>
<div class="paragraph">
<p>If the current directory (or <code>$HOME</code>, or <code>$HOME/.rxmicro/</code>) directory contains the <code>http-server.properties</code> file with the following content</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">port=9090 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Custom port for HTTP server.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>then the RxMicro framework when reading the <code>HttpServerConfig</code> class configuration will read this file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">2020-01-11 12:44:27.518 [INFO] io.rxmicro.rest.server.netty.internal.component.NettyServer :
Server started at 0.0.0.0:9090 using NETTY transport in 500 millis. <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The HTTP server has started at the <code>9090</code> port instead of the standard <code>8080</code> port.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>http-server</code> name is the default namespace for the <code>HttpServerConfig</code> class.
That&#8217;s why these settings are automatically applied when requesting the <code>HttpServerConfig</code> class configuration.</p>
</div>
<div class="paragraph">
<p>The default namespace for the configuration class is calculated using the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Config.java#L95" target="_blank" rel="noopener"><code>Config.getDefaultNameSpace(Class&lt;? extends Config&gt;)</code></a> method,</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="configuration_using_shared_properties_file"><a class="anchor" href="#configuration_using_shared_properties_file"></a><a class="link" href="#configuration_using_shared_properties_file">8.2.2.2. Configuration Using Shared <code>properties</code> File.</a></h5>
<div class="paragraph">
<p>If the current directory (or <code>$HOME</code>, or <code>$HOME/.rxmicro/</code>) directory contains the <code>rxmicro.properties</code> file with the following content</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">http-server.port=9090 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Custom port for HTTP server.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>then the RxMicro framework when reading the <code>HttpServerConfig</code> class configuration will read this resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">2020-01-11 12:44:27.518 [INFO] io.rxmicro.rest.server.netty.internal.component.NettyServer :
Server started at 0.0.0.0:9090 using NETTY transport in 500 millis. <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The HTTP server has started at the <code>9090</code> port instead of the standard <code>8080</code> port.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>rxmicro</code> name for the <code>properties</code> file is constant.
That&#8217;s why when requesting any configuration, the RxMicro framework tries to read the content of this file, if it exists.</p>
</div>
<div class="paragraph">
<p>The <code>rxmicro</code> name is a named constant:
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Config.java#L74" target="_blank" rel="noopener"><code>Config.RX_MICRO_CONFIG_FILE_NAME</code></a>,</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since the <code>rxmicro.properties</code> file is a shared file for <strong>any</strong> configuration, You must specify a namespace when specifying the settings.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>That&#8217;s why when specifying the HTTP server port, You should specify the <code>http-server</code> prefix in the <code>rxmicro.properties</code> file.
<em>(When using the <code>http-server.properties</code> file, there was no such need!)</em></p>
</div>
<div class="paragraph">
<p>That means</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">http-server.port=9090</code></pre>
</div>
</div>
<div class="paragraph">
<p>instead of</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">port=9090</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuration_using_environment_variables"><a class="anchor" href="#configuration_using_environment_variables"></a><a class="link" href="#configuration_using_environment_variables">8.2.3. Configuration Using Environment Variables.</a></h4>
<div class="paragraph">
<p>When using environment variables, the format of configurations matches the following format:</p>
</div>
<div class="paragraph">
<p><code>export ${name-space}.${property-name} = ${value}</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"><strong>export</strong> http-server.port=9090 <i class="conum" data-value="1"></i><b>(1)</b>

<strong>java</strong> -p ./classes:lib -m <strong>examples.quick.start/io.rxmicro.examples.quick.start.HelloWorldMicroService</strong>
2020-01-02 18:49:58.372 [INFO] io.rxmicro.rest.server.netty.internal.component.NettyServer :
Server started at 0.0.0.0:9090 using NETTY transport in 500 millis. <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Setting the <code>http-server.port</code> environment variable = 9090 (custom port for HTTP server).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The HTTP server has started at the <code>9090</code> port instead of the standard <code>8080</code> port.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Thus, the format of configurations using environment variables corresponds to the format of <code>rxmicro.properties</code> file or classpath resource.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Allowed characters in environment variable names!</strong></p>
</div>
<div class="paragraph">
<p>From <a href="https://pubs.opengroup.org/onlinepubs/000095399/basedefs/xbd_chap08.html" target="_blank" rel="noopener">The Open Group</a>:</p>
</div>
<div class="paragraph">
<p><em>These strings have the form name=value; names shall not contain the character '='.
For values to be portable across systems conforming to IEEE Std 1003.1-2001, the value shall be composed of characters from the portable character set (except NUL and as indicated below).</em></p>
</div>
<div class="paragraph">
<p>So names may contain any character except <code>=</code> and <code>NUL</code>, but:</p>
</div>
<div class="paragraph">
<p><em>Environment variable names used by the utilities in the Shell and Utilities volume of IEEE Std 1003.1-2001 consist solely of <strong>uppercase letters, digits, and the '</em>' (underscore)</strong> from the characters defined in Portable Character Set and do not begin with a digit.
Other characters may be permitted by an implementation; applications shall tolerate the presence of such names._</p>
</div>
<div class="paragraph">
<p>So for such restricted environment the RxMicro framework supports the following format for environment variable mapping as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">export <strong>HTTP_SERVER_PORT</strong>=9090 <i class="conum" data-value="1"></i><b>(1)</b>

java -p ./classes:lib -m examples.quick.start/io.rxmicro.examples.quick.start.HelloWorldMicroService
2020-01-02 18:49:58.372 [INFO] io.rxmicro.rest.server.netty.internal.component.NettyServer :
Server started at <strong>0.0.0.0:9090</strong> using NETTY transport in 500 millis. <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Setting the <code>HTTP_SERVER_PORT</code> environment variable = 9090 (custom port for HTTP server).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The HTTP server has started at the <code>9090</code> port instead of the standard <code>8080</code> port.</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Configuring with environment variables is very convenient when using <a href="https://www.docker.com/" target="_blank" rel="noopener">docker</a> containers!</strong></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To protect Your secret data, use configuration via properties files instead of environment variables.
The config directory with secret config files (for example <code>$HOME/.rxmicro/</code>) must be mount as external volume using <a href="https://en.wikipedia.org/wiki/Tmpfs" target="_blank" rel="noopener"><code>tmpfs</code></a> file system.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If it is necessary to separate environment variables used for the configuration of the RxMicro environment from other environment variables,
You must define the standard environment variable with name <code>RX_MICRO_CONFIG_ENVIRONMENT_VARIABLE_PREFIX</code>!</p>
</div>
<div class="paragraph">
<p>For example if You runtime contains the following environment variable <code>RX_MICRO_CONFIG_ENVIRONMENT_VARIABLE_PREFIX=MY_RUNTIME_</code>
than it is necessary to use</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">export <strong>MY_RUNTIME_HTTP_SERVER_PORT</strong>=9090</code></pre>
</div>
</div>
<div class="paragraph">
<p>instead of</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">export <strong>HTTP_SERVER_PORT</strong>=9090</code></pre>
</div>
</div>
<div class="paragraph">
<p>setting for configuring a port for the HTTP server!</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration_using_java_system_properties"><a class="anchor" href="#configuration_using_java_system_properties"></a><a class="link" href="#configuration_using_java_system_properties">8.2.4. Configuration Using Java System Properties</a></h4>
<div class="paragraph">
<p>When using the <code>Java System Properties</code>, the format of configurations matches the following format:</p>
</div>
<div class="paragraph">
<p><code>${name-space}.${property-name} = ${value}</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text"><strong>java</strong> -p ./classes:lib \
    -Dhttp-server.port=9090 \ <i class="conum" data-value="1"></i><b>(1)</b>
    -m <strong>examples.quick.start/io.rxmicro.examples.quick.start.HelloWorldMicroService</strong>

2020-01-02 18:49:58.372 [INFO] io.rxmicro.rest.server.netty.internal.component.NettyServer :
Server started at 0.0.0.0:9090 using NETTY transport in 500 millis. <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Setting the <code>http-server.port</code> Java system variable = 9090 (custom port for HTTP server).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The HTTP server has started at the <code>9090</code> port instead of the standard <code>8080</code> port.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Thus, the format of configurations using Java system variables corresponds to the format of configuration using environment variables, and also to the format of <code>rxmicro.properties</code> file or classpath resource.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="core-config-java-classes-section"><a class="anchor" href="#core-config-java-classes-section"></a><a class="link" href="#core-config-java-classes-section">8.2.5. Configuration Using Java Classes.</a></h4>
<div class="paragraph">
<p>Configuring with Java classes is the easiest and most explicit configuration method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public static void main(final String[] args) {
    new Configs.Builder()
            .withConfigs(new HttpServerConfig()
                    .setPort(9090)) <i class="conum" data-value="1"></i><b>(1)</b>
            .build();
    startRestServer(MicroService.class);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Changing the HTTP server port.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">2020-01-02 18:49:58.372 [INFO] io.rxmicro.rest.server.netty.internal.component.NettyServer :
Server started at 0.0.0.0:9090 using NETTY transport in 500 millis. <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The HTTP server has started at the <code>9090</code> port instead of the standard <code>8080</code> port.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>The main difference between this type of configuration and the others is that when using Java classes, other configuration sources are always ignored!</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Therefore this type is recommended to be used ONLY for test purposes!</strong></p>
</div>
<div class="paragraph">
<p>(<em>It does not have enough flexibility for the production environment!</em>)</p>
</div>
<div class="paragraph">
<p><strong>For the production environment, use the configuration with annotations instead of the configuration with Java classes!</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="core-config-annotations-section"><a class="anchor" href="#core-config-annotations-section"></a><a class="link" href="#core-config-annotations-section">8.2.6. Configuration Using Java Annotations.</a></h4>
<div class="paragraph">
<p>To override the default value, the RxMicro framework provides the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/DefaultConfigValue.java" target="_blank" rel="noopener"><code>@DefaultConfigValue</code></a> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@DefaultConfigValue(
        configClass = HttpServerConfig.class,   <i class="conum" data-value="1"></i><b>(1)</b>
        name = "port",                          <i class="conum" data-value="2"></i><b>(2)</b>
        value = "9090"
)
@DefaultConfigValue(
        name = "http-server.host",  <i class="conum" data-value="3"></i><b>(3)</b>
        value = "localhost"
)
module examples.config.annotations { <i class="conum" data-value="4"></i><b>(4)</b>
    requires rxmicro.rest.server.netty;
    requires rxmicro.rest.server.exchange.json;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When overriding the configuration value, You must specify the configuration class.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If the configuration class is specified, the namespace may not be specified.<br>
<em>(It means the field of the specified configuration class.)</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If no configuration class is specified, the name <strong>must</strong> contain a namespace.<br>
<em>(The namespace allows You to clearly define to which configuration class the specified setting belongs.)</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>When configuring a microservice project, the annotation must be specified on the <code>module-info.java</code> descriptor.<br>
<em>(A microservice project may contain several classes of REST controllers, so the common settings are configured using the <code>module-info.java</code> descriptor rather than the REST controller class.)</em></td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Please, pay attention when overriding the default value with the annotations!</strong></p>
</div>
<div class="paragraph">
<p>If You make a mistake when specifying a setting name (this refers to the namespace and field name), no error will occur upon starting!
The overridden value will be simply <strong>ignored</strong>!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By overriding the default values using the <code>module-info.java</code> descriptor, You can start the microservice.
While reading the configuration of the <code>HttpServerConfig</code> class, the RxMicro framework reads the default values set with annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">2020-01-13 13:09:44.236 [INFO] io.rxmicro.rest.server.netty.internal.component.NettyServer :
Server started at localhost:9090 using NETTY transport in 500 millis. <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>HTTP server started on <code>localhost:9090</code></td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-common/config-annotations" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-common/config-annotations</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The main difference between configuring with annotations and configuring with Java classes is support of the <strong>settings inheritance and overriding</strong>.</p>
</div>
<div class="paragraph">
<p>In other words, when using configuration via annotations, the RxMicro framework can also read other configuration sources.</p>
</div>
<div class="paragraph">
<p>When using configuration via Java classes, other configuration sources <strong>are always ignored</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For the test environment only, the RxMicro framework provides special <a href="testing.html#testing-annotations-WithConfig-inline"><code>@WithConfig</code></a> annotation.
Using this annotation it is convenient to configure the configuration manager for the test environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@WithConfig
private static final HttpServerConfig SERVER_CONFIG =
        new HttpServerConfig()
                .setPort(56789);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The source code of the project using the <a href="testing.html#testing-annotations-WithConfig-inline"><code>@WithConfig</code></a> annotation is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-testing-junit/testing-microservice-with-config" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/testing-microservice-with-config</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/DefaultConfigValue.java" target="_blank" rel="noopener"><code>@DefaultConfigValue</code></a>
annotation can be applied to override primitive values only:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>strings</code>,</p>
</li>
<li>
<p><code>booleans</code>,</p>
</li>
<li>
<p><code>numbers</code>,</p>
</li>
<li>
<p><code>dates</code>,</p>
</li>
<li>
<p><code>times</code>,</p>
</li>
<li>
<p><code>enums</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If You need to override a complex value, it is necessary to use
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/DefaultConfigValueSupplier.java" target="_blank" rel="noopener"><code>@DefaultConfigValueSupplier</code></a>
annotation instead.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The source code of the project using the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/DefaultConfigValueSupplier.java" target="_blank" rel="noopener"><code>@DefaultConfigValueSupplier</code></a>
annotation is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-common/config-annotations-supplier" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/config-annotations-supplier</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When compiling, the RxMicro framework searches for <code>RxMicro Annotations</code> in the source code and generates additional classes necessary for the integral work of the microservice.</p>
</div>
<div class="paragraph">
<p><strong>When changing the <code>RxMicro Annotations</code> in the source code, DON&#8217;T FORGET to recompile the ALL source code, not just the changed file, for the changes to take effect:</strong> <code>mvn clean compile</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="core-config-command-line-args-section"><a class="anchor" href="#core-config-command-line-args-section"></a><a class="link" href="#core-config-command-line-args-section">8.2.7. Configuration Using Command Line Arguments.</a></h4>
<div class="paragraph">
<p>To override configs You can use command line arguments.</p>
</div>
<div class="paragraph">
<p>This type of configuration has <strong>the highest priority and overrides all other types</strong>.
<em>(Except of configuration using Java classes.)</em></p>
</div>
<div class="paragraph">
<p><strong>Configuration using command line arguments is disabled by default.</strong></p>
</div>
<div class="paragraph">
<p>To enable it is necessary to configure the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Configs.java" target="_blank" rel="noopener"><code>Configs</code></a> configuration manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public static void main(final String[] args) {
    new Configs.Builder()
            .withCommandLineArguments(args) <i class="conum" data-value="1"></i><b>(1)</b>
            .build();
    startRestServer(MicroService.class);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>withCommandLineArguments(args)</code> method to enable the configuration using command line arguments.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, If You want to start HTTP server at <code>9191</code> port, You can pass the following command line argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">java -p ./classes:lib -m examples.quick.start/io.rxmicro.examples.quick.start.HelloWorldMicroService <strong>http-server.port=9191</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">2020-01-02 18:49:58.372 [INFO] io.rxmicro.rest.server.netty.internal.component.NettyServer :
Server started at 0.0.0.0: <strong>9191</strong> using NETTY transport in 500 millis.</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="config_sources_setting"><a class="anchor" href="#config_sources_setting"></a><a class="link" href="#config_sources_setting">8.3. Config Sources Setting</a></h3>
<div class="paragraph">
<p>The RxMicro framework allows You to customize the order in which the configuration sources are read.</p>
</div>
<div class="paragraph">
<p>With this feature, the RxMicro framework automatically supports inheritance and redefinition of launch configurations.</p>
</div>
<div class="sect3">
<h4 id="core-config-order-default-section"><a class="anchor" href="#core-config-order-default-section"></a><a class="link" href="#core-config-order-default-section">8.3.1. Default Reading Order of Config Sources.</a></h4>
<div class="paragraph">
<p>By default, the RxMicro framework reads configuration sources
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Configs.java#L55" target="_blank" rel="noopener">in the following order</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configuration using <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/DefaultConfigValue.java" target="_blank" rel="noopener"><code>@DefaultConfigValue</code></a> annotations;</p>
</li>
<li>
<p>Configuration using the <code>rxmicro.properties</code> classpath resource;</p>
</li>
<li>
<p>Configuration using the separate (<code>${name-space}.properties</code>) classpath resource;</p>
</li>
<li>
<p>Configuration using environment variables;</p>
</li>
<li>
<p>Configuration using Java system variables;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thus, if there are two classpath resources for a microservice:</p>
</div>
<div class="paragraph">
<p>The <code>rxmicro.properties</code> resource with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">http-server.port=9090
http-server.host=localhost</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the <code>http-server.properties</code> resource with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">port=9876</code></pre>
</div>
</div>
<div class="paragraph">
<p>then the result will be as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">2020-01-11 16:52:26.797 [INFO] io.rxmicro.rest.server.netty.internal.component.NettyServer :
Server started at localhost:9876 using NETTY transport in 500 millis. <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>HTTP server has started at <code>localhost:9876</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configuration reading algorithm for the above example is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>By default, the HTTP server should start at <code>0.0.0.0:8080</code>.</p>
</li>
<li>
<p>But in the <code>rxmicro.properties</code> classpath resource there is a different IP address and port: <code>localhost:9090</code>.</p>
</li>
<li>
<p>If the <code>http-server.properties</code> classpath resource had not existed, the HTTP server would have run at <code>localhost:9090</code>.</p>
</li>
<li>
<p>But in the <code>http-server.properties</code> classpath resource it is specified the <code>9876</code> port.</p>
</li>
<li>
<p>Therefore, when starting, the IP address is inherited from the <code>rxmicro.properties</code> resource and the overridden port value is read from the <code>http-server.properties</code> resource.<br>
<em>(This behavior corresponds to the order of reading the default configurations.)</em></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="core-config-order-settings"><a class="anchor" href="#core-config-order-settings"></a><a class="link" href="#core-config-order-settings">8.3.2. Custom Reading Order of Config Sources.</a></h4>
<div class="paragraph">
<p>To change the order of the configuration reading it is necessary to use the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Configs.java#L200" target="_blank" rel="noopener"><code>Configs.Builder.withOrderedConfigSources(ConfigSource&#8230;&#8203;)</code></a> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public static void main(final String[] args) {
    new Configs.Builder()
            .withOrderedConfigSources(
                    SEPARATE_CLASS_PATH_RESOURCE, <i class="conum" data-value="1"></i><b>(1)</b>
                    RXMICRO_CLASS_PATH_RESOURCE   <i class="conum" data-value="2"></i><b>(2)</b>
            )
            .build();
    startRestServer(MicroService.class);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>First, it is necessary to read the configuration from the <code>${name-space}.properties</code> classpath resource (In our case, it&#8217;s a <code>http-server.properties</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>and then from the <code>rxmicro.properties</code> classpath resource.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Thus, the order of the configuration reading from classpath resources has been changed in comparison with the
<a href="#core-config-order-default-section">default order</a>.</p>
</div>
<div class="paragraph">
<p>When starting the microservice, the settings from the <code>http-server.properties</code> classpath resource will be overwritten by the settings from the <code>rxmicro.properties</code> classpath resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">2020-01-11 16:52:26.797 [INFO] io.rxmicro.rest.server.netty.internal.component.NettyServer :
Server started at localhost:9090 using NETTY transport in 500 millis. <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>HTTP server has started at <code>localhost:9090</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Configs.java#L200" target="_blank" rel="noopener"><code>Configs.Builder.withOrderedConfigSources(ConfigSource&#8230;&#8203;)</code></a>
method allows not only to change the order of reading the configuration sources, but also to activate/deactivate the sources.</p>
</div>
<div class="paragraph">
<p><strong>In the above example, the RxMicro framework will ignore any configuration sources except classpath resources!</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Configs.java#L200" target="_blank" rel="noopener"><code>Configs.Builder.withOrderedConfigSources(ConfigSource&#8230;&#8203;)</code></a>
method is universal.</p>
</div>
<div class="paragraph">
<p>The RxMicro framework also provides other additional methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Configs.java#L227" target="_blank" rel="noopener"><code>Configs.Builder.withAllConfigSources()</code></a> - activation of all configuration types in the order given by the list:
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/ConfigSource.java" target="_blank" rel="noopener"><code>ConfigSource</code></a></p>
</li>
<li>
<p><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Configs.java#L245" target="_blank" rel="noopener"><code>Configs.Builder.withContainerConfigSources()</code></a> - this combination is recommended for microservices operating in <a href="https://www.docker.com/" target="_blank" rel="noopener">docker</a> or <a href="https://kubernetes.io/" target="_blank" rel="noopener">kubernetes</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Configs.java#L227" target="_blank" rel="noopener"><code>Configs.Builder.withAllConfigSources()</code></a>
method was used to activate the reading of configurations from properties files in the <a href="#core-config-properties-files-section">Section 8.2.2, &#8220;Configuration Using <code>properties</code> Files.&#8221;</a> subsection.</p>
</div>
<div class="paragraph">
<p>If You plan to use only <code>properties</code> files, it is recommended to specify only these types, excluding all other types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public static void main(final String[] args) {
    new Configs.Builder()
            .withOrderedConfigSources(
                    RXMICRO_FILE_AT_THE_HOME_DIR,    <i class="conum" data-value="1"></i><b>(1)</b>
                    RXMICRO_FILE_AT_THE_CURRENT_DIR, <i class="conum" data-value="2"></i><b>(2)</b>
                    SEPARATE_FILE_AT_THE_HOME_DIR,   <i class="conum" data-value="3"></i><b>(3)</b>
                    SEPARATE_FILE_AT_THE_CURRENT_DIR <i class="conum" data-value="4"></i><b>(4)</b>
            )
            .build();
    startRestServer(MicroService.class);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Activation of configuration reading from the <code>$HOME/rxmicro.properties</code> file.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Activation of configuration reading from the <code>rxmicro.properties</code> file in the current directory.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Activation of configuration reading from the <code>$HOME/${name-space}.properties</code> files (for example, <code>http-server.properties</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>ctivation of configuration reading from the <code>${name-space}.properties</code> files (for example, <code>http-server.properties</code>) in the current directory.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>The order of reading is set by the argument order of the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Configs.java#L200" target="_blank" rel="noopener"><code>Configs.Builder.withOrderedConfigSources(ConfigSource&#8230;&#8203;)</code></a></strong> method</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>If You know exactly which configuration sources should be used by the microservice, ALWAYS specify them explicitly!</strong></p>
</div>
<div class="paragraph">
<p><strong>With this approach, at the microservice starting, the RxMicro framework won&#8217;t try to search for non-existent sources, spending precious microseconds!</strong></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="logging_the_config_reading_process"><a class="anchor" href="#logging_the_config_reading_process"></a><a class="link" href="#logging_the_config_reading_process">8.3.3. Logging the Config Reading Process</a></h4>
<div class="paragraph">
<p>To debug the configuration reading process You can activate the <a href="#core-logger-config-file-inline">logger</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">.level=INFO
io.rxmicro.config.level=DEBUG <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>For all classes and subpackages of the <code>io.rxmicro.config</code> package activate the <code>DEBUG</code>(<code>FINE</code>) logging level.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After activating the logger, the start of the microservice with default settings will be as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">[DEBUG] Discovering properties for 'rest-server' namespace from sources: [<strong>DEFAULT_CONFIG_VALUES</strong>, <strong>RXMICRO_CLASS_PATH_RESOURCE</strong>, <strong>SEPARATE_CLASS_PATH_RESOURCE</strong>, <strong>ENVIRONMENT_VARIABLES</strong>, <strong>JAVA_SYSTEM_PROPERTIES</strong>]

[DEBUG] Classpath resource not found: <strong>rest-server.properties</strong>

[DEBUG] All properties discovered for 'rest-server' namespace <i class="conum" data-value="1"></i><b>(1)</b>

[DEBUG] Discovering properties for 'http-server' namespace from sources: [<strong>DEFAULT_CONFIG_VALUES</strong>, <strong>RXMICRO_CLASS_PATH_RESOURCE</strong>, <strong>SEPARATE_CLASS_PATH_RESOURCE</strong>, <strong>ENVIRONMENT_VARIABLES</strong>, <strong>JAVA_SYSTEM_PROPERTIES</strong>]

[DEBUG] Discovered properties from <strong>'rxmicro.properties'</strong> classpath resource: [http-server.port=9090, http-server.host=localhost] <i class="conum" data-value="2"></i><b>(2)</b>

[DEBUG] Discovered properties from <strong>'http-server.properties'</strong> classpath resource: [port=9876] <i class="conum" data-value="3"></i><b>(3)</b>

[DEBUG] All properties discovered for 'http-server' namespace

[DEBUG] Discovering properties for 'netty-rest-server' namespace from sources: [<strong>DEFAULT_CONFIG_VALUES</strong>, <strong>RXMICRO_CLASS_PATH_RESOURCE</strong>, <strong>SEPARATE_CLASS_PATH_RESOURCE</strong>, <strong>ENVIRONMENT_VARIABLES</strong>, <strong>JAVA_SYSTEM_PROPERTIES</strong>]

[DEBUG] Classpath resource not found: <strong>netty-rest-server.properties</strong>

[DEBUG] All properties discovered for 'netty-rest-server' namespace <i class="conum" data-value="4"></i><b>(4)</b>

[INFO] Server started at <strong>0.0.0.0:9876</strong> using NETTY transport in 500 millis. <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>There is no configuration customization for the <code>rest-server</code> namespace, so the default configuration will be used.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configuration reading for the <code>http-server</code> namespace from the <code>rxmicro.properties</code> classpath resource (Read values: <code>http-server.port=9090</code>, <code>http-server.host=localhost</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configuration reading for the <code>http-server</code> namespace from the <code>http-server.properties</code> classpath resource (Read value: <code>port=9876</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>There is no configuration customization for the <code>netty-rest-server</code> namespace, so the default configuration will be used.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>HTTP server has started at <code>localhost:9876</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Additional debugging information will show the order of reading the configuration sources and overriding the configuration parameter values!</strong></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="dynamic_configuration"><a class="anchor" href="#dynamic_configuration"></a><a class="link" href="#dynamic_configuration">8.4. Dynamic Configuration</a></h3>
<div class="paragraph">
<p>If Your runtime environment can contain dynamic properties You can use <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/AsMapConfig.java" target="_blank" rel="noopener"><code>AsMapConfig</code></a> configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class DynamicAsMapConfig extends AsMapConfig {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>rxmicro.properties</code> classpath resource with the following content exists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">dynamic.bigDecimal=3.1423456676
dynamic.bigInteger=9999999999999999999999999999999999999999999999999
dynamic.boolean=true
dynamic.integer=34
dynamic.string=staging</code></pre>
</div>
</div>
<div class="paragraph">
<p>then the following code will return configured dynamic parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public static void main(final String[] args) {
    final DynamicAsMapConfig config = getConfig(DynamicAsMapConfig.class);

    System.out.println(config.getBigDecimal("bigDecimal"));
    System.out.println(config.getBigInteger("bigInteger"));
    System.out.println(config.getBoolean("boolean"));
    System.out.println(config.getInteger("integer"));
    System.out.println(config.getString("string"));
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="core-config-user-defined-config"><a class="anchor" href="#core-config-user-defined-config"></a><a class="link" href="#core-config-user-defined-config">8.5. User Defined Configurations</a></h3>
<div class="paragraph">
<p>The developer can use the configuration module for custom configurations.</p>
</div>
<div class="paragraph">
<p>To do this, it is necessary to create a separate class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class BusinessServiceConfig extends Config {

    private boolean production = true;

    public boolean isProduction() {
        return production;
    }

    public BusinessServiceConfig setProduction(final boolean production) {
        this.production = production;
        return this;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The custom configuration class must meet the following requirements:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The class must be public.</p>
</li>
<li>
<p>The class must contain a public constructor without parameters.</p>
</li>
<li>
<p>The class must extend the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-config/src/main/java/io/rxmicro/config/Config.java" target="_blank" rel="noopener"><code>Config</code></a> abstract class.</p>
</li>
<li>
<p>To set property values, the class must contain <a href="https://www.w3schools.com/java/java_encapsulation.asp" target="_blank" rel="noopener"><code>setters</code></a>.<br>
<em>(Only those fields that contain <code>setters</code> can be initialized!)</em></p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since this class will be created and initialized by the reflection util classes from <code>rxmicro.reflection</code> module automatically, it is necessary to export the package of the custom config class to this module in the <code>module-info.java</code> descriptor.<br>
<em>(These are the <a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html" target="_blank" rel="noopener"><code>JPMS</code></a> requirements.)</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">module examples.config.custom {
    requires rxmicro.rest.server.netty;
    requires rxmicro.rest.server.exchange.json;

    exports io.rxmicro.examples.config.custom to
            rxmicro.reflection;  <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allow the access of reflection util classes from <code>rxmicro.reflection</code> module to config classes from the <code>io.rxmicro.example.config.custom</code> package.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After these changes, a class of custom configurations is available for use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final class MicroService {

    @GET("/")
    void test() {
        final BusinessServiceConfig config = getConfig(BusinessServiceConfig.class);
        System.out.println("Production: " + config.isProduction());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>production</code> flag can now be set using any type of configuration, for example using the classpath of the <code>business-service.properties</code> resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">production=false</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-common/config-custom" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-common/config-custom</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When compiling, the RxMicro framework searches for <code>RxMicro Annotations</code> in the source code and generates additional classes necessary for the integral work of the microservice.</p>
</div>
<div class="paragraph">
<p><strong>When changing the <code>RxMicro Annotations</code> in the source code, DON&#8217;T FORGET to recompile the ALL source code, not just the changed file, for the changes to take effect:</strong> <code>mvn clean compile</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="supported_parameter_types"><a class="anchor" href="#supported_parameter_types"></a><a class="link" href="#supported_parameter_types">8.6. Supported Parameter Types</a></h3>
<div class="paragraph">
<p>The RxMicro framework supports the primitive, custom and container types, which can be config parameters for any configuration.</p>
</div>
<div class="sect3">
<h4 id="supported_primitive_parameter_types"><a class="anchor" href="#supported_primitive_parameter_types"></a><a class="link" href="#supported_primitive_parameter_types">8.6.1. Supported Primitive Parameter Types</a></h4>
<div class="paragraph">
<p>The RxMicro framework supports the following primitive Java types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>? extends Enum&lt;?&gt;</code>;</p>
</li>
<li>
<p><code>boolean</code>;</p>
</li>
<li>
<p><code>java.lang.Boolean</code>;</p>
</li>
<li>
<p><code>byte</code>;</p>
</li>
<li>
<p><code>java.lang.Byte</code>;</p>
</li>
<li>
<p><code>short</code>;</p>
</li>
<li>
<p><code>java.lang.Short</code>;</p>
</li>
<li>
<p><code>int</code>;</p>
</li>
<li>
<p><code>java.lang.Integer</code>;</p>
</li>
<li>
<p><code>long</code>;</p>
</li>
<li>
<p><code>java.lang.Long</code>;</p>
</li>
<li>
<p><code>java.math.BigInteger</code>;</p>
</li>
<li>
<p><code>float</code>;</p>
</li>
<li>
<p><code>java.lang.Float</code>;</p>
</li>
<li>
<p><code>double</code>;</p>
</li>
<li>
<p><code>java.lang.Double</code>;</p>
</li>
<li>
<p><code>java.math.BigDecimal</code>;</p>
</li>
<li>
<p><code>char</code>;</p>
</li>
<li>
<p><code>java.lang.Character</code>;</p>
</li>
<li>
<p><code>java.lang.CharSequence</code>;</p>
</li>
<li>
<p><code>java.lang.String</code>;</p>
</li>
<li>
<p><code>java.time.Instant</code>;</p>
</li>
<li>
<p><code>java.time.LocalDate</code>;</p>
</li>
<li>
<p><code>java.time.LocalDateTime</code>;</p>
</li>
<li>
<p><code>java.time.LocalTime</code>;</p>
</li>
<li>
<p><code>java.time.MonthDay</code>;</p>
</li>
<li>
<p><code>java.time.OffsetDateTime</code>;</p>
</li>
<li>
<p><code>java.time.OffsetTime</code>;</p>
</li>
<li>
<p><code>java.time.Year</code>;</p>
</li>
<li>
<p><code>java.time.YearMonth</code>;</p>
</li>
<li>
<p><code>java.time.ZonedDateTime</code>;</p>
</li>
<li>
<p><code>java.time.Duration</code>;</p>
</li>
<li>
<p><code>java.time.ZoneOffset</code>;</p>
</li>
<li>
<p><code>java.time.ZoneId</code>;</p>
</li>
<li>
<p><code>java.time.Period</code>;</p>
</li>
<li>
<p><code>java.nio.file.Path</code>;</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For temporal classes the RxMicro framework uses <code>parse</code> or <code>of</code> factory method to converts string value to the appropriate Java representation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="core_config_supported_custom_parameter_types"><a class="anchor" href="#core_config_supported_custom_parameter_types"></a><a class="link" href="#core_config_supported_custom_parameter_types">8.6.2. Supported Custom Parameter Types</a></h4>
<div class="paragraph">
<p>The RxMicro framework supports a custom type as valid config parameter type.</p>
</div>
<div class="paragraph">
<p>For example if Your project contain the following custom type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface CustomType {

    String getValue();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Your custom config class can use this type as valid config parameter type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class ExampleConfig extends Config {

    private CustomType type = () -&gt; "DEFAULT_CONSTANT";

    public CustomType getType() {
        return type;
    }

    public void setType(final CustomType type) {
        this.type = type;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instances of the custom type can be created as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enum constant:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public enum CustomEnum implements CustomType {

    ENUM_CONSTANT;

    @Override
    public String getValue() {
        return "ENUM_CONSTANT";
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Class <code>public static final</code> constant:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class CustomClass {

    public static final CustomType CLASS_CONSTANT = () -&gt; "CLASS_CONSTANT";
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Interface constant:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface CustomInterface {

    CustomType INTERFACE_CONSTANT = () -&gt; "INTERFACE_CONSTANT";
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Annotation constant:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public @interface CustomAnnotation {

    CustomType ANNOTATION_CONSTANT = () -&gt; "ANNOTATION_CONSTANT";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To inform the RxMicro framework which instance must be created and injected to config parameter, it is necessary to use the following syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">@${FULL_CLASS_NAME}:${CONSTANT_FIELD_NAME}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example if Your environment contains the following Java system properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">System.setProperty(
        "enum-constant.type",
        "@io.rxmicro.examples.config.custom.type._enum.CustomEnum:ENUM_CONSTANT"
);
System.setProperty(
        "class-constant.type",
        "@io.rxmicro.examples.config.custom.type._class.CustomClass:CLASS_CONSTANT"
);
System.setProperty(
        "interface-constant.type",
        "@io.rxmicro.examples.config.custom.type._interface.CustomInterface:INTERFACE_CONSTANT"
);
System.setProperty(
        "annotation-constant.type",
        "@io.rxmicro.examples.config.custom.type._annotation.CustomAnnotation:ANNOTATION_CONSTANT"
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>and Your application read configuration for all configured namespaces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">System.out.println(
        "Default constant: " +
                getConfig(ExampleConfig.class).getType().getValue()
);
System.out.println(
        "Enum constant: " +
                getConfig("enum-constant", ExampleConfig.class).getType().getValue()
);
System.out.println(
        "Class constant: " +
                getConfig("class-constant", ExampleConfig.class).getType().getValue()
);
System.out.println(
        "Interface constant: " +
                getConfig("interface-constant", ExampleConfig.class).getType().getValue()
);
System.out.println(
        "Annotation constant: " +
                getConfig("annotation-constant", ExampleConfig.class).getType().getValue()
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Result will be the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Default constant: DEFAULT_CONSTANT
Enum constant: ENUM_CONSTANT
Class constant: CLASS_CONSTANT
Interface constant: INTERFACE_CONSTANT
Annotation constant: ANNOTATION_CONSTANT</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For class or interface or annotation constants the RxMicro framework uses the <code>reflection</code> to read value.<br>
So before using this type of custom type instances don&#8217;t forget to export packages to <code>rxmicro.reflection</code> module, because this module contains the <code>reflection</code> util class which is used to read this value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">exports io.rxmicro.examples.config.custom.type._class to
        rxmicro.reflection;
exports io.rxmicro.examples.config.custom.type._interface to
        rxmicro.reflection;
exports io.rxmicro.examples.config.custom.type._annotation to
        rxmicro.reflection;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>The RxMicro team recommends using an enum for custom type injection to config instances!</strong></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="supported_container_parameter_types"><a class="anchor" href="#supported_container_parameter_types"></a><a class="link" href="#supported_container_parameter_types">8.6.3. Supported Container Parameter Types</a></h4>
<div class="paragraph">
<p>The RxMicro framework supports the following container Java types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.util.List&lt;V&gt;</code>;</p>
</li>
<li>
<p><code>java.util.Set&lt;V&gt;</code>;</p>
</li>
<li>
<p><code>java.util.SortedSet&lt;V&gt;</code>;</p>
</li>
<li>
<p><code>java.util.Map&lt;K, V&gt;</code>;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>where <code>K</code> and <code>V</code> can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.lang.Boolean</code>;</p>
</li>
<li>
<p><code>java.lang.Long</code>;</p>
</li>
<li>
<p><code>java.math.BigDecimal</code>;</p>
</li>
<li>
<p><code>java.lang.String</code>;</p>
</li>
<li>
<p><code>CUSTOM_TYPE</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The RxMicro framework uses <code>,</code> character as collection (List, Set, SortedSet, Map.Entry) value delimiter and '=' character as key-value separator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">list=red,green,blue
set=red,green,blue
sorted-set=red,green,blue
map=red=0xFF0000,green=0x00FF00,blue=0x0000FF</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The RxMicro framework uses <code>reflection</code> to initialize config instances.
But container parametrization types are not available for the <code>reflection</code> reading.</p>
</div>
<div class="paragraph">
<p>Thus the RxMicro framework tries to guess which type must be created using the following algorithm:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Try to convert to <code>java.lang.Boolean</code> type.
If failed then goto <code>2</code> step.</p>
</li>
<li>
<p>Try to convert to <code>java.math.BigDecimal</code> type.
If failed then goto <code>3</code> step.</p>
</li>
<li>
<p>Try to convert to <code>java.lang.Long</code> type.
If failed then goto <code>4</code> step.</p>
</li>
<li>
<p>Try to convert to <code>CUSTOM_TYPE</code>.
If failed then goto <code>5</code> step.</p>
</li>
<li>
<p>Return <code>java.lang.String</code> instance.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This means that if You provide a config list with different types, the RxMicro framework create a <code>java.util.List</code> with different types:</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">list=red,1.2,4,true</code></pre>
</div>
</div>
<div class="paragraph">
<p>the result will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">java.util.List.of(new String("red"), new BigDecimal("1.2"), Long.valueOf(4), Boolean.valueOf(true));</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the <code>ClassCastException</code> will be thrown if Your config parameter is not of <code>java.util.List&lt;java.lang.Object&gt;</code> type.</p>
</div>
<div class="paragraph">
<p>To avoid the <code>ClassCastException</code> use the following recommendation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For <code>boolean</code> lists use <code>java.util.List&lt;java.lang.Boolean&gt;</code> type.</p>
</li>
<li>
<p>For <code>integer number</code> lists use <code>java.util.List&lt;java.lang.Long&gt;</code> type.</p>
</li>
<li>
<p>For <code>decimal number</code> lists use <code>java.util.List&lt;java.math.BigDecimal&gt;</code> type.</p>
</li>
<li>
<p>For <code>string</code> lists use <code>java.util.List&lt;java.lang.String&gt;</code> type.</p>
</li>
<li>
<p>For <code>custom type</code> lists use <code>java.util.List&lt;CUSTOM_TYPE&gt;</code> type.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>DON&#8217;T USE ANY OTHER TYPES FOR COLLECTION PARAMETRIZATION!</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="configuration_verifiers"><a class="anchor" href="#configuration_verifiers"></a><a class="link" href="#configuration_verifiers">8.7. Configuration Verifiers</a></h3>
<div class="paragraph">
<p>If Your runtime has complex configuration the RxMicro team strong recommends enabling runtime strict mode.</p>
</div>
<div class="paragraph">
<p>If the runtime strict mode activated the RxMicro runtime invokes additional checks to find unused or redundant configurations.</p>
</div>
<div class="paragraph">
<p>To enable the runtime strict mode set <code>RX_MICRO_RUNTIME_STRICT_MODE</code> environment variable to the <code>true</code> value!
<em>(Instead of environment variable You can use Java System property as well.)</em></p>
</div>
<div class="paragraph">
<p>If runtime strict mode successful activated the following log message can be found:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">[INFO] RxMicroRuntime !!! RxMicro Runtime Strict Mode is activated !!!</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="logger"><a class="anchor" href="#logger"></a><a class="link" href="#logger">9. Logger</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Data_logger" target="_blank" rel="noopener"><strong>Logger</strong></a> is an integral component of any software system.</p>
</div>
<div class="paragraph">
<p>The RxMicro framework provides the <code>rxmicro.logger</code> module for logging important events during the work of microservices.</p>
</div>
<div class="paragraph">
<p>Creation and usage of a logger in the source code is no different from <a href="http://www.java-logging.com/" target="_blank" rel="noopener">other logging frameworks</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final class MicroService {

    private static final Logger LOGGER = LoggerFactory.getLogger(MicroService.class); <i class="conum" data-value="1"></i><b>(1)</b>

    @GET("/")
    void test() {
        LOGGER.info("test message"); <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Logger creation for the current microservice class.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Logging of a message with <code>INFO</code> level.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-logger/src/main/java/io/rxmicro/logger/Logger.java" target="_blank" rel="noopener"><code>Logger</code></a> interface is an abstraction over the real logger.</p>
</div>
<div class="paragraph">
<p>At the moment, there is only one implementation of this interface that delegates logging to the
<a href="https://docs.oracle.com/javase/10/core/java-logging-overview.htm" target="_blank" rel="noopener"><code>java.logging</code></a> module.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="logger_configuration"><a class="anchor" href="#logger_configuration"></a><a class="link" href="#logger_configuration">9.1. Logger Configuration</a></h3>
<div class="sect3">
<h4 id="using_configuration_file"><a class="anchor" href="#using_configuration_file"></a><a class="link" href="#using_configuration_file">9.1.1. Using Configuration File</a></h4>
<div id="core-logger-config-file-inline" class="paragraph">
<p>The main configuration file of the <code>java.logging</code> logger is the <code>jul.properties</code> classpath resource.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If classpath contains the <code>jul.test.properties</code> resource, then this resource overrides <strong>all</strong> configurations of the <code>jul.properties</code> resource.</p>
</div>
<div class="paragraph">
<p>This function allows configuring the logger for a test environment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>jul.properties</code> classpath resource must contain a configuration <a href="http://tutorials.jenkov.com/java-logging/configuration.html" target="_blank" rel="noopener">in the standard format for the <code>java.logging</code> module</a>.</p>
</div>
<div class="paragraph">
<p>Example of logger configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">.level=INFO
io.rxmicro.config.level=DEBUG</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>rxmicro.logger</code> module supports all logging levels from the following sets: <code>{OFF, ERROR, WARN, INFO, DEBUG, TRACE, ALL}</code> and <code>{OFF, SEVERE, WARNING, INFO, CONFIG, FINE, FINER, FINEST, ALL}</code>.</p>
</div>
<div class="paragraph">
<p>Therefore, in the <code>jul.properties</code> configuration file You can use any logging level.
When activating the <code>java.logging</code> logger, the RxMicro framework automatically converts levels from a set of <code>{OFF, ERROR, WARN, INFO, DEBUG, TRACE, ALL}</code> into <code>{OFF, SEVERE, WARNING, INFO, FINE, FINEST, ALL}</code>.</p>
</div>
<div class="paragraph">
<p>This option makes it possible to use unsupported but widely used in other logging frameworks logging levels for the <code>java.logging</code> logger.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="default_reading_order_of_config_sources"><a class="anchor" href="#default_reading_order_of_config_sources"></a><a class="link" href="#default_reading_order_of_config_sources">9.1.2. Default Reading Order of Config Sources.</a></h4>
<div class="paragraph">
<p>By default, the <code>rxmicro.logger</code> module reads configuration sources in the following order <em>(From the lowest to the highest priority)</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default config.</p>
</li>
<li>
<p>Configuration from the <code>jul.properties</code> classpath resource if the resource found.</p>
</li>
<li>
<p>Configuration from the <code>jul.test.properties</code> classpath resource if the resource found.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="using_additional_config_sources_for_logging_configuration"><a class="anchor" href="#using_additional_config_sources_for_logging_configuration"></a><a class="link" href="#using_additional_config_sources_for_logging_configuration">9.1.3. Using Additional Config Sources for Logging Configuration</a></h4>
<div class="paragraph">
<p>Besides <code>jul.properties</code> and <code>jul.test.properties</code> classpath resources the <code>rxmicro.logger</code> module supports the following configuration sources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configuration using environment variables;</p>
</li>
<li>
<p>Configuration using Java system properties;</p>
</li>
<li>
<p>Configuration using properties file that is located at the following paths:</p>
<div class="ulist">
<ul>
<li>
<p><code>./jul.properties</code>;</p>
</li>
<li>
<p><code>$HOME/jul.properties</code>;</p>
</li>
<li>
<p><code>$HOME/.rxmicro/jul.properties</code>;</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>.</code> - is the current project directory <em>(i.e. <code>System.getProperty("user.dir")</code>)</em>;</p>
</li>
<li>
<p><code>$HOME</code> - is the home directory <em>(i.e. <code>System.getProperty("user.home")</code>)</em>:</p>
<div class="ulist">
<ul>
<li>
<p>for Linux platform the <code>$HOME</code> directory is <code>/home/$USERNAME</code>;</p>
</li>
<li>
<p>for MacOS platform the <code>$HOME</code> directory is <code>/Users/$USERNAME</code>;</p>
</li>
<li>
<p>for Windows platform the <code>$HOME</code> directory is <code>C:\Documents and Settings\%USERNAME%</code> or <code>C:\Users\%USERNAME%</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To enable the additional config sources use the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-logger/src/main/java/io/rxmicro/logger/LoggerConfigSources.java" target="_blank" rel="noopener"><code>LoggerConfigSources</code></a> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><i class="conum" data-value="1"></i><b>(1)</b>
static {
    LoggerConfigSources.setLoggerConfigSources(
            LoggerConfigSource.DEFAULT,
            LoggerConfigSource.CLASS_PATH_RESOURCE,
            LoggerConfigSource.TEST_CLASS_PATH_RESOURCE,
            LoggerConfigSource.FILE_AT_THE_HOME_DIR,
            LoggerConfigSource.FILE_AT_THE_CURRENT_DIR,
            LoggerConfigSource.FILE_AT_THE_RXMICRO_CONFIG_DIR,
            LoggerConfigSource.ENVIRONMENT_VARIABLES,
            LoggerConfigSource.JAVA_SYSTEM_PROPERTIES
    );
}

private static final Logger LOGGER = LoggerFactory.getLogger(LoggerConfigSourceTest.class);

public static void main(final String[] args) {
    LOGGER.info("Hello World!");
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>- The logger config sources must be configured before the first usage of the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-logger/src/main/java/io/rxmicro/logger/LoggerFactory.java" target="_blank" rel="noopener"><code>LoggerFactory</code></a>,
otherwise these config settings will be ignored.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>If You know exactly which configuration sources should be used by the microservice, ALWAYS specify them explicitly!</strong></p>
</div>
<div class="paragraph">
<p><strong>With this approach, at the microservice starting, the RxMicro framework won’t try to search for non-existent sources, spending precious microseconds!</strong></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="using_environment_variables_and_java_system_properties"><a class="anchor" href="#using_environment_variables_and_java_system_properties"></a><a class="link" href="#using_environment_variables_and_java_system_properties">9.1.4. Using Environment Variables And Java System Properties</a></h4>
<div class="paragraph">
<p>After activation of the configuration using environment variables and(or) Java system properties, the RxMicro framework parses environment variables and(or) Java system properties.<br>
If Your runtime contains an environment variable and (or) java system property with name that starts with <code>logger.</code> phrase, the <code>rxmicro.logger</code> module interprets it as configuration.
For example to enable <code>TRACE</code> logger level for <code>MicroServiceLauncher</code> it is necessary to provide one of the following configurations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Example of the configuration using environment variable:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export logger.io.rxmicro.rest.server.level=TRACE

java -p lib:. -m module/package.MicroServiceLauncher</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Example of the configuration using Java system property:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">java -p lib:. -Dlogger.io.rxmicro.rest.server.level=TRACE -m module/package.MicroServiceLauncher</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="logger_handler"><a class="anchor" href="#logger_handler"></a><a class="link" href="#logger_handler">9.2. Logger Handler</a></h3>
<div class="paragraph">
<p>By default the <code>INFO</code> logging level is activated for the all loggers.</p>
</div>
<div class="paragraph">
<p>All logger events are sent to the <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-logger/src/main/java/io/rxmicro/logger/jul/SystemConsoleHandler.java" target="_blank" rel="noopener"><code>SystemConsoleHandler</code></a>
appender, which outputs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Logger events with <code>ERROR</code> level into <code>System.err</code>;</p>
</li>
<li>
<p>Logger events with other levels into <code>System.out</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>rxmicro.logger</code> module follows the logs recommendations, that are defined at <a href="https://12factor.net/logs" target="_blank" rel="noopener">The Twelve-Factor App Manifest</a> and logs messages to <code>System.out</code>/<code>System.err</code> only!</p>
</div>
<div class="paragraph">
<p>If these functions are not enough You can use any other logging framework:
<a href="http://logback.qos.ch/" target="_blank" rel="noopener"><code>Logback</code></a>,
<a href="https://logging.apache.org/log4j/2.x/" target="_blank" rel="noopener"><code>Apache Log4j 2</code></a> and others.</p>
</div>
<div class="paragraph">
<p>P.S. You can use also the <code>FileHandler</code>, <code>SocketHandler</code>, etc that defined at the
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.logging/java/util/logging/package-summary.html" target="_blank" rel="noopener"><code>java.logging</code></a> module.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-logger/src/main/java/io/rxmicro/logger/jul/SystemConsoleHandler.java" target="_blank" rel="noopener"><code>SystemConsoleHandler</code></a>
appender must output all logging information into <code>System.out</code> or <code>System.err</code> it is necessary to set <code>stream</code> parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To enable <code>System.err</code> output for the all log levels use the following configuration:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>io.rxmicro.logger.jul.SystemConsoleHandler.stream=stderror</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To enable <code>System.out</code> output for the all log levels use the following configuration:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>io.rxmicro.logger.jul.SystemConsoleHandler.stream=stdout</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To get more information about the configuration of the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-logger/src/main/java/io/rxmicro/logger/jul/SystemConsoleHandler.java" target="_blank" rel="noopener"><code>SystemConsoleHandler</code></a>
component read javadoc for this component:<br>
<a href="https://javadoc.io/doc/io.rxmicro/rxmicro-logger/latest/rxmicro.logger/io/rxmicro/logger/jul/SystemConsoleHandler.html" target="_blank" rel="noopener">SystemConsoleHandler.html</a></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="pattern_formatter"><a class="anchor" href="#pattern_formatter"></a><a class="link" href="#pattern_formatter">9.3. Pattern Formatter</a></h3>
<div class="paragraph">
<p>The current version of the <code>rxmicro.logger</code> module is supported only one logger formatter:
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-logger/src/main/java/io/rxmicro/logger/jul/PatternFormatter.java" target="_blank" rel="noopener"><code>PatternFormatter</code></a> with the default configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">io.rxmicro.logger.jul.PatternFormatter.pattern=%d{yyyy-MM-dd HH:mm:ss.SSS} [%p] %c: %m%n</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class supports conversion specifiers that can be used as format control expressions.
Each conversion specifier starts with a percent sign <code>%</code> and is followed by optional format modifiers, a conversion word and optional parameters between braces.
The conversion word controls the data field to convert, e.g. logger name or date format.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-logger/src/main/java/io/rxmicro/logger/jul/PatternFormatter.java" target="_blank" rel="noopener"><code>PatternFormatter</code></a> supports the following conversion specifiers:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Conversion specifiers supported by the <code>PatternFormatter</code>.</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top"><strong>Conversion specifiers</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>c</strong><code>{length}</code><br>
<strong>lo</strong><code>{length}</code><br>
<strong>logger</strong><code>{length}</code><br></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Outputs the name of the logger at the origin of the logging event.<br>
This conversion specifier takes a string as its first and only option.<br>
Currently supported only one of the following options: <code>{short}</code>, <code>{0}</code>, <code>{full}</code>.<br>
<code>{short}</code> is synonym for <code>{0}</code> option.<br>
If no option defined this conversion specifier uses <code>{full}</code> option.<br></p>
</div>
<div class="paragraph">
<p>The following table describes option usage results:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Conversion specifier</th>
<th class="tableblock halign-left valign-top">Logger name</th>
<th class="tableblock halign-left valign-top">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%logger</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>package.sub.Bar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>package.sub.Bar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%logger{full}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>package.sub.Bar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>package.sub.Bar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%logger{short}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>package.sub.Bar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Bar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%logger{0}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>package.sub.Bar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Bar</code></p></td>
</tr>
</tbody>
</table></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>C</strong><code>{length}</code><br>
<strong>class</strong><code>{length}</code><br></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Outputs the fully-qualified class name of the caller issuing the logging request.<br>
This conversion specifier takes a string as its first and only option.<br>
Currently supported only one of the following options: <code>{short}</code>, <code>{0}</code>, <code>{full}</code>.<br>
<code>{short}</code> is synonym for <code>{0}</code> option.<br>
If no option defined this conversion specifier uses <code>{full}</code> option.<br></p>
</div>
<div class="paragraph">
<p>The following table describes option usage results:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Conversion specifier</th>
<th class="tableblock halign-left valign-top">Logger name</th>
<th class="tableblock halign-left valign-top">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%logger</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>package.sub.Bar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>package.sub.Bar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%logger{full}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>package.sub.Bar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>package.sub.Bar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%logger{short}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>package.sub.Bar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Bar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%logger{0}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>package.sub.Bar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Bar</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Generating the caller class information is not particularly fast.
Thus, its use should be avoided unless execution speed is not an issue!</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>d</strong><code>{pattern}</code><br>
<strong>date</strong><code>{pattern}</code><br>
<strong>d</strong><code>{pattern, timezone}</code><br>
<strong>date</strong><code>{pattern, timezone}</code><br></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Used to output the date of the logging event.<br>
The date conversion word admits a pattern string as a parameter.<br>
The pattern syntax is compatible with the format accepted by <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/format/DateTimeFormatter.html" target="_blank" rel="noopener"><code>DateTimeFormatter</code></a>.<br>
If {@code timezone} is specified, this conversion specifier uses <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/ZoneId.html#of(java.lang.String)" target="_blank" rel="noopener"><code>ZoneId.of(String)</code></a> method to parse it, so timezone syntax must be compatible with zone id format.<br></p>
</div>
<div class="paragraph">
<p>The following table describes option usage results:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Conversion specifier</th>
<th class="tableblock halign-left valign-top">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2020-01-02 03:04:05.123</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%date{yyyy-MM-dd}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2020-01-02</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%date{HH:mm:ss.SSS}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>03:04:05.123</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%date{, UTC}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2020-01-02 03:04:05.123</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If pattern is missing (For example: <code>%d</code>, <code>%date</code>, <code>%date{, UTC}}</code>, the default pattern will be used:
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-logger/src/main/java/io/rxmicro/logger/internal/jul/config/adapter/pattern/consumers/DateTimeOfLoggingEventBiConsumer.java#L40" target="_blank" rel="noopener"><code>yyyy-MM-dd HH:mm:ss.SSS</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>F</strong><br>
<strong>file</strong>`</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Outputs the file name of the Java source file where the logging request was issued.</p>
</div>
<div class="paragraph">
<p><strong>Generating the file information is not particularly fast.
Thus, its use should be avoided unless execution speed is not an issue!</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>L</strong><br>
<strong>line</strong>`</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Outputs the line number from where the logging request was issued.</p>
</div>
<div class="paragraph">
<p><strong>Generating the file information is not particularly fast.
Thus, its use should be avoided unless execution speed is not an issue!</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>m</strong><br>
<strong>mes</strong>`<br>
<strong>message</strong><br></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Outputs the application-supplied message associated with the logging event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>M</strong><br>
<strong>method</strong>`</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Outputs the method name where the logging request was issued.</p>
</div>
<div class="paragraph">
<p><strong>Generating the method name is not particularly fast.
Thus, its use should be avoided unless execution speed is not an issue.</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>n</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Outputs the platform dependent line separator character or characters.</p>
</div>
<div class="paragraph">
<p>This conversion word offers practically the same performance as using non-portable line separator strings such as <code>\n</code>, or <code>\r\n</code>.
Thus, it is the preferred way of specifying a line separator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>p</strong><br>
<strong>le</strong>`<br>
<strong>level</strong><br></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Outputs the level of the logging event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>r</strong><br>
<strong>relative</strong><br></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Outputs the number of milliseconds elapsed since the start of the application until the creation of the logging event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>t</strong><br>
<strong>thread</strong><br></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Outputs the name of the thread that generated the logging event.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>id</strong><br>
<strong>rid</strong><br>
<strong>request-id</strong><br>
<strong>request_id</strong><br>
<strong>requestId</strong><br></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Outputs the request id if specified.</p>
</div>
<div class="paragraph">
<p>This specifier displays the request id that retrieved from HTTP request if the <a href="monitoring.html#monitoring-request-tracing">request tracing</a> is enabled.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For request tracing feature usage Your code must use the overloaded logger methods with <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-logger/src/main/java/io/rxmicro/logger/RequestIdSupplier.java" target="_blank" rel="noopener"><code>RequestIdSupplier</code></a> argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface Logger {

    // ...

    void trace(RequestIdSupplier requestIdSupplier, Object... otherArguments);

    void debug(RequestIdSupplier requestIdSupplier, Object... otherArguments);

    void info(RequestIdSupplier requestIdSupplier, Object... otherArguments);

    void warn(RequestIdSupplier requestIdSupplier, Object... otherArguments);

    void error(RequestIdSupplier requestIdSupplier, Object... otherArguments);

    // ...
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="custom_log_event"><a class="anchor" href="#custom_log_event"></a><a class="link" href="#custom_log_event">9.4. Custom Log Event</a></h3>
<div class="paragraph">
<p>The RxMicro framework provides a factory method to build a custom logger event:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private static final Logger LOGGER = LoggerFactory.getLogger(LoggerEventBuilderTest.class);

public static void main(final String[] args) {
    final LoggerEventBuilder builder = LoggerFactory.newLoggerEventBuilder();
    builder.setMessage("Hello World!");
    LOGGER.info(builder.build());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A custom logger event can be useful if Your log message depends on some parameter.<br>
For example, the following methods implement the same logic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public void log1(final Throwable throwable,
                 final boolean withStackTrace) {
    final LoggerEventBuilder builder = LoggerFactory.newLoggerEventBuilder()
            .setMessage("Some error message: ?", throwable.getMessage());
    if (withStackTrace) {
        builder.setThrowable(throwable);
    }
    LOGGER.error(builder.build());
}

public void log2(final Throwable throwable,
                 final boolean withStackTrace) {
    if (withStackTrace) {
        LOGGER.error(throwable, "Some error message: ?", throwable.getMessage());
    } else {
        LOGGER.error("Some error message: ?", throwable.getMessage());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Besides that a custom logger event allows customizing the following auto detect parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Thread id;</p>
</li>
<li>
<p>Thread name;</p>
</li>
<li>
<p>Source class name;</p>
</li>
<li>
<p>Source method name;</p>
</li>
<li>
<p>Source file name;</p>
</li>
<li>
<p>Source line number.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">LOGGER.info(
        LoggerFactory.newLoggerEventBuilder()
                .setMessage("Some error message")
                .setThreadName("Test-Thread-Name")
                .setThreadId(34L)
                .setStackFrame("package.Class", "method", "Test.java", 85)
                .setThrowable(throwable)
                .build()
);</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="multiline_logs_issue_for_docker_environment"><a class="anchor" href="#multiline_logs_issue_for_docker_environment"></a><a class="link" href="#multiline_logs_issue_for_docker_environment">9.5. Multiline Logs Issue For Docker Environment</a></h3>
<div class="paragraph">
<p>By default the <code>docker</code> log driver does not support multiline log data.<br>
It means that if Your microservice prints a stacktrace of any exception to the <code>System.out</code> or <code>System.err</code> each stack trace element will be processed as separate log event.</p>
</div>
<div class="paragraph">
<p>There are several standard solutions to this problem.
The RxMicro framework adds the one of them.</p>
</div>
<div class="sect3">
<h4 id="solution_from_rxmicro_framework"><a class="anchor" href="#solution_from_rxmicro_framework"></a><a class="link" href="#solution_from_rxmicro_framework">9.5.1. Solution From RxMicro Framework</a></h4>
<div class="paragraph">
<p>If Your logger configuration contains the following setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">io.rxmicro.logger.jul.PatternFormatter.singleLine=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>than all multiline log events are processed by the RxMicro framework as single line ones:<br>
i.e. the <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-logger/src/main/java/io/rxmicro/logger/jul/PatternFormatter.java" target="_blank" rel="noopener"><code>PatternFormatter</code></a>
component replaces <code>'\n'</code> character by the <code>"\\n"</code> string before printing it to the <code>System.out</code> or <code>System.err</code>.<br>
<em>(For Windows platform the <code>"\r\n""</code> character combination will be replaced by <code>"\\r\\n"</code> string!)</em></p>
</div>
</div>
<div class="sect3">
<h4 id="how_to_view_original_log_events"><a class="anchor" href="#how_to_view_original_log_events"></a><a class="link" href="#how_to_view_original_log_events">9.5.2. How To View Original Log Events?</a></h4>
<div class="paragraph">
<p>To view original logs You can use the <a href="https://www.gnu.org/software/sed/manual/sed.html" target="_blank" rel="noopener"><code>sed</code></a> util:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker logs microservice-container | sed -e 's/\\n/\n/g'</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl logs microservice-pod | sed -e 's/\\n/\n/g'</code></pre>
</div>
</div>
<div class="paragraph">
<p>To view original logs on Your log aggregation tool if <a href="https://www.fluentd.org/" target="_blank" rel="noopener"><code>fluentd</code></a>
open source data collector is used, it is necessary to add the following filter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">&lt;filter exampleTag&gt;
    @type record_transformer
    enable_ruby true
    &lt;record&gt;
        # --- Replace "\n" string by '\n' character ---
        log ${record["log"].gsub("\\n", "\n")}
    &lt;/record&gt;
&lt;/filter&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>FYI: This filter requires that your log messages are parsed and converted to the json property with <code>log</code> name before invocation of this filter!</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="core-rx-micro-json-section"><a class="anchor" href="#core-rx-micro-json-section"></a><a class="link" href="#core-rx-micro-json-section">10. JSON</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://www.json.org/" target="_blank" rel="noopener"><strong>JSON</strong></a> is a widely used message exchange format for distributed applications.</p>
</div>
<div class="paragraph">
<p>The RxMicro framework provides the <code>rxmicro.json</code> module for low-level and efficient work with this format.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unfortunately <a href="https://www.json.org/" target="_blank" rel="noopener"><strong>JSON</strong></a> format is defined in at least seven different documents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>2002</code> - <a href="https://www.json.org/" target="_blank" rel="noopener">json.org</a>, and the business card</p>
</li>
<li>
<p><code>2006</code> - IETF <a href="https://tools.ietf.org/html/rfc4627" target="_blank" rel="noopener">RFC 4627</a>, which set the application/json MIME media type</p>
</li>
<li>
<p><code>2011</code> - <a href="http://www.ecma-international.org/ecma-262/5.1/#sec-15.12" target="_blank" rel="noopener">ECMAScript 262, section 15.12</a></p>
</li>
<li>
<p><code>2013</code> - <a href="http://www.ecma-international.org/publications/standards/Ecma-404.htm" target="_blank" rel="noopener">ECMA 404</a> according to Tim Bray (RFC 7159 editor)</p>
</li>
<li>
<p><code>2014</code> - IETF <a href="https://tools.ietf.org/html/rfc7158" target="_blank" rel="noopener">RFC 7158</a></p>
</li>
<li>
<p><code>2014</code> - IETF <a href="https://tools.ietf.org/html/rfc7159" target="_blank" rel="noopener">RFC 7159</a></p>
</li>
<li>
<p><code>2017</code> - IETF <a href="https://tools.ietf.org/html/rfc8259" target="_blank" rel="noopener">RFC 8259</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>(Read more at <a href="http://seriot.ch/parsing_json.php" target="_blank" rel="noopener">Parsing JSON is a Minefield</a> article).</p>
</div>
<div class="paragraph">
<p>So the RxMicro framework implementation of JSON parser can be described using the following test suites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.rxmicro.io/latest/static/java-parsers-only.html">JSON Parsing Tests, Only Java Parsers</a></p>
</li>
<li>
<p><a href="https://docs.rxmicro.io/latest/static/all-parsers.html">JSON Parsing Tests, All Parsers</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The RxMicro framework uses classes from the <code>rxmicro.json</code> module when automatically converting Java models to JSON format and vice versa.</p>
</div>
<div class="paragraph">
<p><strong>Therefore, a developer should not explicitly use this module!</strong></p>
</div>
<div class="paragraph">
<p><em>However, the common idea about the capabilities of this module is needed for correct test writing!</em></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="core-json-type-mapping"><a class="anchor" href="#core-json-type-mapping"></a><a class="link" href="#core-json-type-mapping">10.1. A Mapping Between JSON and Java Types</a></h3>
<div class="paragraph">
<p>Since this module is used automatically, it is optimized for machine operations.
Therefore, this module doesn&#8217;t provide separate classes for JSON types.
Instead, standard Java classes are used:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Mapping table between JSON and Java types.</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>JSON type</strong></th>
<th class="tableblock halign-left valign-top"><strong>Java type</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" target="_blank" rel="noopener"><code>java.util.Map&lt;String, Object&gt;</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>array</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/List.html" target="_blank" rel="noopener"><code>java.util.List&lt;Object&gt;</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Boolean.html" target="_blank" rel="noopener"><code>java.lang.Boolean</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html" target="_blank" rel="noopener"><code>java.lang.String</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-json/src/main/java/io/rxmicro/json/JsonNumber.java" target="_blank" rel="noopener"><code>io.rxmicro.json.JsonNumber</code></a></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Mapping table between Java and JSON types.</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Java type</strong></th>
<th class="tableblock halign-left valign-top"><strong>JSON type</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" target="_blank" rel="noopener"><code>java.util.Map&lt;String, Object&gt;</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>object</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/List.html" target="_blank" rel="noopener"><code>java.util.List&lt;Object&gt;</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>array</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Boolean.html" target="_blank" rel="noopener"><code>java.lang.Boolean</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html" target="_blank" rel="noopener"><code>java.lang.String</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Number.html" target="_blank" rel="noopener"><code>? extends java.lang.Number</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-json/src/main/java/io/rxmicro/json/JsonNumber.java" target="_blank" rel="noopener"><code>io.rxmicro.json.JsonNumber</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Any Java Class</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="core-json-rxmicro-json-module-usage"><a class="anchor" href="#core-json-rxmicro-json-module-usage"></a><a class="link" href="#core-json-rxmicro-json-module-usage">10.2. <code>rxmicro.json</code> Module Usage</a></h3>
<div class="paragraph">
<p>To write <a href="testing.html#testing-section">tests</a> correctly, it is necessary to have a common idea about the <code>rxmicro.json</code> module.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at a microservice that returns the result in JSON object format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final class MicroService {

    @GET("/")
    CompletionStage&lt;Response&gt; produce() {
        return completedStage(new Response());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Response</code> class - Java model of HTTP response in JSON format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class Response {

    final Child child = new Child(); <i class="conum" data-value="1"></i><b>(1)</b>

    final List&lt;Integer&gt; values = List.of(25, 50, 75, 100); <i class="conum" data-value="2"></i><b>(2)</b>

    final String string = "text"; <i class="conum" data-value="3"></i><b>(3)</b>

    final Integer integer = 10; <i class="conum" data-value="4"></i><b>(4)</b>

    final BigDecimal decimal = new BigDecimal("0.1234"); <i class="conum" data-value="5"></i><b>(5)</b>

    final Boolean logical = true; <i class="conum" data-value="6"></i><b>(6)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nested JSON object.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>JSON numeric array.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>String data type.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Integer numeric data type.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Floating-point numeric data type.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Logical data type.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>Child</code> class - Java model of the nested JSON object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final class Child {

    final Integer integer = 20;
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For simplicity, each response model field is immediately initialized with test data.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As a result, the microservice returns the following JSON object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "child": {
    "integer": 20
  },
  "values": [
    25,
    50,
    75,
    100
  ],
  "string": "text",
  "integer": 10,
  "decimal": 0.1234,
  "logical": true
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>While writing <a href="testing.html#testing-rest-based-microservice-tests-section">REST-based microservice test</a> or <a href="testing.html#testing-integration-tests-basic-section">integration test</a>, it is necessary to compare the expected JSON response with the one returned by REST-based microservice.
<em>(The response returned by the microservice is available through the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-http-client/src/main/java/io/rxmicro/http/client/ClientHttpResponse.java#L75" target="_blank" rel="noopener"><code>ClientHttpResponse.getBody()</code></a>method)</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RxMicroRestBasedMicroServiceTest(MicroService.class)
final class MicroServiceTest {
    //..
    @Test
    void Should_return_Response() {
        final ClientHttpResponse response = httpClient.get("/").join();
        final Object actualBody = response.getBody(); <i class="conum" data-value="1"></i><b>(1)</b>
        // ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>ClientHttpResponse.getBody()</code> method returns the HTTP response body.
Since the REST-based microservice returns a JSON object, this method returns the result as the <a href="#core-json-type-mapping"><code>java.util.Map&lt;String, Object&gt;</code></a> object.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Therefore, to compare JSON objects, You need to create the <code>java.util.Map&lt;String, Object&gt;</code> object containing the expected properties of the JSON object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RxMicroRestBasedMicroServiceTest(MicroService.class)
final class MicroServiceTest {
    //..
    @Test
    void Should_return_Response() {
        final ClientHttpResponse response = httpClient.get("/").join();
        final Object actualBody = response.getBody(); <i class="conum" data-value="1"></i><b>(1)</b>
        final Object expectedBody = Stream.of(
                Map.entry("child", Map.of(
                        "integer", new io.rxmicro.json.JsonNumber("20")
                )),
                Map.entry("values", List.of(
                        new io.rxmicro.json.JsonNumber("25"),
                        new io.rxmicro.json.JsonNumber("50"),
                        new io.rxmicro.json.JsonNumber("75"),
                        new io.rxmicro.json.JsonNumber("100")
                )),
                Map.entry("string", "text"),
                Map.entry("integer", new io.rxmicro.json.JsonNumber("10")),
                Map.entry("decimal", new io.rxmicro.json.JsonNumber("0.1234")),
                Map.entry("logical", true)
        ).collect(Collectors.toMap(
                Map.Entry::getKey,
                Map.Entry::getValue,
                (u, v) -&gt; u, LinkedHashMap::new
        )); <i class="conum" data-value="2"></i><b>(2)</b>
        assertEquals(expectedBody, actualBody); <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A JSON object returned by microservice.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Expected JSON object.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Comparison of JSON objects using the
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" target="_blank" rel="noopener"><code>java.lang.Object.equals()</code></a> method.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>According to the <a href="https://tools.ietf.org/html/rfc7159#page-6" target="_blank" rel="noopener">JSON specification</a>, the property order in JSON object is undefined.</p>
</div>
<div class="paragraph">
<p>Thus, the following JSON objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "firstname" : "David",
    "lastname" : "Smith"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "lastname" : "Smith",
    "firstname" : "David"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>are considered to be the same.</p>
</div>
<div class="paragraph">
<p><strong>The RxMicro framework always arranges JSON object properties!</strong></p>
</div>
<div class="paragraph">
<p><strong>Thus, the order of JSON properties always corresponds to the order of fields in the Java model!</strong></p>
</div>
<div class="paragraph">
<p>This allows You to compare JSON objects in the form of  <code>java.util.Map&lt;String, Object&gt;</code> using the
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" target="_blank" rel="noopener"><code>java.lang.Object.equals()</code></a> method.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If Your microservice returns the JSON object with unordered properties, use
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/json/JsonFactory.java" target="_blank" rel="noopener"><code>JsonFactory.orderedJsonObject(Object jsonObject)</code></a>
method to sort properties before comparison!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For convenient creation of the expected JSON object, it is recommended to use the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/json/JsonFactory.java" target="_blank" rel="noopener"><code>JsonFactory</code></a> utility class.
This class arranges JSON properties and automatically converts all
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Number.html" target="_blank" rel="noopener"><code>java.lang.Number</code></a> types into the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-json/src/main/java/io/rxmicro/json/JsonNumber.java" target="_blank" rel="noopener"><code>io.rxmicro.json.JsonNumber</code></a> type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RxMicroRestBasedMicroServiceTest(MicroService.class)
final class MicroServiceTest {

    private BlockingHttpClient blockingHttpClient;

    @Test
    void Should_return_Response() {
        final ClientHttpResponse response = blockingHttpClient.get("/");

        final Object actualBody = response.getBody(); <i class="conum" data-value="1"></i><b>(1)</b>
        final Object expectedBody = jsonObject(
                "child", jsonObject("integer", 20), <i class="conum" data-value="4"></i><b>(4)</b>
                "values", jsonArray(25, 50, 75, 100),   <i class="conum" data-value="5"></i><b>(5)</b>
                "string", "text",
                "integer", 10,
                "decimal", new BigDecimal("0.1234"),
                "logical", true
        ); <i class="conum" data-value="2"></i><b>(2)</b>
        assertEquals(expectedBody, actualBody); <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A JSON object returned by microservice.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Expected JSON object.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Comparison of JSON objects using the
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" target="_blank" rel="noopener"><code>java.lang.Object.equals()</code></a> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>To create JSON object, it is recommended to use the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/json/JsonFactory.java" target="_blank" rel="noopener"><code>JsonFactory.jsonObject</code></a> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>To create JSON array, it is recommended to use the
<a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-test/src/main/java/io/rxmicro/test/json/JsonFactory.java" target="_blank" rel="noopener"><code>JsonFactory.jsonArray</code></a> method.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="https://github.com/rxmicro/rxmicro/blob/v0.11/rxmicro-http-client/src/main/java/io/rxmicro/http/client/ClientHttpResponse.java" target="_blank" rel="noopener"><code>ClientHttpResponse</code></a>
interface besides <code>body()</code> method also contains <code>bodyAsBytes()</code> and <code>bodyAsString()</code> ones.</p>
</div>
<div class="paragraph">
<p>Therefore in the test You can compare JSON objects by comparing their string representation or using a third-party Java library that supports the JSON format.
(For example, <a href="https://github.com/stleary/JSON-java" target="_blank" rel="noopener"><code>JSON-java</code></a>, <a href="https://javaee.github.io/jsonp/" target="_blank" rel="noopener"><code>Java API for JSON Processing</code></a>, etc.)</p>
</div>
<div class="paragraph">
<p><strong>Thus, the RxMicro framework recommends using the <code>rxmicro.json</code> module to compare JSON objects, but at the same time provides an opportunity to use any other JSON framework!</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The project source code used in the current subsection is available at the following link:</p>
</div>
<div class="paragraph example-code-link">
<p><a href="https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-common/json" target="_blank" rel="noopener"><code>https://github.com/rxmicro/rxmicro-usage/tree/master/examples/group-common/json</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="core-json-rxmicro-json-wrappers"><a class="anchor" href="#core-json-rxmicro-json-wrappers"></a><a class="link" href="#core-json-rxmicro-json-wrappers">10.3. Json Wrappers</a></h3>
<div class="paragraph">
<p>If you want to work with JSON format using usual Java style, the RxMicro framework provides wrapper classes for JSON object and array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RxMicroRestBasedMicroServiceTest(MicroService.class)
final class MicroServiceTestWithWrappers {

    private BlockingHttpClient blockingHttpClient;

    static Stream&lt;Function&lt;ClientHttpResponse, JsonObject&gt;&gt; toJsonObjectWrapperConverterProvider() {
        return Stream.of(
                <i class="conum" data-value="1"></i><b>(1)</b>
                response -&gt; JsonWrappers.toJsonObject(response.getBody()),
                <i class="conum" data-value="2"></i><b>(2)</b>
                response -&gt; JsonWrappers.readJsonObject(response.getBodyAsString(UTF_8))
        );
    }

    @ParameterizedTest
    @MethodSource("toJsonObjectWrapperConverterProvider")
    void Should_return_Response(final Function&lt;ClientHttpResponse, JsonObject&gt; converter) {
        final ClientHttpResponse response = blockingHttpClient.get("/");

        final JsonObject actualBody = converter.apply(response);

        assertEquals(
                new JsonObject()
                        .set("integer", 20),
                actualBody.getJsonObject("child")
        );
        assertEquals(
                new JsonArray()
                        .add(25).add(50).add(75).add(100),
                actualBody.getJsonArray("values")
        );
        assertEquals(
                "text",
                actualBody.getString("string")
        );
        assertEquals(
                10,
                actualBody.getNumber("integer").intValueExact()
        );
        assertEquals(
                new BigDecimal("0.1234"),
                actualBody.getNumber("decimal").bigDecimalValueExact()
        );
        assertTrue(
                actualBody.getBoolean("logical")
        );
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>- To convert a internal view of JSON object to the JSON wrapper use <code>JsonWrappers.toJsonObject</code> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>- To convert a string view of JSON object to the JSON wrapper use <code>JsonWrappers.readJsonObject</code> method.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="native_transports"><a class="anchor" href="#native_transports"></a><a class="link" href="#native_transports">11. Native Transports</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The RxMicro framework uses <a href="https://netty.io/" target="_blank" rel="noopener"><code>Netty</code></a> to perform asynchronous non-blocking IO operations.
To increase productivity, <code>Netty</code> allows the use of <a href="https://netty.io/wiki/native-transports.html" target="_blank" rel="noopener"><code>native transports</code></a>.</p>
</div>
<div class="paragraph">
<p>To enable <code>native transports</code> feature, add one of the following dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.rxmicro&lt;/groupId&gt;
    &lt;artifactId&gt;rxmicro-netty-native-linux&lt;/artifactId&gt;
    &lt;version&gt;${rxmicro.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.rxmicro&lt;/groupId&gt;
    &lt;artifactId&gt;rxmicro-netty-native-osx&lt;/artifactId&gt;
    &lt;version&gt;${rxmicro.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.rxmicro&lt;/groupId&gt;
    &lt;artifactId&gt;rxmicro-netty-native&lt;/artifactId&gt;
    &lt;version&gt;${rxmicro.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.rxmicro&lt;/groupId&gt;
    &lt;artifactId&gt;rxmicro-netty-native-all&lt;/artifactId&gt;
    &lt;version&gt;${rxmicro.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>rxmicro-netty-native-linux</code> dependency adds the <code>netty-transport-native-epoll</code> artifact;</p>
</li>
<li>
<p>The <code>rxmicro-netty-native-osx</code> dependency adds the <code>netty-transport-native-kqueue</code> artifact;</p>
</li>
<li>
<p>The <code>rxmicro-netty-native</code> dependency activates <code>native transports</code> for the current platform:</p>
<div class="ulist">
<ul>
<li>
<p>in case of the <code>Linux</code> current platform, the <code>netty-transport-native-epoll</code> artifact is added;</p>
</li>
<li>
<p>in case of the <code>MacOS</code> current platform, the <code>netty-transport-native-kqueue</code> artifact is added;</p>
</li>
<li>
<p>otherwise <code>native transports</code> is not activated for the current platform;</p>
</li>
</ul>
</div>
</li>
<li>
<p>the <code>rxmicro-netty-native-all</code> dependency adds the <code>netty-transport-native-epoll</code> and <code>netty-transport-native-kqueue</code> artifacts.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Adding a dependency to the microservice project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.rxmicro&lt;/groupId&gt;
    &lt;artifactId&gt;rxmicro-netty-native-linux&lt;/artifactId&gt;
    &lt;version&gt;${rxmicro.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>instead of</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.netty&lt;/groupId&gt;
    &lt;artifactId&gt;netty-transport-native-epoll&lt;/artifactId&gt;
    &lt;version&gt;${netty.version}&lt;/version&gt;
    &lt;classifier&gt;linux-x86_64&lt;/classifier&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>allows using the <code>Netty native transports</code> library version compatible with all other <code>Netty</code> libraries used by the RxMicro framework.</p>
</div>
<div class="paragraph">
<p>Therefore, the <strong><code>rxmicro-netty-native-&#8230;&#8203;</code> modules don&#8217;t contain any logic.</strong> <strong>They just add <code>Netty native transports</code> libraries of the correct version.</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If <code>native transports</code> has been successfully activated, the information message about the start of the HTTP server will display the corresponding type of transport.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">2020-02-02 20:14:11.707 [INFO] io.rxmicro.rest.server.netty.internal.component.NettyServer :
Server started at 0.0.0.0:8080 using <strong>EPOLL</strong> transport in 500 millis. <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>using EPOLL transport</code> message format means that <code>Netty</code> will use the <code>netty-transport-native-epoll</code> library.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">2020-02-02 20:14:11.707 [INFO] io.rxmicro.rest.server.netty.internal.component.NettyServer :
Server started at 0.0.0.0:8080 using <strong>KQUEUE</strong> transport in 500 millis. <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>using KQUEUE transport</code> message format means that <code>Netty</code> will use the <code>netty-transport-native-kqueue</code> library.</td>
</tr>
</table>
</div>
<table class="tableblock frame-none grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="quick-start.html#quick-start-section"><strong><span class="icon"><i class="fa fa-angle-double-left"></i></span> Quick Start</strong></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="index.html#index-section"><strong><span class="icon"><i class="fa fa-angle-double-up"></i></span> Home</strong></a></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><a href="rest-controller.html#rest-controller-section"><strong>REST Controller  <span class="icon"><i class="fa fa-angle-double-right"></i></span></strong></a></p></td>
</tr>
</tbody>
</table>
<hr>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-166298262-2"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-166298262-2');
</script>
</div>
</div>
</div>
</body>
</html>